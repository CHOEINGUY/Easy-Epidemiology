"use strict";(self["webpackChunkwebpage"]=self["webpackChunkwebpage"]||[]).push([[777],{2245:function(e,t,n){e.exports=n.p+"ea1fd19920cbcb4b.ts"},5286:function(e,t,n){e.exports=n.p+"94c0bf4dea0ebfae.ts"},8317:function(e,t,n){n.r(t),n.d(t,{default:function(){return ol}});var o=n(6768),l=n(144),a=n(169),i=n(5130),r=n(4232),s=n(1215);const d={class:"flex items-center justify-between px-4 py-2 bg-white/80 backdrop-blur-md border-b border-gray-200/50 shadow z-[20] relative"},c=["title"],u={class:"flex items-center gap-1.5"},p={class:"text-sm font-semibold text-rose-600"};var f=(0,o.pM)({__name:"VirtualAppHeader",props:{errorCount:{default:0}},emits:["focusFirstError"],setup(e){return(e,t)=>((0,o.uX)(),(0,o.CE)("header",d,[(0,o.bF)(s.A),(0,o.bF)(i.eB,{name:"fade"},{default:(0,o.k6)(()=>[e.errorCount>0?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"flex items-center gap-1.5 px-3.5 py-1.5 rounded-full bg-rose-50/80 border border-rose-200/60 cursor-pointer transition-all duration-200 hover:bg-rose-100 hover:shadow-md hover:scale-105 active:scale-95",onClick:t[0]||(t[0]=t=>e.$emit("focusFirstError")),title:e.$t("header.goToFirstError")},[(0,o.Lk)("div",u,[t[1]||(t[1]=(0,o.Lk)("svg",{class:"w-4 h-4 text-rose-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,o.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),(0,o.Lk)("span",p,(0,r.v_)(e.$t("header.dataErrors",{count:e.errorCount})),1)])],8,c)):(0,o.Q3)("",!0)]),_:1})]))}}),g=n(1241);const m=(0,g.A)(f,[["__scopeId","data-v-16034dd4"]]);var h=m,v=n(5384),x=n(1412);const I={class:"excel-upload-container"},w=["disabled"],y={key:0,class:"material-icons-outlined function-button-icon"},C={key:1,class:"material-icons-outlined function-button-icon loading-spinner"},b={class:"upload-text"};var E=(0,o.pM)({__name:"ExcelUploadButton",props:{isUploading:{type:Boolean,default:!1},uploadProgress:{default:0}},emits:["file-selected"],setup(e,{emit:t}){const n=e,a=t,i=(0,l.KR)(null);function s(){!n.isUploading&&i.value&&i.value.click()}function d(e){const t=e.target,n=t.files?.[0];n&&a("file-selected",n),t.value=""}return(e,t)=>((0,o.uX)(),(0,o.CE)("div",I,[(0,o.Lk)("input",{ref_key:"fileInput",ref:i,type:"file",accept:".xlsx,.xls",tabindex:"-1",onChange:d,style:{display:"none"}},null,544),(0,o.Lk)("button",{onClick:s,disabled:e.isUploading,class:(0,r.C4)(["function-button",{uploading:e.isUploading}]),tabindex:"-1"},[e.isUploading?((0,o.uX)(),(0,o.CE)("span",C," hourglass_empty ")):((0,o.uX)(),(0,o.CE)("span",y," file_upload ")),(0,o.Lk)("span",b,(0,r.v_)(e.isUploading?e.$t("dataInput.excel.processing",{progress:e.uploadProgress}):e.$t("dataInput.excel.importData")),1)],10,w)]))}});const S=(0,g.A)(E,[["__scopeId","data-v-bb23315e"]]);var R=S;const M={class:"function-bar"},_={class:"cell-info-section"},k={class:"cell-id"},D={class:"value-label"},$=["aria-label","onKeydown"],T={class:"undo-redo-buttons"},V=["disabled","aria-label"],F=["disabled","aria-label"],K={class:"action-buttons"},A={class:"button-group filter-status"},O={class:"control-button-wrapper"},L=["aria-label"],P={class:"button-label"},N={class:"filter-badge"},B={class:"button-group column-toggles"},W={class:"control-button-wrapper"},U=["aria-label"],z={class:"button-label"},Y={class:"control-button-wrapper",style:{"margin-left":"2px"}},X=["aria-label"],H={class:"button-label"},q={class:"button-group data-io"},j={class:"control-button-wrapper"},G=["aria-label"],J={class:"button-label"},Q={class:"control-button-wrapper"},Z=["aria-label"],ee={class:"button-label"},te={class:"button-group sheet-editing"},ne={class:"control-button-wrapper"},oe=["aria-label"],le={class:"button-label"},ae={class:"control-button-wrapper"},ie=["aria-label"],re={class:"button-label"},se={class:"control-button-wrapper"},de=["aria-label"],ce={class:"button-label"};var ue=(0,o.pM)({__name:"VirtualFunctionBar",props:{cellAddress:{default:""},cellValue:{default:""},isUploadingExcel:{type:Boolean,default:!1},uploadProgress:{default:0},canUndo:{type:Boolean,default:!1},canRedo:{type:Boolean,default:!1},isFiltered:{type:Boolean,default:!1},filteredRowCount:{default:0},originalRowCount:{default:0}},emits:["update-cell-value","enter-pressed","excel-file-selected","download-template","export-data","copy-entire-data","delete-empty-cols","reset-sheet","toggle-exposure-col","toggle-confirmed-case-col","undo","redo","clear-all-filters"],setup(e,{emit:t}){const n=e,a=t,{t:s}=(0,v.s9)(),d=(0,x.C)(),c=(0,l.KR)(n.cellValue),u=(0,l.KR)(!1),p=(0,o.EW)(()=>d.isIndividualExposureColumnVisible),f=(0,o.EW)(()=>d.isConfirmedCaseColumnVisible),g=(0,l.KR)(null),m=(0,l.KR)(!1),h=(0,l.KR)(""),I=(0,l.KR)({x:0,y:0}),w=(0,o.EW)(()=>({position:"fixed",left:`${I.value.x}px`,top:`${I.value.y}px`,transform:"translateX(-50%)",zIndex:10002}));function y(e,t,n){if("template"===e)return;g.value=e,m.value=!1,h.value=t;const l=n.currentTarget,a=l.getBoundingClientRect(),i=a.bottom+5,r={x:a.left+a.width/2,y:i};I.value={x:r.x,y:r.y},(0,o.dY)(()=>{const e=document.querySelector(".function-bar-tooltip");if(!e)return;const t=e.getBoundingClientRect(),n=10;let o=r.x;o+t.width/2>window.innerWidth-n&&(o=window.innerWidth-t.width/2-n),o-t.width/2<n&&(o=t.width/2+n),I.value={x:o,y:r.y},m.value=!0})}function C(){g.value=null,m.value=!1}(0,o.wB)(()=>n.cellValue,e=>{c.value=e});let b=null;function E(){clearTimeout(b),u.value=!0}function S(){b=setTimeout(()=>{u.value=!1},200)}function ue(){a("update-cell-value",c.value)}function pe(){a("enter-pressed")}function fe(e){a("excel-file-selected",e)}function ge(){a("export-data")}function me(){a("copy-entire-data")}function he(){a("delete-empty-cols")}function ve(){a("reset-sheet")}function xe(){a("toggle-exposure-col")}function Ie(){a("toggle-confirmed-case-col")}function we(e){u.value=!1,a("download-template",e)}function ye(){a("undo")}function Ce(){a("redo")}function be(){C(),a("clear-all-filters")}return(e,t)=>((0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("nav",M,[(0,o.Lk)("div",_,[(0,o.Lk)("span",k,(0,r.v_)(e.cellAddress),1),t[16]||(t[16]=(0,o.Lk)("span",{class:"dropdown-arrow"},"▾",-1)),t[17]||(t[17]=(0,o.Lk)("span",{class:"pipe-separator"},null,-1)),(0,o.Lk)("span",D,(0,r.v_)(e.$t("dataInput.functionBar.valueLabel")),1),(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),class:"current-cell-input","aria-label":e.$t("dataInput.functionBar.currentCellValue"),tabindex:"-1",onInput:ue,onKeydown:(0,i.jR)((0,i.D$)(pe,["prevent"]),["enter"])},null,40,$),[[i.Jo,c.value]]),(0,o.Lk)("div",T,[(0,o.Lk)("button",{class:"undo-redo-button",disabled:!e.canUndo,"aria-label":e.$t("dataInput.functionBar.undo"),tabindex:"-1",onClick:ye,onMouseenter:t[1]||(t[1]=t=>y("undo",`${e.$t("dataInput.functionBar.undo")} (Ctrl+Z)`,t)),onMouseleave:C},t[14]||(t[14]=[(0,o.Lk)("span",{class:"material-icons-outlined"}," undo ",-1)]),40,V),(0,o.Lk)("button",{class:"undo-redo-button",disabled:!e.canRedo,"aria-label":e.$t("dataInput.functionBar.redo"),tabindex:"-1",onClick:Ce,onMouseenter:t[2]||(t[2]=t=>y("redo",`${e.$t("dataInput.functionBar.redo")} (Ctrl+Y)`,t)),onMouseleave:C},t[15]||(t[15]=[(0,o.Lk)("span",{class:"material-icons-outlined"}," redo ",-1)]),40,F)])]),(0,o.Lk)("div",K,[e.isFiltered?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",A,[(0,o.Lk)("div",O,[(0,o.Lk)("button",{class:(0,r.C4)(["function-button filter-button",{active:e.isFiltered}]),"aria-label":e.$t("dataInput.functionBar.filter"),tabindex:"-1",onClick:be,onMouseenter:t[3]||(t[3]=t=>y("filter",e.$t("dataInput.functionBar.filterTooltip",{filtered:e.filteredRowCount,total:e.originalRowCount}),t)),onMouseleave:C},[t[18]||(t[18]=(0,o.Lk)("span",{class:"material-icons-outlined function-button-icon"}," filter_list ",-1)),(0,o.Lk)("span",P,(0,r.v_)(e.$t("dataInput.functionBar.filter")),1),(0,o.Lk)("span",N,(0,r.v_)(e.$t("dataInput.functionBar.filterApplied")),1)],42,L)])]),t[19]||(t[19]=(0,o.Lk)("div",{class:"button-group-divider"},null,-1))],64)):(0,o.Q3)("",!0),(0,o.Lk)("div",B,[(0,o.Lk)("div",W,[(0,o.Lk)("button",{class:(0,r.C4)(["function-button",{active:f.value}]),"aria-label":e.$t("dataInput.functionBar.confirmedCase"),tabindex:"-1",onClick:Ie,onMouseenter:t[4]||(t[4]=t=>y("toggleConfirmedCase",e.$t("dataInput.functionBar.toggleConfirmedTooltip"),t)),onMouseleave:C},[t[20]||(t[20]=(0,o.Lk)("span",{class:"material-icons-outlined function-button-icon"}," verified_user ",-1)),(0,o.Lk)("span",z,(0,r.v_)(e.$t("dataInput.functionBar.confirmedCase")),1)],42,U)]),(0,o.Lk)("div",Y,[(0,o.Lk)("button",{class:(0,r.C4)(["function-button",{active:p.value}]),"aria-label":e.$t("dataInput.functionBar.exposure"),tabindex:"-1",onClick:xe,onMouseenter:t[5]||(t[5]=t=>y("toggleExposure",e.$t("dataInput.functionBar.toggleExposureTooltip"),t)),onMouseleave:C},[t[21]||(t[21]=(0,o.Lk)("span",{class:"material-icons-outlined function-button-icon"}," access_time ",-1)),(0,o.Lk)("span",H,(0,r.v_)(e.$t("dataInput.functionBar.exposure")),1)],42,X)])]),t[27]||(t[27]=(0,o.Lk)("div",{class:"button-group-divider"},null,-1)),(0,o.Lk)("div",q,[(0,o.Lk)("div",j,[(0,o.Lk)("div",{onMouseenter:t[6]||(t[6]=t=>y("excelUpload",e.$t("dataInput.functionBar.excelUploadTooltip"),t)),onMouseleave:C},[(0,o.bF)(R,{"is-uploading":e.isUploadingExcel,"upload-progress":e.uploadProgress,onFileSelected:fe},null,8,["is-uploading","upload-progress"])],32)]),(0,o.Lk)("div",{class:"control-button-wrapper",style:{position:"relative"},onMouseenter:E,onMouseleave:S},[(0,o.Lk)("button",{class:"function-button","aria-label":e.$t("dataInput.functionBar.downloadTemplate"),tabindex:"-1"},[t[22]||(t[22]=(0,o.Lk)("span",{class:"material-icons-outlined function-button-icon"}," description ",-1)),(0,o.Lk)("span",J,(0,r.v_)(e.$t("dataInput.functionBar.downloadTemplate")),1)],8,G),u.value?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"template-menu",onMouseenter:E,onMouseleave:S,onClick:t[9]||(t[9]=(0,i.D$)(()=>{},["stop"]))},[(0,o.Lk)("button",{class:"template-menu-button",tabindex:"-1",onClick:t[7]||(t[7]=e=>we("basic"))},(0,r.v_)(e.$t("dataInput.functionBar.basicTemplate")),1),(0,o.Lk)("button",{class:"template-menu-button",tabindex:"-1",onClick:t[8]||(t[8]=e=>we("individual"))},(0,r.v_)(e.$t("dataInput.functionBar.individualTemplate")),1)],32)):(0,o.Q3)("",!0)],32),(0,o.Lk)("div",Q,[(0,o.Lk)("button",{class:"function-button","aria-label":e.$t("dataInput.functionBar.exportData"),tabindex:"-1",onClick:ge,onMouseenter:t[10]||(t[10]=t=>y("exportData",e.$t("dataInput.functionBar.exportTooltip"),t)),onMouseleave:C},[t[23]||(t[23]=(0,o.Lk)("span",{class:"material-icons-outlined function-button-icon"}," file_download ",-1)),(0,o.Lk)("span",ee,(0,r.v_)(e.$t("dataInput.functionBar.exportData")),1)],40,Z)])]),t[28]||(t[28]=(0,o.Lk)("div",{class:"button-group-divider"},null,-1)),(0,o.Lk)("div",te,[(0,o.Lk)("div",ne,[(0,o.Lk)("button",{class:"function-button","aria-label":e.$t("dataInput.functionBar.copyAll"),tabindex:"-1",onClick:me,onMouseenter:t[11]||(t[11]=t=>y("copyData",e.$t("dataInput.functionBar.copyTooltip"),t)),onMouseleave:C},[t[24]||(t[24]=(0,o.Lk)("span",{class:"material-icons-outlined function-button-icon"}," content_copy ",-1)),(0,o.Lk)("span",le,(0,r.v_)(e.$t("dataInput.functionBar.copyAll")),1)],40,oe)]),(0,o.Lk)("div",ae,[(0,o.Lk)("button",{class:"function-button","aria-label":e.$t("dataInput.functionBar.deleteEmptyCols"),tabindex:"-1",onClick:he,onMouseenter:t[12]||(t[12]=t=>y("deleteEmptyCols",e.$t("dataInput.functionBar.deleteEmptyTooltip"),t)),onMouseleave:C},[t[25]||(t[25]=(0,o.Lk)("span",{class:"material-icons-outlined function-button-icon"}," delete_outline ",-1)),(0,o.Lk)("span",re,(0,r.v_)(e.$t("dataInput.functionBar.deleteEmptyCols")),1)],40,ie)]),(0,o.Lk)("div",se,[(0,o.Lk)("button",{class:"function-button","aria-label":e.$t("dataInput.functionBar.resetSheet"),tabindex:"-1",onClick:ve,onMouseenter:t[13]||(t[13]=t=>y("resetSheet",e.$t("dataInput.functionBar.resetTooltip"),t)),onMouseleave:C},[t[26]||(t[26]=(0,o.Lk)("span",{class:"material-icons-outlined function-button-icon"}," refresh ",-1)),(0,o.Lk)("span",ce,(0,r.v_)(e.$t("dataInput.functionBar.resetSheet")),1)],40,de)])]),t[29]||(t[29]=(0,o.Lk)("div",{class:"button-group undo-redo"},null,-1))])]),((0,o.uX)(),(0,o.Wv)(o.Im,{to:"body"},[g.value?((0,o.uX)(),(0,o.CE)("div",{key:0,class:(0,r.C4)(["function-bar-tooltip",{visible:m.value}]),style:(0,r.Tr)(w.value)},(0,r.v_)(h.value),7)):(0,o.Q3)("",!0)]))],64))}});const pe=(0,g.A)(ue,[["__scopeId","data-v-7d9d97df"]]);var fe=pe,ge=n(2261);const me=(0,ge.nY)("ui",{state:()=>({nextCellToFocus:null}),actions:{focusNextCell({rowIndex:e,columnIndex:t}){this.nextCellToFocus={rowIndex:e,columnIndex:t}},clearNextCellFocus(){this.nextCellToFocus=null}}}),he={role:"row"},ve=["onContextmenu"],xe={class:"relative w-full h-full flex items-center justify-center"},Ie=["innerHTML"],we={key:0,class:"absolute top-[2px] right-[4px] w-[14px] h-[14px] inline-flex items-center justify-center z-[3] pointer-events-auto bg-blue-50/50 rounded-[2px] p-[1px] cursor-default transition-all border border-transparent","aria-hidden":"true"},ye=["colspan"],Ce={key:0,class:"absolute top-1/2 left-[5px] -translate-y-1/2 flex gap-[3px] items-center z-[2]"},be=["onClick","aria-label"],Ee=["onClick","disabled","onMouseenter","aria-label"],Se={role:"row"},Re=["data-col","data-validation-message","contenteditable","onInput","onDblclick","onMousedown","onMousemove","onContextmenu","title"],Me={class:"header-text"},_e={key:0,class:"absolute top-[2px] right-[4px] w-[14px] h-[14px] inline-flex items-center justify-center z-[3] pointer-events-auto bg-blue-50/50 rounded-[2px] p-[1px] cursor-default transition-all border border-transparent","aria-hidden":"true"};var ke=(0,o.pM)({__name:"VirtualGridHeader",props:{headerGroups:{},allColumnsMeta:{},tableWidth:{},selectedCell:{default:()=>({rowIndex:null,colIndex:null})},selectedRange:{default:()=>({start:{rowIndex:null,colIndex:null},end:{rowIndex:null,colIndex:null}})},isEditing:{type:Boolean,default:!1},editingCell:{default:()=>({rowIndex:null,colIndex:null})},individualSelectedCells:{default:null},scrollbarWidth:{default:0},activeFilters:{default:()=>new Map},isFiltered:{type:Boolean,default:!1}},emits:["cell-mousedown","cell-mousemove","cell-dblclick","cell-input","cell-contextmenu","add-column","delete-column"],setup(e,{expose:t,emit:n}){const{t:a}=(0,v.s9)(),s=(me(),e),d=(0,l.KR)(null),c=(0,l.KR)(null),u=(0,l.KR)(""),p=(0,l.Kh)({});function f(e,t){return s.isEditing&&s.editingCell?.rowIndex===e&&s.editingCell?.colIndex===t}function g(e,t){const{start:n,end:o}=s.selectedRange;if(null===n.rowIndex||null===o.rowIndex||null===n.colIndex||null===o.colIndex)return!1;const l=Math.min(n.rowIndex,o.rowIndex),a=Math.max(n.rowIndex,o.rowIndex),i=Math.min(n.colIndex,o.colIndex),r=Math.max(n.colIndex,o.colIndex);return e>=l&&e<=a&&t>=i&&t<=r}function m(e){return!(!e||null===e.start.rowIndex)&&(e.start.rowIndex!==e.end.rowIndex||e.start.colIndex!==e.end.colIndex)}function h(e,t){const n=[];if(f(e,t))return n.push("cell-editing"),n;if(s.individualSelectedCells&&s.individualSelectedCells.has(`${e}_${t}`)&&n.push("cell-multi-selected"),!g(e,t))return n;m(s.selectedRange)&&n.push("cell-range-selected");const{start:o,end:l}=s.selectedRange;if(null!==o.rowIndex&&null!==l.rowIndex&&null!==o.colIndex&&null!==l.colIndex){const a=Math.min(o.rowIndex,l.rowIndex),i=Math.max(o.rowIndex,l.rowIndex),r=Math.min(o.colIndex,l.colIndex),s=Math.max(o.colIndex,l.colIndex);e===a&&n.push("border-top"),e===i&&n.push("border-bottom"),t===r&&n.push("border-left"),t===s&&n.push("border-right")}return s.selectedCell&&s.selectedCell.rowIndex===e&&s.selectedCell.colIndex===t&&(m(s.selectedRange)?n.push("cell-active-in-range"):n.push("cell-selected")),n}function x(){return""}const I=e=>1===e.startColIndex||2===e.startColIndex?e.text:String(e.text).replace(/<br\s*\/?>/gi," ");function w(e,t,n){const o=n.currentTarget,l=o.getBoundingClientRect();u.value=t,p.left=`${l.left+l.width/2}px`,p.top=`${l.bottom+5}px`,p.transform="translateX(-50%)",c.value=e}function y(){c.value=null}t({headerContainer:d});const C=(0,o.EW)(()=>({paddingRight:s.scrollbarWidth>0?`${s.scrollbarWidth}px`:"0px",paddingBottom:"0px"})),b=e=>{const t=s.activeFilters||window.storeBridge?.filterState?.activeFilters;if(!t||0===t.size)return!1;const n=s.allColumnsMeta.find(t=>t.colIndex===e);if(t.has(String(e)))return!0;if(n)if(n.dataKey&&void 0!==n.cellIndex&&null!==n.cellIndex){if(t.has(`${n.dataKey}-${n.cellIndex}`))return!0}else if(n.dataKey&&t.has(n.dataKey))return!0;return!1};return(e,t)=>((0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("div",{class:"grid-header-virtual flex-none relative z-10 box-border shadow-sm border-b border-gray-200 overflow-hidden bg-slate-50",ref_key:"headerContainer",ref:d,style:(0,r.Tr)(C.value)},[(0,o.Lk)("table",{class:"border-collapse table-fixed w-full",style:(0,r.Tr)({width:e.tableWidth})},[(0,o.Lk)("colgroup",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.allColumnsMeta,e=>((0,o.uX)(),(0,o.CE)("col",{key:e.colIndex,style:(0,r.Tr)(e.style)},null,4))),128))]),(0,o.Lk)("thead",null,[(0,o.Lk)("tr",he,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.headerGroups,(n,l)=>((0,o.uX)(),(0,o.CE)(o.FK,{key:"header-group-"+l},[2===n.rowspan?((0,o.uX)(),(0,o.CE)("th",{key:0,rowspan:"2",style:(0,r.Tr)(n.style),role:"columnheader",class:(0,r.C4)(["relative border border-slate-300 p-2 text-center font-medium text-sm bg-clip-padding align-middle whitespace-nowrap select-none tracking-tight leading-[1.4] group",{"whitespace-normal":1===n.startColIndex||2===n.startColIndex,"!bg-slate-100 !font-semibold":0===n.startColIndex}]),onContextmenu:(0,i.D$)(t=>e.$emit("cell-contextmenu",t,-1,n.startColIndex),["prevent"])},[(0,o.Lk)("div",xe,[(0,o.Lk)("span",{innerHTML:I(n)},null,8,Ie)]),b(n.startColIndex)?((0,o.uX)(),(0,o.CE)("span",we,t[1]||(t[1]=[(0,o.Lk)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#1976d2","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,o.Lk)("polygon",{points:"22,3 2,3 10,12.46 10,19 14,21 14,12.46"})],-1)]))):(0,o.Q3)("",!0)],46,ve)):((0,o.uX)(),(0,o.CE)("th",{key:1,colspan:n.colspan,class:"bg-slate-100 relative h-[35px] border border-slate-300 p-2 text-center font-medium text-sm bg-clip-padding align-middle whitespace-nowrap select-none tracking-tight leading-[1.4]",role:"columnheader"},[(0,o.eW)((0,r.v_)(I(n))+" ",1),n.addable||n.deletable?((0,o.uX)(),(0,o.CE)("div",Ce,[n.addable?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:(0,i.D$)(t=>e.$emit("add-column",n.type),["stop"]),onMouseenter:t[0]||(t[0]=t=>w("add",e.$t("dataInput.tooltips.addColumn"),t)),onMouseleave:y,class:"inline-flex items-center justify-center w-[22px] h-[22px] min-w-[22px] bg-white/90 border border-slate-300 rounded text-[13px] font-semibold text-slate-500 cursor-pointer transition-all duration-200 select-none p-0 leading-none shadow-[0_1px_2px_rgba(0,0,0,0.05)] hover:bg-blue-50 hover:border-blue-600 hover:text-blue-600 hover:scale-105 hover:shadow-md active:bg-blue-100 active:scale-95 active:shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-1","aria-label":`${n.text} ${e.$t("dataInput.tooltips.addColumn")}`}," + ",40,be)):(0,o.Q3)("",!0),n.deletable?((0,o.uX)(),(0,o.CE)("button",{key:1,onClick:(0,i.D$)(t=>e.$emit("delete-column",n.type),["stop"]),disabled:n.columnCount<=1,onMouseenter:t=>w("delete",n.columnCount<=1?e.$t("dataInput.tooltips.minColumn"):e.$t("dataInput.tooltips.deleteColumn"),t),onMouseleave:y,class:"inline-flex items-center justify-center w-[22px] h-[22px] min-w-[22px] bg-white/90 border border-slate-300 rounded text-[13px] font-semibold text-slate-500 cursor-pointer transition-all duration-200 select-none p-0 leading-none shadow-[0_1px_2px_rgba(0,0,0,0.05)] hover:bg-red-50 hover:border-red-600 hover:text-red-600 hover:scale-105 hover:shadow-md active:bg-red-100 active:scale-95 active:shadow-sm disabled:opacity-40 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-1","aria-label":`${n.text} ${e.$t("dataInput.tooltips.deleteColumn")}`}," - ",40,Ee)):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0)],8,ye))],64))),128))]),(0,o.Lk)("tr",Se,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.allColumnsMeta,n=>((0,o.uX)(),(0,o.CE)(o.FK,{key:"header-th-"+n.colIndex},[2===n.headerRow?((0,o.uX)(),(0,o.CE)("th",{key:0,class:(0,r.C4)(["relative border border-slate-300 p-2 text-center font-medium text-sm bg-clip-padding align-middle whitespace-nowrap select-none tracking-tight leading-[1.4] bg-slate-50 cursor-default h-[35px] hover:bg-slate-200 group",h(-1,n.colIndex)]),role:"columnheader","data-col":n.colIndex,"data-validation-message":x(),contenteditable:f(-1,n.colIndex),onInput:t=>e.$emit("cell-input",t,-1,n.colIndex),onDblclick:t=>e.$emit("cell-dblclick",-1,n.colIndex,t),onMousedown:t=>e.$emit("cell-mousedown",-1,n.colIndex,t),onMousemove:t=>e.$emit("cell-mousemove",-1,n.colIndex,t),onContextmenu:(0,i.D$)(t=>e.$emit("cell-contextmenu",t,-1,n.colIndex),["prevent"]),title:n.tooltip},[(0,o.Lk)("span",Me,(0,r.v_)(n.headerText),1),b(n.colIndex)?((0,o.uX)(),(0,o.CE)("span",_e,t[2]||(t[2]=[(0,o.Lk)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#1976d2","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,o.Lk)("polygon",{points:"22,3 2,3 10,12.46 10,19 14,21 14,12.46"})],-1)]))):(0,o.Q3)("",!0)],42,Re)):(0,o.Q3)("",!0)],64))),128))])])],4)],4),((0,o.uX)(),(0,o.Wv)(o.Im,{to:"body"},[c.value?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"fixed bg-[#333] text-white px-2 py-1.5 rounded text-xs whitespace-nowrap z-[10000] pointer-events-none opacity-0 animate-[tooltipFadeIn_0.2s_ease_forwards]",style:(0,r.Tr)(p)},(0,r.v_)(u.value),5)):(0,o.Q3)("",!0)]))],64))}});const De=(0,g.A)(ke,[["__scopeId","data-v-307897b2"]]);var $e=De;const Te={class:"add-rows-controls"},Ve=["title"],Fe=["disabled","aria-label","onKeydown"],Ke={class:"add-rows-label"},Ae=["aria-label"];var Oe=(0,o.pM)({__name:"AddRowsControls",props:{isFiltered:{type:Boolean,default:!1}},emits:["add-rows","delete-empty-rows","clear-selection"],setup(e,{emit:t}){const{t:n}=(0,v.s9)(),a=e,s=t,d=(0,l.KR)(10);function c(){a.isFiltered||d.value>=1&&(s("add-rows",d.value),d.value=10)}function u(){s("delete-empty-rows")}return(e,t)=>((0,o.uX)(),(0,o.CE)("div",Te,[(0,o.Lk)("span",{class:(0,r.C4)(["add-rows-button",{disabled:e.isFiltered}]),onClick:c,title:e.isFiltered?(0,l.R1)(n)("dataInput.bottomActions.filterTooltip"):(0,l.R1)(n)("dataInput.bottomActions.atBottom")+" "+(0,l.R1)(n)("dataInput.bottomActions.addRows")},(0,r.v_)((0,l.R1)(n)("dataInput.bottomActions.atBottom")),11,Ve),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),type:"number",min:"1",class:"rows-count-input",disabled:e.isFiltered,"aria-label":(0,l.R1)(n)("dataInput.bottomActions.addRows"),tabindex:"-1",onFocus:t[1]||(t[1]=e=>s("clear-selection")),onKeydown:(0,i.jR)((0,i.D$)(c,["prevent"]),["enter"])},null,40,Fe),[[i.Jo,d.value,void 0,{number:!0}]]),(0,o.Lk)("span",Ke,(0,r.v_)((0,l.R1)(n)("dataInput.bottomActions.addRows")),1),(0,o.Lk)("button",{class:"delete-empty-rows-button","aria-label":(0,l.R1)(n)("dataInput.bottomActions.deleteEmpty"),tabindex:"-1",onClick:u},[t[2]||(t[2]=(0,o.Lk)("span",{class:"material-icons-outlined delete-empty-rows-button-icon"},"delete_outline",-1)),(0,o.eW)(" "+(0,r.v_)((0,l.R1)(n)("dataInput.bottomActions.deleteEmpty")),1)],8,Ae)]))}});const Le=(0,g.A)(Oe,[["__scopeId","data-v-17f21407"]]);var Pe=Le;function Ne(e){if(!e)return null;const t=e.dataKey||"",n=e.type||"",o=null!==e.cellIndex&&void 0!==e.cellIndex?e.cellIndex:"",l=e.group||"";if("individualExposureTime"===n)return`exposure_${t}_${o}`;if("isConfirmedCase"===n)return"confirmed_case";if("patientId"===n)return"patient_id";if("patientName"===n)return"patient_name";const a=[t,n,""===o?null:o,l].filter(e=>null!==e&&void 0!==e&&""!==e);return a.join("__")}function Be(e,t){return`${e}_${t}`}function We(e){const t=e.split("_");if(t.length<2)return null;const n=parseInt(t[0]),o=t.slice(1).join("_");return{rowIndex:n,uniqueKey:o}}function Ue(e,t,n,o){if(!o||!n)return!1;const l=Ne(n);if(!l)return!1;const a=Be(e,l);return o.has(a)}const ze={debug:(e,t)=>{}};class Ye{filterMappings;isFiltered;filteredRows;rowMappings;deletedRowIndices;addedRowIndices;combinedMappings;validationErrors;debug;constructor(){this.filterMappings=new Map,this.isFiltered=!1,this.filteredRows=[],this.rowMappings=new Map,this.deletedRowIndices=[],this.addedRowIndices=[],this.combinedMappings=new Map,this.validationErrors=new Map,this.debug=!1}updateFilterState(e,t,n){this.isFiltered=e,this.filteredRows=t||[],this.validationErrors=n||new Map,this._updateFilterMappings(),this._updateCombinedMappings(),this.debug&&ze.debug("[FilterRowValidationManager] 필터 상태 업데이트:",{isFiltered:e,filteredRowsCount:this.filteredRows.length,validationErrorsCount:this.validationErrors.size})}handleRowChanges(e,t){this.deletedRowIndices=e||[],this.addedRowIndices=t||[],this._updateRowMappings(),this._updateCombinedMappings(),this.debug&&ze.debug("[FilterRowValidationManager] 행 변경 처리:",{deletedRowIndices:this.deletedRowIndices,addedRowIndices:this.addedRowIndices})}isErrorVisible(e){if(!this.isFiltered)return this._isRowVisibleAfterChanges(e);const t=this.filteredRows.some(t=>t._originalIndex===e);return!!t&&this._isRowVisibleAfterChanges(e)}getVisibleErrors(){if(!this.isFiltered&&0===this.deletedRowIndices.length)return this.validationErrors;const e=new Map;return this.validationErrors.forEach((t,n)=>{const o=n.split("_"),l=o[0],a=o.slice(1).join("_"),i=parseInt(l,10),r=this._getActualRowIndexAfterChanges(i);if(null===r)return;if(this.isFiltered){const e=this.filteredRows.some(e=>e._originalIndex===i);if(!e)return}const s=`${r}_${a}`;e.set(s,t)}),e}getErrorMessage(e,t,n){if(!n)return null;const o=this._generateColumnUniqueKey(n),l=`${e}_${o}`;return this.validationErrors.get(l)||null}getRemappedErrors(e){if(!e||0===e.size)return new Map;const t=new Map;return e.forEach((e,n)=>{const o=n.split("_"),l=o[0],a=o.slice(1).join("_"),i=parseInt(l,10),r=this._getNewRowIndexAfterChanges(i);if(null!==r){const n=`${r}_${a}`;t.set(n,e)}}),t}setDebugMode(e){this.debug=e}getStateInfo(){return{isFiltered:this.isFiltered,filteredRowsCount:this.filteredRows.length,deletedRowIndices:this.deletedRowIndices,addedRowIndices:this.addedRowIndices,validationErrorsCount:this.validationErrors.size,filterMappingsSize:this.filterMappings.size,rowMappingsSize:this.rowMappings.size,combinedMappingsSize:this.combinedMappings.size}}_updateFilterMappings(){this.filterMappings.clear(),this.isFiltered&&this.filteredRows.length&&this.filteredRows.forEach((e,t)=>{void 0!==e._originalIndex&&this.filterMappings.set(e._originalIndex,t)})}_updateRowMappings(){this.rowMappings.clear(),0===this.deletedRowIndices.length&&0===this.addedRowIndices.length||this.deletedRowIndices.forEach(e=>{this.rowMappings.set(e,null)})}_updateCombinedMappings(){this.combinedMappings.clear()}_getOriginalRowIndex(e){if(!this.isFiltered)return e;const t=this.filteredRows[e];return t&&void 0!==t._originalIndex?t._originalIndex:e}_getActualRowIndexAfterChanges(e){if(this.deletedRowIndices.includes(e))return null;const t=this.deletedRowIndices.filter(t=>t<e).length;return e-t}_getNewRowIndexAfterChanges(e){return this._getActualRowIndexAfterChanges(e)}_isRowVisibleAfterChanges(e){return!this.deletedRowIndices.includes(e)}_generateColumnUniqueKey(e){return e?"serial"===e.type?"serial":"isPatient"===e.type?"isPatient":"isConfirmedCase"===e.type?"isConfirmedCase":"individualExposureTime"===e.type?"individualExposureTime":"symptomOnset"===e.type?"symptomOnset":e.dataKey&&null!==e.cellIndex&&void 0!==e.cellIndex?`${e.dataKey}_${e.cellIndex}`:e.dataKey?e.dataKey:"":""}}const Xe=["data-row"],He=["data-row","data-col","data-validation-message","contenteditable","onInput","onDblclick","onMousedown","onMousemove","onContextmenu","onMouseenter"],qe=40,je=6;var Ge=(0,o.pM)({__name:"VirtualGridBody",props:{visibleRows:{},allColumnsMeta:{},tableWidth:{},totalHeight:{},paddingTop:{},getCellValue:{},selectedCell:{default:()=>({rowIndex:null,colIndex:null})},selectedRange:{default:()=>({start:{rowIndex:null,colIndex:null},end:{rowIndex:null,colIndex:null}})},isEditing:{type:Boolean,default:!1},editingCell:{default:()=>({rowIndex:null,colIndex:null})},individualSelectedCells:{default:null},individualSelectedRows:{default:null},bufferSize:{default:4},validationErrors:{default:null},isFiltered:{type:Boolean,default:!1}},emits:["scroll","cell-mousedown","cell-mousemove","cell-dblclick","cell-input","cell-contextmenu","add-rows","delete-empty-rows","clear-selection"],setup(e,{expose:t,emit:n}){const a=e,s=n,d=(0,l.KR)(null),c=new Ye,u=(0,o.EW)(()=>a.totalHeight+je),p=(0,o.EW)(()=>a.totalHeight+je+qe),f=(0,l.KR)(!1),g=(0,l.KR)(""),m=(0,l.KR)({});function h(e){s("scroll",e)}function v(e,t){const{start:n,end:o}=a.selectedRange;if(null===n.rowIndex||null===o.rowIndex||null===n.colIndex||null===o.colIndex)return!1;const l=Math.min(n.rowIndex,o.rowIndex),i=Math.max(n.rowIndex,o.rowIndex),r=Math.min(n.colIndex,o.colIndex),s=Math.max(n.colIndex,o.colIndex);return e>=l&&e<=i&&t>=r&&t<=s}function x(e,t){return a.isEditing&&a.editingCell?.rowIndex===e&&a.editingCell?.colIndex===t}function I(e){return!(!e||null===e.start.rowIndex)&&(e.start.rowIndex!==e.end.rowIndex||e.start.colIndex!==e.end.colIndex)}function w(e,t){const n=[];0===t&&(a.isFiltered?n.push("!bg-blue-500/20 !text-blue-700 !font-medium !border-gray-300 z-[2]"):n.push("!bg-slate-100 !font-medium !border-gray-300 z-[2]"));const o=a.allColumnsMeta.length-1;if(x(e,t))return n.push("cell-editing"),n;const l=a.individualSelectedRows&&a.individualSelectedRows.has(e);if(l){n.push("row-individual-selected");const l=!a.individualSelectedRows?.has(e-1),i=!a.individualSelectedRows?.has(e+1);l&&n.push("border-top"),i&&n.push("border-bottom"),0===t&&n.push("border-left"),t===o&&n.push("border-right")}if(a.individualSelectedCells&&a.individualSelectedCells.has(`${e}_${t}`)&&n.push("cell-multi-selected"),!l&&v(e,t)){I(a.selectedRange)&&n.push("cell-range-selected");const{start:o,end:l}=a.selectedRange;if(null!==o.rowIndex&&null!==l.rowIndex&&null!==o.colIndex&&null!==l.colIndex){const a=Math.min(o.rowIndex,l.rowIndex),i=Math.max(o.rowIndex,l.rowIndex),r=Math.min(o.colIndex,l.colIndex),s=Math.max(o.colIndex,l.colIndex);e===a&&n.push("border-top"),e===i&&n.push("border-bottom"),t===r&&n.push("border-left"),t===s&&n.push("border-right")}}a.selectedCell&&a.selectedCell.rowIndex===e&&a.selectedCell.colIndex===t&&(I(a.selectedRange)?n.push("cell-active-in-range"):n.push("cell-selected"));const i=a.allColumnsMeta[t],r=Ue(e,t,i,a.validationErrors);c.updateFilterState(a.isFiltered,a.visibleRows,a.validationErrors);const s=c.isErrorVisible(e);return r&&s&&n.push("validation-error"),n}function y(e,t){const n=a.allColumnsMeta[t];return c.getErrorMessage(e,t,n)}function C(e,t,n){const o=a.visibleRows[t];let l;l=a.isFiltered?void 0!==o._originalIndex?o._originalIndex:void 0!==o._filteredOriginalIndex?o._filteredOriginalIndex:o.originalIndex||0:o.originalIndex||0;const i=y(Number(l),Number(n));if(i){const t=e.target,n=t.getBoundingClientRect();g.value=i,m.value={position:"fixed",top:n.top-40+"px",left:`${n.left+n.width/2}px`,transform:"translateX(-50%)",zIndex:"1000"},f.value=!0}}function b(){f.value=!1}function E(e,t,n){let o=0;a.isFiltered?void 0!==t._originalIndex?o=Number(t._originalIndex):void 0!==t._filteredOriginalIndex?o=Number(t._filteredOriginalIndex):void 0!==t.originalIndex&&(o=Number(t.originalIndex)):o=Number(t.originalIndex||0),s("cell-input",e,o,Number(n))}function S(e,t,n){const o=a.visibleRows[e];let l=0;l=a.isFiltered?void 0!==o._originalIndex?Number(o._originalIndex):void 0!==o._filteredOriginalIndex?Number(o._filteredOriginalIndex):Number(o.originalIndex||0):Number(o.originalIndex||0),s("cell-dblclick",l,Number(t),n)}function R(e,t,n){const o=a.visibleRows[e];let l=0;l=a.isFiltered?void 0!==o._originalIndex?Number(o._originalIndex):void 0!==o._filteredOriginalIndex?Number(o._filteredOriginalIndex):Number(o.originalIndex||0):Number(o.originalIndex||0),s("cell-mousedown",l,Number(t),n)}function M(e,t,n){const o=a.visibleRows[e];let l=0;l=a.isFiltered?void 0!==o._originalIndex?Number(o._originalIndex):void 0!==o._filteredOriginalIndex?Number(o._filteredOriginalIndex):Number(o.originalIndex||0):Number(o.originalIndex||0),s("cell-mousemove",l,Number(t),n)}function _(e,t,n){const o=a.visibleRows[t];let l=0;l=a.isFiltered?void 0!==o._originalIndex?Number(o._originalIndex):void 0!==o._filteredOriginalIndex?Number(o._filteredOriginalIndex):Number(o.originalIndex||0):Number(o.originalIndex||0),s("cell-contextmenu",e,l,Number(n))}return t({bodyContainer:d}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",{class:(0,r.C4)(["grid-body-virtual overflow-auto relative flex-1 min-h-0 bg-slate-50 will-change-scroll",{relative:e.isFiltered}]),ref_key:"bodyContainer",ref:d,onScrollPassive:h},[(0,o.Lk)("div",{style:(0,r.Tr)({height:p.value+"px",position:"relative",width:e.tableWidth})},[(0,o.Lk)("table",{class:"border-collapse table-fixed absolute top-0 left-0 z-[1] w-full",style:(0,r.Tr)({transform:`translateY(${e.paddingTop}px)`,width:e.tableWidth})},[(0,o.Lk)("colgroup",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.allColumnsMeta,e=>((0,o.uX)(),(0,o.CE)("col",{key:e.colIndex,style:(0,r.Tr)(e.style)},null,4))),128))]),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.visibleRows,(t,n)=>((0,o.uX)(),(0,o.CE)("tr",{key:t.originalIndex,"data-row":t.originalIndex,class:"h-[35px] max-h-[35px] min-h-[35px]"},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.allColumnsMeta,l=>((0,o.uX)(),(0,o.CE)("td",{key:l.colIndex,"data-row":t.originalIndex,"data-col":l.colIndex,class:(0,r.C4)(["border border-gray-300 px-2 text-sm whitespace-nowrap overflow-hidden text-ellipsis box-border bg-clip-padding text-center align-middle cursor-default h-[35px] !p-0",w(Number(t.originalIndex),Number(l.colIndex)),{"bg-white":!x(Number(t.originalIndex),Number(l.colIndex))}]),"data-validation-message":y(Number(t.originalIndex),Number(l.colIndex)),contenteditable:x(Number(t.originalIndex),Number(l.colIndex)),onInput:e=>E(e,t,Number(l.colIndex)),onDblclick:e=>S(n,Number(l.colIndex),e),onMousedown:e=>R(n,Number(l.colIndex),e),onMousemove:e=>M(n,Number(l.colIndex),e),onContextmenu:(0,i.D$)(e=>_(e,n,Number(l.colIndex)),["prevent"]),onMouseenter:e=>C(e,n,Number(l.colIndex)),onMouseleave:b},(0,r.v_)(e.getCellValue(t,l,Number(t.originalIndex))),43,He))),128))],8,Xe))),128))])],4),(0,o.Lk)("div",{class:"py-1.5 bg-transparent z-[2]",style:(0,r.Tr)({position:"absolute",top:u.value+"px",left:0,width:"100%"})},[(0,o.bF)(Pe,{onAddRows:t[0]||(t[0]=t=>e.$emit("add-rows",t)),onDeleteEmptyRows:t[1]||(t[1]=t=>e.$emit("delete-empty-rows")),onClearSelection:t[2]||(t[2]=t=>e.$emit("clear-selection"))})],4)],4),f.value?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"fixed bg-[#333] text-white px-2.5 py-1.5 rounded text-xs whitespace-nowrap z-[1000] pointer-events-none shadow-lg after:content-[''] after:absolute after:top-full after:left-1/2 after:-translate-x-1/2 after:border-[6px] after:border-t-[#333] after:border-transparent",style:(0,r.Tr)(m.value)},(0,r.v_)(g.value),5)):(0,o.Q3)("",!0)],34))}});const Je=(0,g.A)(Ge,[["__scopeId","data-v-78285b4b"]]);var Qe=Je;const Ze={key:0,class:"context-menu-separator"},et=["onClick"],tt=["checked"],nt={class:"context-menu-text"},ot={key:0,class:"context-menu-count"},lt=["onClick"],at={key:0,class:"context-menu-icon material-icons"},it={class:"context-menu-text"},rt={key:1,class:"context-menu-shortcut"};var st=(0,o.pM)({__name:"ContextMenu",props:{visible:{type:Boolean,default:!1},x:{default:0},y:{default:0},items:{default:()=>[]}},emits:["select"],setup(e,{emit:t}){const n=e,a=t,s=(0,l.KR)(null),d=(0,l.Kh)({x:0,y:0,opacity:0,transformOrigin:"top left"}),c=(0,o.EW)(()=>({left:`${d.x}px`,top:`${d.y}px`,opacity:d.opacity,transformOrigin:d.transformOrigin})),u=()=>{if(!s.value)return;const e=parseFloat(getComputedStyle(document.body).zoom)||1,t=s.value.offsetWidth,o=s.value.offsetHeight,l=window.innerWidth/e,a=window.innerHeight/e,i=8;let r=n.x,c=n.y,u="left",p="top";n.x+t>l-i?(r=n.x-t,u="right"):(r=n.x,u="left"),r<i&&(r=i),n.y+o>a-i?(c=n.y-o,p="bottom"):(c=n.y,p="top"),c<i&&(c=i),d.x=r,d.y=c;const f=n.x-r,g=n.y-c;d.transformOrigin=`${f}px ${g}px`,d.opacity=1};(0,o.wB)(()=>[n.visible,n.x,n.y],([e])=>{e&&(d.opacity=0,(0,o.dY)(u))},{immediate:!0});const p=e=>{e.disabled||a("select",e.action)},f=e=>{const t=e.match(/^(.+?)\s*\(\d+\)$/);return t?t[1]:e},g=e=>{const t=e.match(/\((\d+)\)$/);return t?`${t[1]}개`:""};return(e,t)=>e.visible?((0,o.uX)(),(0,o.CE)("div",{key:0,ref_key:"menuRef",ref:s,class:"context-menu",style:(0,r.Tr)(c.value),onContextmenu:t[0]||(t[0]=(0,i.D$)(()=>{},["prevent"])),onMousedown:t[1]||(t[1]=(0,i.D$)(()=>{},["stop"]))},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.items,(e,t)=>((0,o.uX)(),(0,o.CE)(o.FK,{key:t},["separator"===e.type?((0,o.uX)(),(0,o.CE)("div",Ze)):"checkbox"===e.type?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"context-menu-item",onClick:t=>p(e)},[(0,o.Lk)("input",{type:"checkbox",checked:e.checked,readonly:"",style:{"margin-right":"6px","pointer-events":"none"}},null,8,tt),(0,o.Lk)("span",nt,(0,r.v_)(f(e.label)),1),g(e.label)?((0,o.uX)(),(0,o.CE)("span",ot,(0,r.v_)(g(e.label)),1)):(0,o.Q3)("",!0)],8,et)):((0,o.uX)(),(0,o.CE)("div",{key:2,class:(0,r.C4)(["context-menu-item",{"is-disabled":e.disabled,"is-danger":e.danger}]),onClick:t=>p(e)},[e.icon?((0,o.uX)(),(0,o.CE)("span",at,(0,r.v_)(e.icon),1)):(0,o.Q3)("",!0),(0,o.Lk)("span",it,(0,r.v_)(e.label),1),e.shortcut?((0,o.uX)(),(0,o.CE)("span",rt,(0,r.v_)(e.shortcut),1)):(0,o.Q3)("",!0)],10,lt))],64))),128))],36)):(0,o.Q3)("",!0)}});const dt=(0,g.A)(st,[["__scopeId","data-v-45dda3d0"]]);var ct=dt;const ut={key:0,class:"drag-overlay"},pt={class:"overlay-content"},ft={class:"text"},gt={key:0,class:"progress"};var mt=(0,o.pM)({__name:"DragOverlay",props:{visible:{type:Boolean,default:!1},progress:{default:0}},setup(e){return(e,t)=>((0,o.uX)(),(0,o.Wv)(i.eB,{name:"fade"},{default:(0,o.k6)(()=>[e.visible?((0,o.uX)(),(0,o.CE)("div",ut,[(0,o.Lk)("div",pt,[t[0]||(t[0]=(0,o.Lk)("span",{class:"material-icons-outlined icon"},"cloud_upload",-1)),(0,o.Lk)("p",ft,(0,r.v_)(e.$t("dataInput.overlay.dropExcel")),1),e.progress>0&&e.progress<100?((0,o.uX)(),(0,o.CE)("p",gt,(0,r.v_)(e.progress)+"%",1)):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0)]),_:1}))}});const ht=(0,g.A)(mt,[["__scopeId","data-v-0a1da7a4"]]);var vt=ht,xt=n(4956),It=(0,o.pM)({__name:"CellEditOverlay",props:{visible:{type:Boolean,default:!1},position:{default:()=>({top:0,left:0,width:100,height:35})},value:{default:""},rowIndex:{default:-1},colIndex:{default:-1},selectOnFocus:{type:Boolean,default:!0}},emits:["update:value","confirm","cancel","input","move-next-row","move-next-cell"],setup(e,{expose:t,emit:n}){const a=e,s=n,d=(0,l.KR)(null),c=(0,l.KR)(null),u=(0,l.KR)(""),p=(0,l.KR)(0);function f(){s("input",u.value),g()}function g(){c.value&&(p.value=c.value.offsetWidth+26)}(0,o.wB)(()=>a.value,e=>{u.value=e,(0,o.dY)(g)},{immediate:!0}),(0,o.wB)(()=>a.visible,async e=>{e&&(u.value=a.value,await(0,o.dY)(),g(),setTimeout(()=>{if(d.value)if(d.value.focus(),a.selectOnFocus)d.value.select();else try{d.value.selectionStart=d.value.value.length,d.value.selectionEnd=d.value.value.length}catch(e){}},10))});const m=(0,o.EW)(()=>{const e=Math.max(a.position.width,p.value);return{position:"fixed",top:`${a.position.top}px`,left:`${a.position.left}px`,width:`${e}px`,height:`${a.position.height}px`,zIndex:1e4}});function h(e){e.stopPropagation(),"Enter"===e.key?(e.preventDefault(),s("confirm",u.value),s("move-next-row")):"Tab"===e.key?(e.preventDefault(),s("confirm",u.value),s("move-next-cell")):"Escape"===e.key&&(e.preventDefault(),s("cancel"))}return t({inputRef:d}),(e,t)=>((0,o.uX)(),(0,o.Wv)(o.Im,{to:"body"},[(0,o.bo)((0,o.Lk)("div",{class:"cell-edit-overlay",style:(0,r.Tr)(m.value),onClick:t[1]||(t[1]=(0,i.D$)(()=>{},["stop"])),onMousedown:t[2]||(t[2]=(0,i.D$)(()=>{},["stop"]))},[(0,o.bo)((0,o.Lk)("input",{ref_key:"inputRef",ref:d,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),class:"edit-input",type:"text",onKeydown:h,onInput:f},null,544),[[i.Jo,u.value]]),(0,o.Lk)("span",{ref_key:"measureRef",ref:c,class:"width-measure"},(0,r.v_)(u.value||" "),513)],36),[[i.aG,e.visible]])]))}});const wt=(0,g.A)(It,[["__scopeId","data-v-5e8b8262"]]);var yt=wt,Ct=n(1335);const bt="epidemiology_filter_state",Et=(0,ge.nY)("grid",()=>{const e=(0,Ct.X)(),t=(0,l.Kh)(new Map),n=(0,l.KR)([]),a=(0,l.KR)([]),i=(0,l.KR)(!1),r=(0,l.KR)(null),s=(0,l.KR)(null),d=(0,l.KR)(null),c=(0,l.KR)(null),u=(0,l.KR)(null),p=(0,o.EW)(()=>t.size>0&&n.value.length>0?n.value.map(t=>e.rows[t]).filter(Boolean):t.size>0&&0===n.value.length?[]:e.rows),f=(0,o.EW)(()=>t.size>0),g=(0,o.EW)(()=>({isFiltered:f.value,filteredRowCount:f.value?n.value.length:e.rows.length,originalRowCount:e.rows.length,activeFilters:t}));function m(e,n){0===n.length?t.delete(e):t.set(e,n),w(),y()}function h(e,n){const o=t.get(e)||[],l=o.indexOf(n);let a;a=-1===l?[...o,n]:o.filter(e=>e!==n),m(e,a)}function v(e){t.delete(e),w(),y()}function x(){t.clear(),w(),y()}function I(e,t,n){const o=Array.isArray(n)?n:n.values;if(!o||0===o.length)return!0;let l="";if("isPatient"===String(t))l=null===e.isPatient||void 0===e.isPatient?"":String(e.isPatient);else if("isConfirmedCase"===String(t))l=null===e.isConfirmedCase||void 0===e.isConfirmedCase?"":String(e.isConfirmedCase);else{if("symptomOnset"===String(t)||"individualExposureTime"===String(t)){const n="symptomOnset"===String(t)?e.symptomOnset:e.individualExposureTime,l=null===n||void 0===n?"":String(n);return o.some(e=>""===e?""===l:l.startsWith(e))}{const n=String(t).split("-");if(2===n.length){const[t,o]=n,a=parseInt(o,10),i=e[t];if(Array.isArray(i)){const e=i[a];void 0!==e&&(l=String(e))}}else l=String(e[t]??"")}}return o.includes(l)}function w(){if(0===t.size)return n.value=[],void(a.value=[]);const o=[],l=[];e.rows.forEach((e,n)=>{let a=!0;for(const[o,l]of t)if(!I(e,o,l)){a=!1;break}a?(o.push(n),l[n]=o.length-1):l[n]=-1}),n.value=o,a.value=l}function y(){const e=Object.fromEntries(t);localStorage.setItem(bt,JSON.stringify(e))}function C(){try{const e=localStorage.getItem(bt);if(e){const n=JSON.parse(e);for(const e in n)t.set(e,n[e]);w()}}catch(e){console.error("Failed to load filter state",e)}}function b(e,t,n,o){i.value&&S(),i.value=!0,r.value={rowIndex:e,colIndex:t,dataKey:o.dataKey,cellIndex:o.cellIndex},s.value=n,d.value=n,c.value={...o},u.value=Date.now()}function E(e){i.value&&(d.value=e)}function S(){if(!i.value||!r.value||!c.value)return null;const e={cell:{...r.value},originalValue:s.value,tempValue:d.value,columnMeta:{...c.value},editDuration:u.value?Date.now()-u.value:0};return _(),e}function R(){if(!i.value||!r.value||!c.value)return null;const e={cell:{...r.value},originalValue:s.value,value:d.value,columnMeta:{...c.value},editDuration:u.value?Date.now()-u.value:0,hasChanged:s.value!==d.value};return _(),e}function M(e=!0){e?R():S()}function _(){i.value=!1,r.value=null,s.value=null,d.value=null,c.value=null,u.value=null}function k(e){return 0===t.size?e:n.value[e]??-1}return(0,o.wB)(()=>e.rows,()=>{t.size>0&&w()},{deep:!0}),C(),{activeFilters:t,isEditing:i,currentCell:r,tempValue:d,filteredRows:p,isFiltered:f,filterState:g,setFilter:m,clearFilter:v,clearAllFilters:x,startEditing:b,updateTempValue:E,cancelEditing:S,confirmEditing:R,stopEditing:M,getActualRowIndex:k,toggleFilterValue:h,matchesFilter:I}}),St="epidemiology_history",Rt=15;function Mt(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return console.warn("[HistoryStore] deepClone failed:",t),e}}const _t=(0,ge.nY)("history",()=>{const e=(0,l.KR)([]),t=(0,l.KR)([]),n=(0,l.KR)(!1),a=(0,l.KR)(Rt),i=(0,o.EW)(()=>e.value.length>0),r=(0,o.EW)(()=>t.value.length>0);function s(){const e=(0,Ct.X)(),t=(0,x.C)();return{version:"2.0",timestamp:Date.now(),headers:Mt(e.headers),rows:Mt(e.rows),settings:{isIndividualExposureColumnVisible:t.isIndividualExposureColumnVisible,isConfirmedCaseColumnVisible:t.isConfirmedCaseColumnVisible},validationState:{version:e.validationState.version,errors:new Map(e.validationState.errors)}}}function d(o="unknown",l={}){if(n.value)return;const i=s(),r=e.value[e.value.length-1];if(r&&JSON.stringify(r.data)===JSON.stringify(i))return;const d={timestamp:Date.now(),action:o,data:i,meta:l};e.value.push(d),t.value=[],e.value.length>a.value&&e.value.shift(),g()}function c(){if(0===e.value.length)return;n.value=!0;const o=e.value.pop();if(o){const e=s(),n={timestamp:Date.now(),action:"undo_save",data:e};t.value.push(n),f(o.data),g()}n.value=!1}function u(){if(0===t.value.length)return;n.value=!0;const o=t.value.pop();if(o){const t=s(),n={timestamp:Date.now(),action:"redo_save",data:t};e.value.push(n),f(o.data),g()}n.value=!1}function p(){e.value=[],t.value=[],g()}function f(e){const t=(0,Ct.X)();(0,x.C)();if(e.headers&&e.rows&&t.setInitialData({headers:e.headers,rows:e.rows}),e.validationState){let n=new Map;const o=e.validationState.errors;o instanceof Map?n=o:"object"===typeof o&&null!==o&&Object.entries(o).forEach(([e,t])=>n.set(e,t)),t.setValidationErrors(n)}}function g(){try{const n={version:"2.0",lastSaved:Date.now(),undoStack:e.value,redoStack:t.value},o=(e,t)=>t instanceof Map?{dataType:"Map",value:Array.from(t.entries())}:t;localStorage.setItem(St,JSON.stringify(n,o))}catch(n){console.error("[HistoryStore] persist error:",n)}}function m(){try{const n=localStorage.getItem(St);if(!n)return;const o=(e,t)=>"object"===typeof t&&null!==t&&"Map"===t.dataType?new Map(t.value):t,l=JSON.parse(n,o);Array.isArray(l?.undoStack)&&(e.value=l.undoStack),Array.isArray(l?.redoStack)&&(t.value=l.redoStack)}catch(n){console.warn("[HistoryStore] load failed, resetting history",n),e.value=[],t.value=[]}}return m(),{undoStack:e,redoStack:t,isRestoring:n,canUndo:i,canRedo:r,captureSnapshot:d,undo:c,redo:u,clear:p}});function kt(){return{basic:["",""],clinical:["","","","",""],diet:Array(30).fill("")}}function Dt(e){return{isPatient:"",basicInfo:Array(e?.basic?.length||2).fill(""),clinicalSymptoms:Array(e?.clinical?.length||5).fill(""),symptomOnset:"",individualExposureTime:"",dietInfo:Array(e?.diet?.length||30).fill(""),isConfirmedCase:""}}function $t(){const e=kt(),t=Array.from({length:10},()=>Dt(e));return{version:"1.0",timestamp:Date.now(),headers:e,rows:t,settings:{isIndividualExposureColumnVisible:!1,isConfirmedCaseColumnVisible:!1}}}function Tt(e){if(!e||"object"!==typeof e)return console.warn("[Recovery] 헤더 데이터가 유효하지 않아 기본값으로 복구합니다."),kt();const t={basic:Array.isArray(e.basic)?e.basic:["",""],clinical:Array.isArray(e.clinical)?e.clinical:["","","","",""],diet:Array.isArray(e.diet)?e.diet:Array(30).fill("")};return t.basic=t.basic.map(e=>e||""),t.clinical=t.clinical.map(e=>e||""),t.diet=t.diet.map(e=>e||""),t}function Vt(e,t){if(!Array.isArray(e))return Array(t).fill("");const n=[...e];while(n.length<t)n.push("");return n.length>t&&n.splice(t),n.map(e=>null===e||void 0===e?"":String(e))}function Ft(e,t){return Array.isArray(e)?e.map((e,n)=>{if(!e||"object"!==typeof e)return console.warn(`[Recovery] 행 ${n}가 유효하지 않아 기본값으로 복구합니다.`),Dt(t);const o={isPatient:e.isPatient||"",basicInfo:Vt(Array.isArray(e.basicInfo)?e.basicInfo:[],t?.basic?.length||2),clinicalSymptoms:Vt(Array.isArray(e.clinicalSymptoms)?e.clinicalSymptoms:[],t?.clinical?.length||5),symptomOnset:e.symptomOnset||"",individualExposureTime:e.individualExposureTime||"",dietInfo:Vt(Array.isArray(e.dietInfo)?e.dietInfo:[],t?.diet?.length||30),isConfirmedCase:e.isConfirmedCase||""};return o}):(console.warn("[Recovery] 행 데이터가 유효하지 않아 기본값으로 복구합니다."),Array.from({length:10},()=>Dt(t)))}function Kt(e){return e&&"object"===typeof e?{isIndividualExposureColumnVisible:Boolean(e.isIndividualExposureColumnVisible),isConfirmedCaseColumnVisible:Boolean(e.isConfirmedCaseColumnVisible)}:{isIndividualExposureColumnVisible:!1,isConfirmedCaseColumnVisible:!1}}function At(e){try{if(!e||"object"!==typeof e)return console.warn("[Recovery] 데이터가 유효하지 않아 기본값으로 복구합니다."),$t();const t=Tt(e.headers),n={version:e.version||"1.0",timestamp:e.timestamp||Date.now(),headers:t,rows:Ft(e.rows,t),settings:Kt(e.settings),validationState:e.validationState};return n}catch(t){return console.error("[Recovery] 데이터 복구 중 오류 발생:",t),$t()}}function Ot(){try{const e=localStorage.getItem("headers"),t=localStorage.getItem("rows"),n=localStorage.getItem("isIndividualExposureColumnVisible"),o=localStorage.getItem("isConfirmedCaseColumnVisible");if(!e||!t)return console.warn("[Recovery] localStorage에 데이터가 없어 기본값을 사용합니다."),$t();const l=JSON.parse(e),a=JSON.parse(t),i=!!n&&JSON.parse(n),r=!!o&&JSON.parse(o),s={headers:l,rows:a,settings:{isIndividualExposureColumnVisible:i,isConfirmedCaseColumnVisible:r}};return At(s)}catch(e){return console.error("[Recovery] localStorage 로드 중 오류 발생:",e),$t()}}class Lt{legacyStore;epidemicStore;historyStore;userManager;currentUser;saveTimeout;SAVE_DELAY;pendingSaves;isProcessing;isInitialized;constructor(e=null,t=null){this.legacyStore=e,this.epidemicStore=null,this.userManager=t,this.currentUser=null,this.saveTimeout=null,this.SAVE_DELAY=300,this.pendingSaves=new Map,this.isProcessing=!1,this.isInitialized=!1;try{this.epidemicStore=(0,Ct.X)(),this.historyStore=_t()}catch(n){console.warn("[EnhancedStorageManager] Pinia store not ready in constructor.")}}setStore(e){this.epidemicStore=e;try{this.historyStore||(this.historyStore=_t())}catch(t){console.warn("[EnhancedStorageManager] Failed to init historyStore in setStore")}console.log("[EnhancedStorageManager] Epidemic store set.")}setLegacyStore(e){this.legacyStore=e,console.log("[EnhancedStorageManager] Legacy store set (Deprecated).")}setUserManager(e){this.userManager=e}setCurrentUser(e){this.currentUser=e}getUserDataKey(){if(!this.currentUser)return"epidemiology_data";const e=this.currentUser.name||this.currentUser.username||"user";return this.userManager?.getUserDataKey(e)||"epidemiology_data"}scheduleSave(e){const t=`${e.cell.rowIndex}_${e.cell.colIndex}`,n=this.pendingSaves.get(t);n&&clearTimeout(n.timeoutId);const o=setTimeout(()=>{const e=this.pendingSaves.get(t);e&&(this.executeSave(e.editData),this.pendingSaves.delete(t))},this.SAVE_DELAY);this.pendingSaves.set(t,{editData:e,timeoutId:o,scheduledAt:Date.now()})}executeSave(e){if(!this.epidemicStore&&!this.legacyStore)return;const{cell:t,value:n}=e,{rowIndex:o,dataKey:l,cellIndex:a}=t;this.epidemicStore?(this.historyStore&&this.historyStore.captureSnapshot("cell_edit",{cell:e.cell,from:e.originalValue,to:e.value}),this.epidemicStore.updateCell({rowIndex:o,key:l,value:n,cellIndex:a??void 0})):this.legacyStore&&this.legacyStore.dispatch("epidemic/updateCell",{rowIndex:o,key:l,value:n,cellIndex:a})}processPendingSaves(){if(0!==this.pendingSaves.size){for(const[,e]of this.pendingSaves)clearTimeout(e.timeoutId),this.executeSave(e.editData);this.pendingSaves.clear()}}cancelPendingSaves(){for(const[,e]of this.pendingSaves)clearTimeout(e.timeoutId);this.pendingSaves.clear()}setSaveDelay(e){this.SAVE_DELAY=e,console.log(`[EnhancedStorageManager] 저장 지연 시간이 ${e}ms로 설정되었습니다.`)}reset(){this.cancelPendingSaves(),this.isProcessing=!1,this.isInitialized=!1,console.log("[EnhancedStorageManager] 저장 매니저가 초기화되었습니다.")}loadData(){try{const t=this.getUserDataKey(),n=localStorage.getItem(t);if(n){const e=JSON.parse(n);return this.isInitialized=!0,e}console.log("[EnhancedStorageManager] 새로운 형식의 데이터가 없습니다. 레거시 데이터 마이그레이션을 시도합니다.");const o=Ot();if(!o)return null;const l=localStorage.getItem("exposureDateTime")||"",a=localStorage.getItem("selectedSuspectedFoods")||"";let i;try{const e=localStorage.getItem("epidemicCurveSettings");e&&(i=JSON.parse(e))}catch(e){}let r={caseControl:[],cohort:[]};try{const e=localStorage.getItem("analysisResults");e&&(r=JSON.parse(e))}catch(e){}let s={caseControl:!1,cohort:!1};try{const e=localStorage.getItem("yatesCorrectionSettings");e&&(s=JSON.parse(e))}catch(e){}const d={version:"2.0",timestamp:Date.now(),headers:o.headers,rows:o.rows,settings:{isIndividualExposureColumnVisible:o.settings.isIndividualExposureColumnVisible,isConfirmedCaseColumnVisible:o.settings.isConfirmedCaseColumnVisible,exposureDateTime:l,selectedSuspectedFoods:a,epidemicCurveSettings:i,analysisResults:r,yatesCorrectionSettings:s,selectedSymptomInterval:6,selectedIncubationInterval:6,suspectedSource:"",analysisOptions:{statMethod:"chi-square",haldaneCorrection:!1}}};return console.log("[EnhancedStorageManager] 레거시 데이터 마이그레이션 성공. 새로운 형식으로 저장합니다."),this.saveData(d),this.isInitialized=!0,d}catch(t){return console.error("[EnhancedStorageManager] 데이터 로드 중 오류 발생:",t),null}}saveData(e){try{const t={version:"2.0",timestamp:Date.now(),userId:this.currentUser?.id||this.currentUser?.name||this.currentUser?.username,...e},n=this.getUserDataKey();return localStorage.setItem(n,JSON.stringify(t)),!0}catch(t){return console.error("[EnhancedStorageManager] 데이터 저장 중 오류 발생:",t),!1}}saveCurrentState(){if(!this.epidemicStore&&!this.legacyStore)return console.error("[EnhancedStorageManager] Store 인스턴스가 설정되지 않았습니다."),!1;let e,t,n,o={};if(this.epidemicStore){e=this.epidemicStore.headers,t=this.epidemicStore.rows,n=this.epidemicStore.validationState;const l=(0,x.C)();o={...l.$state}}else{const l=this.legacyStore.state;e=l.epidemic.headers,t=l.epidemic.rows,n=l.epidemic.validationState,o=l.settings}const l={};if(n?.errors&&n.errors instanceof Map)for(const[i,r]of n.errors.entries())l[i]={message:r.message||"유효성 검사 오류",timestamp:r.timestamp||Date.now()};else n?.errors&&"object"===typeof n.errors&&Object.assign(l,n.errors);const a={headers:e,rows:t,settings:{isIndividualExposureColumnVisible:o.isIndividualExposureColumnVisible,isConfirmedCaseColumnVisible:o.isConfirmedCaseColumnVisible,selectedSymptomInterval:o.selectedSymptomInterval,exposureDateTime:o.exposureDateTime,selectedIncubationInterval:o.selectedIncubationInterval,analysisOptions:o.analysisOptions,yatesCorrectionSettings:o.yatesCorrectionSettings,selectedSuspectedFoods:o.selectedSuspectedFoods,epidemicCurveSettings:o.epidemicCurveSettings,suspectedSource:o.suspectedSource,analysisResults:o.analysisResults},validationState:{errors:l,version:n?.version||0}};return this.saveData(a)}}var Pt=n(3103);const Nt=(0,l.Kh)({visible:!1,x:0,y:0,items:[],target:null});function Bt(){const e=(e,t,n,o)=>{Nt.visible=!0,Nt.x=e,Nt.y=t,Nt.items=n,Nt.target=o},t=()=>{Nt.visible=!1,Nt.items=[],Nt.target=null};return{contextMenuState:(0,l.tB)(Nt),showContextMenu:e,hideContextMenu:t}}function Wt(){const e=(0,l.Kh)({selectedCell:{rowIndex:null,colIndex:null},selectionAnchor:{rowIndex:null,colIndex:null},selectedRange:{start:{rowIndex:null,colIndex:null},end:{rowIndex:null,colIndex:null}},isDragging:!1,dragContext:null,isEditing:!1,editingCell:{rowIndex:null,colIndex:null},originalCellValue:null,selectedCellsIndividual:new Set,selectedRowsIndividual:new Set});function t(t,n){e.selectedCell={rowIndex:t,colIndex:n},e.selectionAnchor={rowIndex:t,colIndex:n},e.selectedRange={start:{rowIndex:t,colIndex:n},end:{rowIndex:t,colIndex:n}}}function n(t,n){const o=n.length>0?n.length-1:0;e.selectedCell={rowIndex:t,colIndex:0},e.selectionAnchor={rowIndex:t,colIndex:0},e.selectedRange.start={rowIndex:t,colIndex:0},e.selectedRange.end={rowIndex:t,colIndex:o}}function o(t){e.isDragging=!0;const{rowIndex:n}=e.selectionAnchor;null!==n&&(e.dragContext=0===t?"row":n<0?"header":"body")}function a(t,n,o){if(!e.isDragging||null===e.selectionAnchor.rowIndex||null===e.selectionAnchor.colIndex)return;let l,a,i,r,s=t;"header"===e.dragContext&&s>=0?s=-1:"body"===e.dragContext&&s<0&&(s=0),"row"===e.dragContext?(l=Math.min(e.selectionAnchor.rowIndex,s),a=Math.max(e.selectionAnchor.rowIndex,s),i=0,r=o.length-1):(l=Math.min(e.selectionAnchor.rowIndex,s),a=Math.max(e.selectionAnchor.rowIndex,s),i=Math.min(e.selectionAnchor.colIndex,n),r=Math.max(e.selectionAnchor.colIndex,n)),e.selectedRange.start={rowIndex:l,colIndex:i},e.selectedRange.end={rowIndex:a,colIndex:r},e.selectedCell={rowIndex:s,colIndex:n}}function i(){null!==e.selectedRange.start.rowIndex&&null!==e.selectedRange.start.colIndex&&(e.selectedCell={rowIndex:e.selectedRange.start.rowIndex,colIndex:e.selectedRange.start.colIndex}),e.isDragging=!1,e.dragContext=null}function r(){e.selectedCell={rowIndex:null,colIndex:null},e.selectionAnchor={rowIndex:null,colIndex:null},e.selectedRange={start:{rowIndex:null,colIndex:null},end:{rowIndex:null,colIndex:null}},e.selectedCellsIndividual.clear(),e.selectedRowsIndividual.clear()}function s(n,o){if(null===e.selectionAnchor.rowIndex||null===e.selectionAnchor.colIndex)return void t(n,o);const l=e.selectionAnchor,a=Math.min(l.rowIndex,n),i=Math.max(l.rowIndex,n),r=Math.min(l.colIndex,o),s=Math.max(l.colIndex,o);e.selectedRange.start={rowIndex:a,colIndex:r},e.selectedRange.end={rowIndex:i,colIndex:s},e.selectedCell={rowIndex:n,colIndex:o}}function d(t,n,o,l){e.selectedRange.start={rowIndex:t,colIndex:n},e.selectedRange.end={rowIndex:o,colIndex:l},e.selectedCell={rowIndex:t,colIndex:n},e.selectionAnchor={rowIndex:t,colIndex:n}}function c(t,n,o,l,a=null,i=null){if(e.isEditing&&e.editingCell.rowIndex===t&&e.editingCell.colIndex===n)return;let r;if(e.isEditing&&u(!0),r=i?i.find(e=>e.colIndex===n):zt(n),!r||!r.isEditable)return;const s=o(l,r,t);e.originalCellValue=s,a&&a.startEditing(t,n,s,r),e.isEditing=!0,e.editingCell={rowIndex:t,colIndex:n}}function u(t=!0,n=null){if(!e.isEditing)return;const{rowIndex:o,colIndex:l}=e.editingCell,a=e.originalCellValue;n&&(t?n.stopEditing(!0):n.cancelEditing()),e.isEditing=!1,e.editingCell={rowIndex:null,colIndex:null},e.originalCellValue=null;try{let e=null;if(null!==o&&null!==l&&(e=o<0?`[data-col="${l}"]`:`[data-row="${o}"][data-col="${l}"]`),e){const n=document.querySelector(e);n&&(n.removeAttribute("contenteditable"),n.blur(),t||null===a||(n.textContent=String(a??"")))}const n=window.getSelection();n&&n.removeAllRanges&&n.removeAllRanges()}catch(i){console.warn("[VirtualSelection] stopEditing DOM cleanup failed:",i)}}function p(t,n){const o=`${t}_${n}`;e.selectedCellsIndividual.has(o)?e.selectedCellsIndividual.delete(o):e.selectedCellsIndividual.add(o)}function f(t){e.selectedRowsIndividual.has(t)?e.selectedRowsIndividual.delete(t):e.selectedRowsIndividual.add(t)}function g(){e.selectedCellsIndividual.clear(),e.selectedRowsIndividual.clear()}function m(t,n){e.selectedRowsIndividual.clear();const[o,l]=t<=n?[t,n]:[n,t];for(let a=o;a<=l;a++)e.selectedRowsIndividual.add(a)}return{state:(0,l.tB)(e),selectCell:t,selectRow:n,startDrag:o,updateDragSelection:a,endDragSelection:i,clearSelection:r,extendSelection:s,setSelectionRange:d,startEditing:c,stopEditing:u,toggleIndividualCell:p,toggleIndividualRow:f,selectRowRange:m,clearIndividualSelections:g}}let Ut=[];function zt(e){if(0!==Ut.length)return Ut.find(t=>t.colIndex===e);console.warn("allColumnsMeta is not set. Please ensure it is passed correctly.")}function Yt(e){Ut=e}var Xt=n(2213);const Ht=(0,l.KR)(!1);let qt=0;function jt(e){if(e.preventDefault(),e.stopPropagation(),qt++,e.dataTransfer?.items){const t=Array.from(e.dataTransfer.items).some(e=>"file"===e.kind);t&&(Ht.value=!0)}}function Gt(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}function Jt(e){e.preventDefault(),e.stopPropagation(),qt--,0===qt&&(Ht.value=!1)}function Qt(e){const t=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],n=[".xlsx",".xls"],o=e.name.lastIndexOf("."),l=-1!==o?e.name.toLowerCase().slice(o):"";return t.includes(e.type)||n.includes(l)}function Zt(e,t){if(e.preventDefault(),e.stopPropagation(),Ht.value=!1,qt=0,e.dataTransfer?.files?.length){const n=e.dataTransfer.files[0];Qt(n)?t(n):console.warn("엑셀 파일만 업로드 가능합니다.")}}function en(){function e(e){const t=e=>jt(e),n=e=>Gt(e),o=e=>Jt(e),l=t=>Zt(t,e);return document.addEventListener("dragenter",t),document.addEventListener("dragover",n),document.addEventListener("dragleave",o),document.addEventListener("drop",l),()=>{document.removeEventListener("dragenter",t),document.removeEventListener("dragover",n),document.removeEventListener("dragleave",o),document.removeEventListener("drop",l)}}return{isDragOver:Ht,setupDragDropListeners:e}}const tn=80,nn=0,on=1,ln="serial",an="isPatient",rn="isConfirmedCase",sn="basic",dn="clinical",cn="symptomOnset",un="diet",pn="individualExposureTime",fn={[ln]:{width:"50px"},[an]:{width:"143px"},[rn]:{width:"143px"},[cn]:{width:"150px"},default:{width:`${tn}px`}};class gn{activeOperations;operationQueue;isProcessing;constructor(){this.activeOperations=(0,l.KR)(new Set),this.operationQueue=(0,l.KR)([]),this.isProcessing=(0,l.KR)(!1)}startOperation(e,t={}){const{blocking:n=!0,timeout:o=3e4}=t;return this.activeOperations.value.has(e)?(console.warn(`[GlobalOperationManager] 작업이 이미 실행 중: ${e}`),!1):n&&this.hasBlockingOperations()?(console.warn(`[GlobalOperationManager] 차단 작업이 실행 중이어서 대기: ${e}`),this.operationQueue.value.push({name:e,options:t,timestamp:Date.now()}),!1):(this.activeOperations.value.add(e),o>0&&setTimeout(()=>{this.endOperation(e),console.warn(`[GlobalOperationManager] 작업 타임아웃: ${e}`)},o),console.log(`[GlobalOperationManager] 작업 시작: ${e}`),!0)}endOperation(e){this.activeOperations.value.has(e)&&(this.activeOperations.value.delete(e),console.log(`[GlobalOperationManager] 작업 종료: ${e}`),this.processQueue())}hasBlockingOperations(){return this.activeOperations.value.size>0}isOperationActive(e){return this.activeOperations.value.has(e)}processQueue(){if(!this.isProcessing.value&&0!==this.operationQueue.value.length){this.isProcessing.value=!0;while(this.operationQueue.value.length>0){const e=this.operationQueue.value[0];if(this.hasBlockingOperations())break;this.operationQueue.value.shift(),this.startOperation(e.name,e.options)&&console.log(`[GlobalOperationManager] 큐에서 작업 시작: ${e.name}`)}this.isProcessing.value=!1}}forceEndAllOperations(){console.warn("[GlobalOperationManager] 모든 작업 강제 종료"),this.activeOperations.value.clear(),this.operationQueue.value=[],this.isProcessing.value=!1}getStatus(){return{activeOperations:Array.from(this.activeOperations.value),queueLength:this.operationQueue.value.length,isProcessing:this.isProcessing.value}}getQueuedOperations(){return this.operationQueue.value.map(e=>({name:e.name,waitingTime:Date.now()-e.timestamp}))}}const mn=new gn;var hn=mn;function vn(e={},t){const{showBlockedMessage:n=!0,blockedMessage:l=""}=e,a=l||(t?t("common.operationBlocked"):"또 다른 작업이 진행 중입니다."),i=(0,o.EW)(()=>hn.hasBlockingOperations()),r=(e,t={})=>{const o=hn.startOperation(e,t);return!o&&n&&(0,Xt.P0)(a,"warning"),o},s=e=>{hn.endOperation(e)},d=e=>hn.isOperationActive(e),c=(e,t,n={})=>async(...o)=>{if(!r(e,n))return!1;try{const e=await t(...o);return e}finally{s(e)}},u=async(e,t,n={})=>{if(!r(e,n))return!1;try{return await t(),!0}finally{s(e)}};return{isBlocked:i,tryStartOperation:r,endOperation:s,isOperationActive:d,wrapOperation:c,executeIfNotBlocked:u}}const xn={isPatient:{type:"binary",required:!1,allowEmpty:!0,message:"0 또는 1만 입력 가능합니다."},isConfirmedCase:{type:"binary",required:!1,allowEmpty:!0,message:"0 또는 1만 입력 가능합니다."},basicInfo:{type:"string",maxLength:100,required:!1,allowEmpty:!0,message:""},clinicalSymptoms:{type:"binary",required:!1,allowEmpty:!0,message:"0 또는 1만 입력 가능합니다."},symptomOnset:{type:"datetime",format:"YYYY-MM-DD HH:mm",required:!1,allowEmpty:!0,message:"YYYY-MM-DD HH:mm 형식으로 입력하세요."},individualExposureTime:{type:"datetime",format:"YYYY-MM-DD HH:mm",required:!1,allowEmpty:!0,message:"YYYY-MM-DD HH:mm 형식으로 입력하세요."},dietInfo:{type:"binary",required:!1,allowEmpty:!0,message:"0 또는 1만 입력 가능합니다."}};function In(e){return null===e||void 0===e||("string"===typeof e?""===e.trim():"number"!==typeof e&&(!!Array.isArray(e)&&0===e.length))}function wn(e){if(In(e))return{valid:!0};const t=String(e).trim();return"0"===t||"1"===t?{valid:!0}:{valid:!1,message:"0 또는 1만 입력 가능합니다."}}function yn(e,t){if(In(e))return t.required?{valid:!1,message:"필수 입력 항목입니다."}:{valid:!0};const n=String(e);return t.maxLength&&n.length>t.maxLength?{valid:!1,message:t.message||`최대 ${t.maxLength}자까지 입력 가능합니다.`}:{valid:!0}}function Cn(e,t){if(In(e))return t.required?{valid:!1,message:"필수 입력 항목입니다."}:{valid:!0};const n=String(e).trim(),o=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/;if(!o.test(n))return{valid:!1,message:t.message||"YYYY-MM-DD HH:mm 형식으로 입력하세요."};const l=new Date(n.replace(" ","T"));if(isNaN(l.getTime()))return{valid:!1,message:"올바른 날짜를 입력하세요."};const[a,i]=n.split(" "),[r,s,d]=a.split("-").map(Number),[c,u]=i.split(":").map(Number);return l.getFullYear()!==r||l.getMonth()+1!==s||l.getDate()!==d||l.getHours()!==c||l.getMinutes()!==u?{valid:!1,message:"올바른 날짜를 입력하세요."}:{valid:!0}}function bn(e,t){const n=xn[t];if(!n)return{valid:!0};if(In(e))return n.required?{valid:!1,message:"필수 입력 항목입니다."}:{valid:!0};switch(n.type){case"binary":return wn(e);case"string":{const o=yn(e,n);return"basicInfo"!==t||o.valid?o:{valid:!1,message:""}}case"datetime":return Cn(e,n);default:return{valid:!0}}}const En=e=>{const t=Date.now();return setTimeout(()=>{e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})},1)},Sn="undefined"!==typeof window&&window.requestIdleCallback||En,Rn="undefined"!==typeof window&&window.cancelIdleCallback||(e=>clearTimeout(e));function Mn(e,t,n={}){const{chunkSize:o=100,timeout:l=16,onProgress:a=()=>{},onComplete:i=()=>{},onError:r=()=>{}}=n;let s=0,d=!1,c=null;const u=n=>{if(d)return;const p=performance.now();try{const d=n?n.timeRemaining():l;while(s<e.length&&performance.now()-p<d){const n=e.slice(s,s+o);for(let o=0;o<n.length;o++){const l=n[o],a=s+o;try{t(l,a,e)}catch(f){r(f,a)}}s+=n.length;const l=Math.min(s/e.length*100,100);if(a(l,s,e.length),s%o===0)break}s<e.length?c=Sn(u,{timeout:l}):i(e)}catch(f){r(f)}};return c=Sn(u,{timeout:l}),{cancel:()=>{d=!0,c&&(Rn(c),c=null)},getProgress:()=>({current:s,total:e.length,percentage:s/e.length*100})}}function _n(e,t,n,o={}){const{chunkSize:l=50,onProgress:a=()=>{},onComplete:i=()=>{},onError:r=()=>{}}=o,s=[],d=e.length*t.filter(e=>e.isEditable).length;let c=0;const u=[];e.forEach((e,n)=>{t.forEach(t=>{if(!t.isEditable)return;if(!t.dataKey)return;let o="";if(null!==t.cellIndex&&void 0!==t.cellIndex){const n=e[t.dataKey]||[];o=Array.isArray(n)?n[t.cellIndex]??"":""}else o=e[t.dataKey]??"";u.push({rowIndex:n,colIndex:t.colIndex,value:o,type:t.type})})});const p=e=>{const t=n(e.value,e.type);t.valid||s.push({row:e.rowIndex,col:e.colIndex,message:t.message||"Invalid value"}),c++},f=e=>{a(e,c,d)},g=()=>{i(s)};return Mn(u,p,{chunkSize:l,onProgress:f,onComplete:g,onError:r})}function kn(){return"undefined"!==typeof Worker&&("file:"!==window.location.protocol&&("localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname))}function Dn(e,t={}){if(!kn())return console.log("[WorkerUtils] Worker creation skipped due to environment constraints"),null;try{const n=new Worker(e,{type:"module",...t});return n.onerror=e=>{console.warn("[WorkerUtils] Worker error:",e),n.terminate()},n}catch(n){return console.warn("[WorkerUtils] Failed to create worker:",n),null}}class $n{store;debug;validationTimers;columnMetas;constructor(e,t={}){this.store=e,this.debug=t.debug||!1,this.validationTimers=new Map,this.columnMetas=[]}updateColumnMetas(e){this.columnMetas=e,this.debug&&console.log("[ValidationErrorManager] 열 메타데이터 업데이트:",e.length,"개")}clearErrorsForCells(e=[]){e.forEach(({row:e,col:t})=>{const n=this.columnMetas.find(e=>e.colIndex===t);if(n){const t=Ne(n);if(t){const n=Be(e,t);this.store.removeValidationErrorByUniqueKey({errorKey:n})}}else this.store.removeValidationError({rowIndex:e,colIndex:t})})}clearErrorsForRow(e){const t=[],n=this.store.validationState.errors;for(const o of n.keys()){const n=We(o);n&&n.rowIndex===e&&t.push(o)}t.forEach(e=>{this.store.removeValidationErrorByUniqueKey({errorKey:e})})}clearErrorsForColumn(e){const t=[],n=this.columnMetas.find(t=>t.colIndex===e);if(!n)return;const o=Ne(n);if(!o)return;const l=this.store.validationState.errors;for(const a of l.keys()){const e=We(a);e&&e.uniqueKey===o&&t.push(a)}t.forEach(e=>{this.store.removeValidationErrorByUniqueKey({errorKey:e})})}clearAllErrors(){this.validationTimers.forEach(e=>clearTimeout(e)),this.validationTimers.clear(),this.store.clearValidationErrors()}clearTimers(){this.validationTimers.forEach(e=>clearTimeout(e)),this.validationTimers.clear()}cancelTimer(e){const t=this.validationTimers.get(e);return!!t&&(clearTimeout(t),this.validationTimers.delete(e),!0)}setTimer(e,t,n){const o=setTimeout(()=>{t(),this.validationTimers.delete(e)},n);this.validationTimers.set(e,o)}addError(e,t,n,o){const l=o||this.columnMetas.find(e=>e.colIndex===t);if(l){const t=Ne(l);if(t){const o=Be(e,t);return void this.store.addValidationErrorByUniqueKey({errorKey:o,message:n})}}this.store.addValidationError({rowIndex:e,colIndex:t,message:n})}removeError(e,t,n){const o=n||this.columnMetas.find(e=>e.colIndex===t);if(o){const t=Ne(o);if(t){const n=Be(e,t);return void this.store.removeValidationErrorByUniqueKey({errorKey:n})}}this.store.removeValidationError({rowIndex:e,colIndex:t})}printErrorKeys(e,t){if(!this.debug)return;const n=t||this.store.validationState.errors;console.log(`[ValidationErrorManager] ${e}:`,Array.from(n.keys()))}printErrorDiff(e,t){if(!this.debug)return;const n=Array.from(e.keys()),o=Array.from(t.keys()),l=n.filter(e=>!o.includes(e)),a=o.filter(e=>!n.includes(e));console.log("[ValidationErrorManager] 제거된 에러:",l),console.log("[ValidationErrorManager] 추가된 에러:",a)}printUniqueKeyMapping(e){if(!this.debug)return;const t=e||this.columnMetas,n={};t.forEach(e=>{const t=Ne(e);n[`${e.type}[${e.cellIndex}]`]=t}),console.log("[ValidationErrorManager] 고유 키 매핑:",n)}getErrorCount(){return this.store.validationState.errors.size}createErrorSnapshot(){return new Map(this.store.validationState.errors)}setErrors(e){this.store.setValidationErrors(e)}destroy(){this.clearTimers(),this.columnMetas=[]}}class Tn{store;errorManager;debug;filterRowManager;_validateCellFn;_getCellValueFn;constructor(e,t,n={}){this.store=e,this.errorManager=t,this.debug=n.debug||!1,this.filterRowManager=new Ye,this._validateCellFn=null,this._getCellValueFn=null}setValidateCellFn(e){this._validateCellFn=e}setGetCellValueFn(e){this._getCellValueFn=e}handleRowAddition(e,t,n,o=1){this.reindexErrorsAfterRowAddition(e,o)}reindexErrorsAfterRowAddition(e,t){if(t<=0)return;const n=this.store.validationState.errors;if(!n||0===n.size)return;const o=new Map;for(const[l,a]of n){const n=l.split("_");if(n.length<2){o.set(l,a);continue}const i=Number(n[0]);if(isNaN(i))o.set(l,a);else if(i<e)o.set(l,a);else{const e=i+t,l=n.slice(1).join("_"),r=`${e}_${l}`;o.set(r,a)}}this.errorManager.setErrors(o)}handleRowDeletion(e,t=[]){this.debug&&console.log("[ValidationRowColumnOps] handleRowDeletion 호출:",e),t&&t.length>0?this.remapValidationErrorsByRowDeletion(e,t):(this.debug&&console.log("[ValidationRowColumnOps] columnMetas가 없어 기존 방식 사용"),e.forEach(e=>{this.errorManager.clearErrorsForRow(e)}),this.reindexErrorsAfterRowDeletion(e))}handleColumnAddition(e,t,n=[]){this.errorManager.clearErrorsForColumn(e),n&&n.length>0&&n.forEach((n,o)=>{const l=this._getCellValue(n,t);""!==l&&null!==l&&void 0!==l&&this._validateCell(o,e,l,t.type||"",!0)})}handleColumnDeletion(e){if(!e||0===e.length)return;const t=this.store.validationState.errors;if(0===t.size)return;const n=new Map,o=new Set(e);for(const[l,a]of t){const e=l.split("_");let t;2!==e.length||isNaN(Number(e[0]))||isNaN(Number(e[1]))||(t=Number(e[1])),void 0!==t&&o.has(t)||n.set(l,a)}this.errorManager.setErrors(n)}revalidateRows(e=[],t=[],n=[]){e.forEach(e=>{const o=t[e];o&&n.forEach(t=>{if(!t.isEditable)return;const n=this._getCellValue(o,t);this._validateCell(e,t.colIndex??-1,n,t.type||"",!0)})})}revalidateColumns(e=[],t=[],n=[]){const o=n.filter(t=>void 0!==t.colIndex&&e.includes(t.colIndex));o.length&&t.forEach((e,t)=>{o.forEach(n=>{const o=this._getCellValue(e,n);this._validateCell(t,n.colIndex??-1,o,n.type||"",!0)})})}reindexErrorsAfterRowDeletion(e){if(!e||0===e.length)return;const t=this.store.validationState.errors;if(0===t.size)return;const n=new Map,o=[...e].sort((e,t)=>e-t);for(const[l,a]of t){const t=l.split("_");if(t.length<2){n.set(l,a);continue}const i=Number(t[0]);if(e.includes(i))continue;let r=i,s=0;for(const e of o)e<i&&s++;r=i-s;const d=t.slice(1).join("_"),c=`${r}_${d}`;n.set(c,a)}this.errorManager.setErrors(n)}remapValidationErrorsByRowDeletion(e,t){if(!e||0===e.length)return;const n=this.store.validationState.errors;if(!n||0===n.size)return;this.filterRowManager.handleRowChanges(e,[]);const o=this.filterRowManager.getRemappedErrors(n);this.errorManager.setErrors(o)}handleDataClear(e){const t=e.map(e=>({row:e.rowIndex,col:e.colIndex}));this.errorManager.clearErrorsForCells(t)}_validateCell(e,t,n,o,l){this._validateCellFn&&this._validateCellFn(e,t,n,o,l)}_getCellValue(e,t){return this._getCellValueFn?this._getCellValueFn(e,t):t.dataKey?e[t.dataKey]:void 0}destroy(){}}class Vn{store;errorManager;debug;onProgress;showToast;_validateCellFn;_getCellValueFn;constructor(e,t,n={}){this.store=e,this.errorManager=t,this.debug=n.debug||!1,this.onProgress=n.onProgress||null,this.showToast=n.showToast||null,this._validateCellFn=null,this._getCellValueFn=null}setValidateCellFn(e){this._validateCellFn=e}setGetCellValueFn(e){this._getCellValueFn=e}async handleDataImport(e,t){this.errorManager.clearAllErrors();const n=1e3,o=e.length;for(let l=0;l<o;l+=n){const a=e.slice(l,l+n);if(a.forEach((e,n)=>{const o=l+n;t.forEach(t=>{if(!t.isEditable)return;const n=this._getCellValue(e,t);""!==n&&null!==n&&void 0!==n&&this._validateCell(o,t.colIndex??-1,n,t.type||"",!0)})}),this.onProgress){const e=Math.round((l+n)/o*100);this.onProgress(Math.min(e,100))}l+n<o&&await new Promise(e=>setTimeout(e,10))}this.onProgress&&this.onProgress(100)}handlePasteData(e,t,n,o){this.debug&&console.log("[ValidationDataOps] handlePasteData 호출됨",e,t,n,o),e.forEach((e,l)=>{const a=t+l;e.forEach((e,t)=>{const l=n+t,i=o.find(e=>e.colIndex===l);i&&i.isEditable&&(this.debug&&console.log("[ValidationDataOps] validateCell 호출",a,l,e,i.dataKey),this.store.removeValidationError({rowIndex:a,colIndex:l}),""!==e&&null!==e&&void 0!==e&&this._validateCell(a,l,e,i.type||"",!0))})})}clearErrorsInPasteArea(e,t,n,o){const l=[],a=this.store.validationState.errors;for(const i of a.keys()){const a=i.split("_");if(2===a.length&&!isNaN(Number(a[0]))&&!isNaN(Number(a[1]))){const r=Number(a[0]),s=Number(a[1]);r>=e&&r<e+n&&s>=t&&s<t+o&&l.push(i)}}l.forEach(e=>{const[t,n]=e.split("_").map(Number);this.store.removeValidationError({rowIndex:t,colIndex:n})})}validateCellImmediate(e,t,n,o,l){const a=bn(n,o);return a.valid||this.errorManager.addError(e,t,a.message||"Validation failed",l),a}showPasteValidationSummary(e,t,n){const o=e.length,l=(o/t*100).toFixed(1),a={};if(e.forEach(e=>{const t=e.type||"unknown";a[t]=(a[t]||0)+1}),console.group("[ValidationDataOps] 붙여넣기 검증 결과"),console.log(`총 셀 수: ${t}`),console.log(`오류 셀 수: ${o} (${l}%)`),console.log("오류 타입별 분류:",a),o>0&&(console.log("첫 5개 오류 예시:"),e.slice(0,5).forEach((e,t)=>{console.log(`  ${t+1}. 행${e.row} 열${e.col}: "${e.value}" → ${e.message}`)})),console.groupEnd(),this.showToast){const e=n?n("dataInput.toast.pasteSummary",{total:t,error:o,rate:l}):`붙여넣기 완료: ${t}개 셀 중 ${o}개 오류 발견 (${l}%)`,a=o>0?"warning":"success";try{this.showToast(e,a)}catch(i){console.warn("[ValidationDataOps] showToast 호출 실패:",i)}}}validateIndividualExposureColumn(e,t,n=null){if(!e||0===e.length)return;this.debug&&console.log("[ValidationDataOps] validateIndividualExposureColumn 호출됨");const o=e.length,l=50;for(let a=0;a<o;a+=l){const i=e.slice(a,a+l);if(i.forEach(({rowIndex:e,value:n})=>{""!==n&&null!==n&&void 0!==n&&this._validateCell(e,t,n,"individualExposureTime",!0)}),n){const e=Math.round((a+l)/o*100);n(Math.min(e,100))}}n&&n(100)}validateConfirmedCaseColumn(e,t,n=null){if(!e||0===e.length)return;const o=e.length,l=50;for(let a=0;a<o;a+=l){const i=e.slice(a,a+l);if(i.forEach(({rowIndex:e,value:n})=>{""!==n&&null!==n&&void 0!==n&&this._validateCell(e,t,n,"isConfirmedCase",!0)}),n){const e=Math.round((a+l)/o*100);n(Math.min(e,100))}}n&&n(100)}_validateCell(e,t,n,o,l){this._validateCellFn&&this._validateCellFn(e,t,n,o,l)}_getCellValue(e,t){return this._getCellValueFn?this._getCellValueFn(e,t):t.dataKey?e[t.dataKey]:void 0}destroy(){this.onProgress=null}}class Fn{store;errorManager;debug;_validateCellFn;_getCellValueFn;constructor(e,t,n={}){this.store=e,this.errorManager=t,this.debug=n.debug||!1,this._validateCellFn=null,this._getCellValueFn=null}setValidateCellFn(e){this._validateCellFn=e}setGetCellValueFn(e){this._getCellValueFn=e}remapValidationErrorsByColumnIdentity(e,t,n=[]){const o=this.store.validationState.errors;if(!o||0===o.size)return;const l=this._analyzeStructuralChanges(e,t,n),a=new Map,i=this.store.rows||[];for(const[r,s]of o){const n=this._calculateNewErrorKey(r,l,e,t,i);n&&a.set(n,s)}if(this.errorManager.setErrors(a),l.insertions.length>0&&i.length>0&&this._validateCellFn)for(const r of l.insertions){const e=t.filter(e=>{const t=Ne(e);return t?.includes(`__${r.position}`)||void 0!==e.colIndex&&e.colIndex>=r.position&&e.colIndex<r.position+r.count});i.forEach((t,n)=>{e.forEach(e=>{const o=this._getCellValue(t,e);""!==o&&null!==o&&void 0!==o&&this._validateCellFn&&this._validateCellFn(n,e.colIndex??-1,o,e.type||"",!0)})})}}remapValidationErrorsByColumnOrder(e,t){this.remapValidationErrorsByColumnIdentity(e,t)}_analyzeStructuralChanges(e,t,n=[]){const o={insertions:[],deletions:[],typeChanges:{},totalOldCols:e.length,totalNewCols:t.length},l=this._groupColumnsByType(e),a=this._groupColumnsByType(t),i=new Set([...Object.keys(l),...Object.keys(a)]);for(const r of i){const e=l[r]||[],t=a[r]||[];if(e.length!==t.length)if(t.length>e.length){const n=t.length-e.length,l=this._findInsertionPosition(e,t);o.insertions.push({position:l,count:n,type:r})}else{const l=e.length-t.length;let a;if(n.length>0){const o=e.find(e=>void 0!==e.colIndex&&n.includes(e.colIndex));a=o?void 0!==o.cellIndex?o.cellIndex:o.colIndex??0:this._findDeletionPosition(e,t)}else a=this._findDeletionPosition(e,t);o.deletions.push({position:a,count:l,type:r})}}for(const r of e){const e=t.find(e=>e.type===r.type&&e.cellIndex===r.cellIndex&&(e.group||"")===(r.group||""));e&&void 0!==r.colIndex&&void 0!==e.colIndex&&(o.typeChanges[r.colIndex]=e.colIndex)}return o}_groupColumnsByType(e){const t={};for(const n of e){const e=n.type||"unknown";t[e]||(t[e]=[]),t[e].push(n)}return t}_findInsertionPosition(e,t){const n=new Set(e.map(e=>e.colIndex)),o=t.filter(e=>!n.has(e.colIndex));if(o.length>0){const e=Math.min(...o.map(e=>e.colIndex??1/0));return e}return e.length>0?e[0].colIndex??0:0}_findDeletionPosition(e,t){const n=new Set(t.map(e=>e.colIndex)),o=e.filter(e=>!n.has(e.colIndex));if(o.length>0){const e=o.reduce((e,t)=>{const n=e.colIndex??1/0,o=t.colIndex??1/0;return o<n?t:e});return void 0!==e.cellIndex?e.cellIndex:e.colIndex??0}return e.length>0?e[e.length-1].cellIndex??e[e.length-1].colIndex??0:0}_calculateNewErrorKey(e,t,n,o,l){const a=e.includes("__")||e.includes("confirmed_case")||e.includes("patient_id")||e.includes("patient_name")||e.includes("exposure_");let i,r,s;if(a){const n=We(e);if(!n)return null;i=n.rowIndex;const l=n.uniqueKey.split("__"),a=l.length>1?parseInt(l[l.length-1]):null;if(s=a,null!==a&&!isNaN(a)){for(const e of t.insertions){const t=l[0];if(this._isMatchingType(e.type,t)&&a>=e.position){const t=o.find(t=>t.colIndex===e.position&&t.type===e.type),n=t&&void 0!==t.cellIndex?t.cellIndex:e.position;a>=n&&(s+=e.count)}}for(const e of t.deletions){const t=l[0],n=e.position;this._isMatchingType(e.type,t)&&(a>=n+e.count?s-=e.count:a>=n&&(s=n))}}let d;if(null===a||isNaN(a))d=n.uniqueKey;else{const e=l.slice(0,-1).join("__");d=null===s||isNaN(s)?e:`${e}__${s}`}const c=o.find(e=>Ne(e)===d);if(c)r=c.colIndex??-1;else{const e=l.length>1?l[1]:null,t=o.find(t=>t.type===e&&t.cellIndex===s);if(!t)return null;r=t.colIndex??-1}}else{const l=e.split("_");if(2!==l.length)return null;i=parseInt(l[0]);const a=parseInt(l[1]),s=this._calculateNewColIndex(a,t,n,o);if(null===s)return null;r=s}const d=o.find(e=>e.colIndex===r);if(!d)return null;if(!l[i])return null;{const e={...d};if(null===s||void 0===s||isNaN(s)||(e.cellIndex=s),!this._cellHasValue(l[i],e))return null}if(a){const e={...d};void 0===s||null===s||isNaN(s)||(e.cellIndex=s);const t=Ne(e);return t?Be(i,t):null}return`${i}_${r}`}_isMatchingType(e,t){if(e===t)return!0;const n={isConfirmedCase:"confirmed",patientId:"patient",patientName:"patient",individualExposureTime:"exposure"};return n[e]===t}_calculateNewColIndex(e,t,n,o){if(void 0!==t.typeChanges[e])return t.typeChanges[e];const l=n.find(t=>t.colIndex===e);if(!l)return null;const a=o.find(e=>e.type===l.type&&e.cellIndex===l.cellIndex&&(e.group||"")===(l.group||""));if(a)return a.colIndex??null;let i=e;for(const r of t.insertions)e>=r.position&&(i+=r.count);for(const r of t.deletions)if(e>=r.position+r.count)i-=r.count;else if(e>=r.position)return null;return i<0||i>=t.totalNewCols?null:i}_cellHasValue(e,t){const n=this._getCellValue(e,t);return void 0!==n&&null!==n&&""!==n}_getCellValue(e,t){return this._getCellValueFn?this._getCellValueFn(e,t):t.dataKey?e[t.dataKey]:void 0}destroy(){}}class Kn{store;DEBOUNCE_DELAY;defaultChunkSize;useWorker;onProgress;showToast;t;debug;_destroyed;errorManager;rowColumnOps;dataOps;structuralMapper;validationTimers;columnMetas;_worker=null;_currentValidationTask=null;constructor(e,t={}){if(!e)throw new Error("ValidationManager: Store instance required");this.store=e;const{debounceDelay:o=300,chunkSize:l=null,useWorker:a=!1,onProgress:i=null,debug:r=!1,showToast:s=null,t:d=null}=t;this.DEBOUNCE_DELAY=o,this.defaultChunkSize=l,this.useWorker=a,this.onProgress=i||null,this.showToast=s||null,this.t=d||null,this.debug=r,this._destroyed=!1,this.errorManager=new $n(e,{debug:r}),this.rowColumnOps=new Tn(e,this.errorManager,{debug:r}),this.dataOps=new Vn(e,this.errorManager,{debug:r,onProgress:this.onProgress||void 0,showToast:this.showToast||void 0}),this.structuralMapper=new Fn(e,this.errorManager,{debug:r});const c=this.validateCell.bind(this),u=this._getCellValue.bind(this);this.rowColumnOps.setValidateCellFn(c),this.rowColumnOps.setGetCellValueFn(u),this.dataOps.setValidateCellFn(c),this.dataOps.setGetCellValueFn(u),this.structuralMapper.setValidateCellFn(c),this.structuralMapper.setGetCellValueFn(u),this.validationTimers=new Map,this.columnMetas=[],this.useWorker&&(this._worker=Dn(new URL(n(5286),n.b)),this._worker?this._worker.onmessage=e=>{if(this._destroyed)return;const{type:t,invalidCells:n,error:o}=e.data||{};"error"!==t?Array.isArray(n)&&(this.errorManager.clearAllErrors(),n.forEach(({row:e,col:t,message:n})=>{const o=this.columnMetas.find(e=>e.colIndex===t);if(o){const l=Ne(o);if(l){const t=Be(e,l);this.store.addValidationErrorByUniqueKey({errorKey:t,message:n})}else this.store.addValidationError({rowIndex:e,colIndex:t,message:n})}else this.store.addValidationError({rowIndex:e,colIndex:t,message:n})})):console.error("[ValidationManager worker]",o)}:(this.useWorker=!1,this.debug&&console.log("[ValidationManager] Worker creation failed, using async processor")))}getColumnUniqueKey=Ne;getErrorKey=Be;parseErrorKey=We;createUniqueKeyMapping(e){const t={};return e.forEach(e=>{const n=this.getColumnUniqueKey(e);n&&(t[n]=e)}),t}findColIndexByUniqueKey(e,t){const n=t.find(t=>this.getColumnUniqueKey(t)===e);return n?n.colIndex??null:null}migrateErrorsToUniqueKeys(e){this.debug&&console.log("[ValidationManager] 기존 에러를 고유 식별자 기반으로 마이그레이션 시작");const t=this.store.validationState.errors;if(!t||0===t.size)return;const n=new Map;let o=0,l=0,a=0;for(const[i,r]of t){const t=this.parseErrorKey(i);if(t&&isNaN(Number(t.uniqueKey))){n.set(i,r),a++;continue}const s=i.split("_");if(2!==s.length){l++;continue}const d=parseInt(s[0]),c=parseInt(s[1]);if(isNaN(d)||isNaN(c)){l++;continue}const u=e.find(e=>e.colIndex===c);if(!u){l++;continue}const p=this.getColumnUniqueKey(u);if(!p){l++;continue}const f=this.getErrorKey(d,p);n.set(f,r),o++}this.store.setValidationErrors(n),this.debug&&console.log(`[ValidationManager] 마이그레이션 완료: 성공 ${o}개, 이미 고유 키 ${a}개, 건너뜀 ${l}개`)}validateCell(e,t,n,o,l=!1){if(this._destroyed)return;if(e<0)return;const a=`${e}_${t}`;if(this.debug&&console.log(`validateCell: ${e}, ${t}, "${n}", ${o}, imm:${l}`),this.errorManager.cancelTimer(a),l||this._shouldValidateImmediately(n)){const l=this.columnMetas.find(e=>e.colIndex===t);return void this.performValidation(e,t,n,o,l)}this.errorManager.setTimer(a,()=>{if(!this._destroyed){const l=this.columnMetas.find(e=>e.colIndex===t);this.performValidation(e,t,n,o,l)}},this.DEBOUNCE_DELAY)}async revalidateAll(e=[],t=[],n={}){if(this._destroyed)return;if(this.errorManager.clearAllErrors(),!e.length||!t.length)return;const o=e.length*t.filter(e=>e.isEditable).length,l=void 0!==n.chunkSize?n.chunkSize:this.defaultChunkSize,a=n.onProgress||this.onProgress;return!l||l<=0||o<500?(e.forEach((e,n)=>{t.forEach(t=>{if(!t.isEditable)return;const o=this._getCellValue(e,t);""!==o&&null!==o&&void 0!==o&&this.validateCell(n,t.colIndex??-1,o,t.type,!0)})}),void(a&&a(100))):!1!==n.useAsyncProcessor?new Promise((n,o)=>{const i=_n(e,t,bn,{chunkSize:Math.min(l,100),onProgress:e=>{a&&a(e)},onComplete:e=>{e.forEach(({row:e,col:n,message:o})=>{const l=t.find(e=>e.colIndex===n);if(l){const t=Ne(l);if(t){const n=Be(e,t);this.store.addValidationErrorByUniqueKey({errorKey:n,message:o})}else this.store.addValidationError({rowIndex:e,colIndex:n,message:o})}else this.store.addValidationError({rowIndex:e,colIndex:n,message:o})}),n()},onError:e=>{console.error("[ValidationManager] Validation error:",e),o(e)}});this._currentValidationTask=i}):void 0}clearErrorsForCells(e){this.errorManager.clearErrorsForCells(e)}clearErrorsForRow(e){this.errorManager.clearErrorsForRow(e)}clearErrorsForColumn(e){this.errorManager.clearErrorsForColumn(e)}clearAllErrors(){this.errorManager.clearAllErrors()}clearTimers(){this.errorManager.clearTimers()}printErrorKeys(e,t){this.errorManager.printErrorKeys(e,t)}printErrorDiff(e,t){this.errorManager.printErrorDiff(e,t)}printUniqueKeyMapping(e){this.errorManager.printUniqueKeyMapping(e)}handleRowAddition(e,t,n,o=1){this.rowColumnOps.handleRowAddition(e,t,n,o)}handleRowDeletion(e,t){this.rowColumnOps.handleRowDeletion(e,t)}handleColumnAddition(e,t,n){this.rowColumnOps.handleColumnAddition(e,t,n)}handleColumnDeletion(e){this.rowColumnOps.handleColumnDeletion(e)}revalidateRows(e,t,n){this.rowColumnOps.revalidateRows(e,t,n)}revalidateColumns(e,t,n){this.rowColumnOps.revalidateColumns(e,t,n)}reindexErrorsAfterRowDeletion(e){this.rowColumnOps.reindexErrorsAfterRowDeletion(e)}remapValidationErrorsByRowDeletion(e,t){this.rowColumnOps.remapValidationErrorsByRowDeletion(e,t)}handleDataClear(e){this.rowColumnOps.handleDataClear(e)}async handleDataImport(e,t){return this.dataOps.handleDataImport(e,t)}handlePasteData(e,t,n,o){this.dataOps.handlePasteData(e,t,n,o)}validateIndividualExposureColumn(e,t,n){this.dataOps.validateIndividualExposureColumn(e,t,n)}validateConfirmedCaseColumn(e,t,n){this.dataOps.validateConfirmedCaseColumn(e,t,n)}_clearErrorsInPasteArea(e,t,n,o){this.dataOps.clearErrorsInPasteArea(e,t,n,o)}_validateCellImmediate(e,t,n,o,l){return this.dataOps.validateCellImmediate(e,t,n,o,l)}_showPasteValidationSummary(e,t){this.dataOps.showPasteValidationSummary(e,t,this.t)}remapValidationErrorsByColumnIdentity(e,t,n=[]){this.structuralMapper.remapValidationErrorsByColumnIdentity(e,t,n)}remapValidationErrorsByColumnOrder(e,t){this.structuralMapper.remapValidationErrorsByColumnOrder(e,t)}updateColumnMetas(e){this.columnMetas=e,this.errorManager.updateColumnMetas(e),this.debug&&console.log("[ValidationManager] 열 메타데이터 업데이트:",e.length,"개")}onDataReset(){this.errorManager.clearTimers()}destroy(){if(this.errorManager.destroy(),this.rowColumnOps.destroy(),this.dataOps.destroy(),this.structuralMapper.destroy(),this._worker){try{this._worker.terminate()}catch(e){}this._worker=null}this._destroyed=!0}performValidation(e,t,n,o,l){this.debug&&console.log(`performValidation: ${e}, ${t}, "${n}", ${o}`);const a=bn(n,o);a.valid?this.errorManager.removeError(e,t,l):this.errorManager.addError(e,t,a.message||"Validation failed",l)}_shouldValidateImmediately(e){return""===e||null===e||void 0===e}_getCellValue(e,t){if(!e||!t.dataKey)return"";if(null!==t.cellIndex&&void 0!==t.cellIndex){const n=e[t.dataKey];return Array.isArray(n)?t.cellIndex<0||t.cellIndex>=n.length?"":n[t.cellIndex]??"":""}return e[t.dataKey]??""}get filterRowManager(){return this.rowColumnOps.filterRowManager}}var An=Kn;const On={key:0,class:"validation-progress"},Ln={class:"progress-container"},Pn={class:"progress-header"},Nn={class:"progress-title"},Bn={class:"progress-percentage"},Wn={class:"progress-bar"},Un={class:"progress-details"},zn={key:0,class:"error-count"};var Yn=(0,o.pM)({__name:"ValidationProgress",props:{progress:{default:0},processed:{default:0},total:{default:0},errorCount:{default:0},isVisible:{type:Boolean,default:!1}},setup(e){return(e,t)=>e.isVisible?((0,o.uX)(),(0,o.CE)("div",On,[(0,o.Lk)("div",Ln,[(0,o.Lk)("div",Pn,[(0,o.Lk)("span",Nn,(0,r.v_)(e.$t("dataInput.validation.validating")),1),(0,o.Lk)("span",Bn,(0,r.v_)(Math.round(e.progress))+"%",1)]),(0,o.Lk)("div",Wn,[(0,o.Lk)("div",{class:"progress-fill",style:(0,r.Tr)({width:e.progress+"%"})},null,4)]),(0,o.Lk)("div",Un,[e.errorCount>0?((0,o.uX)(),(0,o.CE)("span",zn,(0,r.v_)(e.$t("dataInput.validation.errorCount",{count:e.errorCount})),1)):(0,o.Q3)("",!0)])])])):(0,o.Q3)("",!0)}});const Xn=(0,g.A)(Yn,[["__scopeId","data-v-56a20b99"]]);var Hn=Xn,qn=n(2905);function jn(e,t,n,a,i){const r=(0,Ct.X)(),{t:s}=(0,v.s9)(),d=(0,x.C)(),c=_t(),u=Et(),p=(0,l.KR)([]),f=(0,l.KR)([]),g=(0,o.EW)(()=>r.headers||{basic:[],clinical:[],diet:[]}),m=(0,o.EW)(()=>r.rows||[]),h=(0,o.EW)(()=>{const e=[];let t=0,n=0;const o=o=>{const l=o.style||{},a=l.width||"80px",i="number"===typeof a?a:parseInt(String(a),10);e.push({...o,colIndex:t,offsetLeft:n,text:o.headerText,value:o.dataKey||"",width:i}),n+=i,t++};o({type:ln,headerText:s("dataInput.headers.serial"),headerRow:1,isEditable:!1,style:fn[ln],dataKey:void 0,cellIndex:void 0}),o({type:an,headerText:s("dataInput.headers.isPatient"),headerRow:1,isEditable:!0,style:fn[an],dataKey:"isPatient",cellIndex:void 0,tooltip:s("dataInput.headerTooltips.isPatient")}),d.isConfirmedCaseColumnVisible&&o({type:rn,headerText:s("dataInput.headers.confirmed"),headerRow:1,isEditable:!0,style:fn[rn],dataKey:"isConfirmedCase",cellIndex:void 0,isCustom:!0,tooltip:s("dataInput.headerTooltips.confirmed")});const l=g.value.basic||[];l.forEach((e,t)=>{o({type:sn,headerText:e,headerRow:2,isEditable:!0,style:fn.default,dataKey:"basicInfo",cellIndex:t})});const a=g.value.clinical||[];a.forEach((e,t)=>{o({type:"clinicalSymptoms",headerText:e,headerRow:2,isEditable:!0,style:fn.default,dataKey:"clinicalSymptoms",cellIndex:t,tooltip:s("dataInput.headerTooltips.clinical")})}),d.isIndividualExposureColumnVisible&&o({type:pn,headerText:s("dataInput.headers.exposure"),headerRow:1,isEditable:!0,style:fn[cn],dataKey:"individualExposureTime",cellIndex:void 0,isCustom:!0}),o({type:cn,headerText:s("dataInput.headers.onset"),headerRow:1,isEditable:!0,style:fn[cn],dataKey:"symptomOnset",cellIndex:void 0});const i=g.value.diet||[];return i.forEach((e,t)=>{o({type:"dietInfo",headerText:e,headerRow:2,isEditable:!0,style:fn.default,dataKey:"dietInfo",cellIndex:t,tooltip:s("dataInput.headerTooltips.diet")})}),e}),I=(0,o.EW)(()=>{const e=[],t=g.value.basic?.length||0,n=g.value.clinical?.length||0,o=g.value.diet?.length||0;let l=0;e.push({text:s("dataInput.headers.serial"),rowspan:2,startColIndex:nn,style:fn[ln]}),l++,e.push({text:s("dataInput.headers.isPatient"),rowspan:2,startColIndex:on,style:fn[an]}),l++,d.isConfirmedCaseColumnVisible&&(e.push({text:s("dataInput.headers.confirmed"),rowspan:2,startColIndex:l,style:fn[rn]}),l++);const a=l;t>0?(e.push({text:s("dataInput.headers.basic"),colspan:t,startColIndex:a,type:sn,addable:!0,deletable:!0,columnCount:t}),l+=t):(e.push({text:s("dataInput.headers.basic"),colspan:1,startColIndex:a,type:sn,addable:!0,deletable:!1,columnCount:0,style:{minWidth:"60px"}}),l++);const i=l;if(n>0?(e.push({text:s("dataInput.headers.clinical"),colspan:n,startColIndex:i,type:dn,addable:!0,deletable:!0,columnCount:n}),l+=n):(e.push({text:s("dataInput.headers.clinical"),colspan:1,startColIndex:i,type:dn,addable:!0,deletable:!1,columnCount:0,style:{minWidth:"60px"}}),l++),d.isIndividualExposureColumnVisible){const t=l;e.push({text:s("dataInput.headers.exposure"),rowspan:2,startColIndex:t,style:fn[cn]}),l++}const r=l;e.push({text:s("dataInput.headers.onset"),rowspan:2,startColIndex:r,style:fn[cn]}),l++;const c=l;return o>0?e.push({text:s("dataInput.headers.diet"),colspan:o,startColIndex:c,type:un,addable:!0,deletable:!0,columnCount:o}):e.push({text:s("dataInput.headers.diet"),colspan:1,startColIndex:c,type:un,addable:!0,deletable:!1,columnCount:0,style:{minWidth:"60px"}}),e}),w=(0,o.EW)(()=>`${h.value.reduce((e,t)=>{const n=t.width||80;return e+n},0)}px`);function y(e){return e===dn?"clinicalSymptoms":e===un?"dietInfo":e}function C(e){switch(e){case sn:return g.value.basic||[];case dn:return g.value.clinical||[];case un:return g.value.diet||[];default:return[]}}async function b(){const l=d.isIndividualExposureColumnVisible,a=!l;qn.vF.debug("onToggleExposureColumn 호출됨",{current:l,isAdding:a});const i=r.symptomOnsetStartIndex,u=h.value.findIndex(e=>"individualExposureTime"===e.type||"individualExposureTime"===e.dataKey&&0===e.cellIndex);if(!a&&u>=0){const e=m.value||[];p.value=e.map((e,t)=>{const n=e.individualExposureTime||"";return{rowIndex:t,value:n}}).filter(e=>""!==e.value&&null!==e.value&&void 0!==e.value),qn.vF.debug("백업된 개별 노출시간 데이터:",p.value)}const f=[...h.value];c.captureSnapshot("toggle_exposure_column");try{d.setIndividualExposureColumnVisibility(!l)}catch(g){return qn.vF.error("개별 노출시간 열 가시성 변경 실패:",g),void(0,Xt.P0)("개별 노출시간 열 가시성 변경 중 오류가 발생했습니다.","error")}(0,o.dY)(()=>{const t=h.value;e&&f.length!==t.length&&(qn.vF.debug("컬럼 구조 변경 감지 - 에러 재매핑 시작"),e.remapValidationErrorsByColumnIdentity(f,t))}),a&&p.value.length>0&&((0,qn.gg)("백업된 데이터가 있음 - 검증 실행"),(0,o.dY)(()=>{const t=h.value.findIndex(e=>"individualExposureTime"===e.type||"individualExposureTime"===e.dataKey&&0===e.cellIndex);(0,qn.gg)("찾은 새 열 인덱스:",t),t>=0?e?.validateIndividualExposureColumn(p.value,t,e=>{p.value.length>100&&100===e&&(0,Xt.P0)(s("dataInput.toast.grid.exposureValidationComplete",{count:p.value.length}),"success")}):(qn.vF.error("새로운 개별 노출시간 열 인덱스를 찾을 수 없습니다!"),qn.vF.debug("대안으로 exposureInsertIndex 사용:",i)),p.value=[]})),t.clearSelection(),(0,o.dY)(()=>{n&&n()})}async function E(){const l=d.isConfirmedCaseColumnVisible,a=!l;qn.vF.debug(`확진여부 열 토글 시작: 현재 상태 ${l} -> ${!l} (${a?"추가":"제거"})`);const i=h.value.findIndex(e=>"isConfirmedCase"===e.type||"isConfirmedCase"===e.dataKey&&null===e.cellIndex);if(!a&&i>=0){const e=m.value||[];f.value=e.map((e,t)=>{const n=e.isConfirmedCase||"";return{rowIndex:t,value:n}}).filter(e=>""!==e.value&&null!==e.value&&void 0!==e.value),(0,qn.gg)(`[SpecialColumn] 확진여부 데이터 백업 완료: ${f.value.length}개 항목`)}const r=[...h.value];c.captureSnapshot("toggle_confirmed_case_column");try{d.setConfirmedCaseColumnVisibility(!l)}catch(u){return qn.vF.error("확진자 여부 열 가시성 변경 실패:",u),void(0,Xt.P0)("확진자 여부 열 가시성 변경 중 오류가 발생했습니다.","error")}(0,o.dY)(()=>{const t=h.value;e&&r.length!==t.length&&(e.updateColumnMetas(t),e.remapValidationErrorsByColumnIdentity(r,t))}),a&&f.value.length>0&&((0,qn.gg)(`[SpecialColumn] 백업 데이터 기반 검증 시작: ${f.value.length}개 셀`),(0,o.dY)(()=>{const t=h.value.findIndex(e=>"isConfirmedCase"===e.type||"isConfirmedCase"===e.dataKey&&null===e.cellIndex);t>=0?e?.validateConfirmedCaseColumn(f.value,t,e=>{f.value.length>100&&100===e&&(0,Xt.P0)(s("dataInput.toast.grid.confirmedValidationComplete",{count:f.value.length}),"success")}):qn.vF.error("새로운 확진자 여부 열 인덱스를 찾을 수 없습니다!"),f.value=[]})),t.clearSelection(),(0,o.dY)(()=>{n&&n()})}function S(l){if(!a("add_column",{blocking:!0,timeout:5e3}))return;const s=[...h.value],d=C(l),u=d.length,p=y(l);(0,qn.gg)(`[HeaderButton] 열 추가 시작: 그룹타입 ${l}, 메타타입 ${p}, 위치 ${u}`),c.captureSnapshot("add_column"),r.insertMultipleColumnsAt({type:p,count:1,index:u}),(0,o.dY)(()=>{const t=h.value;e&&s.length!==t.length&&((0,qn.gg)(`[HeaderButton] 열 구조 변경 감지: ${s.length} -> ${t.length}, 에러 재매핑 시작`),e.updateColumnMetas(t),e.remapValidationErrorsByColumnIdentity(s,t),(0,qn.gg)("[HeaderButton] 에러 재매핑 완료"))}),t.clearSelection(),(0,o.dY)(()=>{n&&n()}),i("add_column")}function R(e){if(!a("delete_column",{blocking:!0,timeout:5e3}))return;const l=C(e);if(l.length<=1)return void(0,qn.gg)(`[HeaderButton] 열 삭제 불가: 최소 1개 열 유지 규칙 (현재 ${l.length}개)`);const s=l.length-1,d=y(e);(0,qn.gg)(`[HeaderButton] 열 삭제 시작: 그룹타입 ${e}, 메타타입 ${d}, 위치 ${s}`),c.captureSnapshot("delete_column"),r.deleteMultipleColumnsByIndex({columns:[{type:d,index:s}]}),(0,qn.gg)("[HeaderButton] 열 삭제 완료"),t.clearSelection(),(0,o.dY)(()=>{n&&n()}),i("delete_column")}function M(){const t=[...h.value];c.captureSnapshot("delete_empty_cols"),r.deleteEmptyColumns(),(0,o.dY)(()=>{const n=h.value;e&&t.length!==n.length&&(e.updateColumnMetas(n),e.remapValidationErrorsByColumnIdentity(t,n))}),(0,Xt.P0)(s("dataInput.toast.grid.colsDeleted"),"info")}async function _(){await(0,Xt.VV)(s("dataInput.toast.confirmContext"))&&(c.captureSnapshot("reset_sheet"),u.clearAllFilters(),r.resetSheet(),t.clearSelection(),e&&(e.clearAllErrors(),e.clearTimers()),(0,Xt.P0)(s("dataInput.toast.grid.sheetReset"),"success"),(0,o.dY)(()=>{n&&n()}))}return(0,o.wB)(h,t=>{e&&t.length>0&&e.updateColumnMetas(t)},{deep:!0}),{allColumnsMeta:h,headerGroups:I,tableWidth:w,individualExposureBackupData:p,confirmedCaseBackupData:f,onToggleExposureColumn:b,onToggleConfirmedCaseColumn:E,onAddColumn:S,onDeleteColumn:R,onDeleteEmptyCols:M,onResetSheet:_}}function Gn(e,t){const{rowHeight:n=35,bufferSize:a=10,viewportHeight:i}=t,r=(0,l.KR)(0),s=(0,o.EW)(()=>e.value.length*n),d=(0,o.EW)(()=>Math.max(0,Math.floor(r.value/n)-a)),c=(0,o.EW)(()=>i.value?Math.ceil(i.value/n)+2*a:0),u=(0,o.EW)(()=>Math.min(e.value.length-1,d.value+c.value)),p=(0,o.EW)(()=>e.value.slice(d.value,u.value+1).map((e,t)=>{const n=e._originalIndex,o=void 0!==n?n:d.value+t;return{...e,originalIndex:o}})),f=(0,o.EW)(()=>d.value*n);function g(e){const t=e.target;r.value=t.scrollTop}function m(e){return d.value+e}function h(e){return e<d.value||e>u.value?null:e-d.value}return{visibleRows:p,totalHeight:s,paddingTop:f,onScroll:g,getOriginalIndex:m,getVirtualIndex:h}}function Jn(e,t,n={}){const a=n.rowHeight||35,i=n.bufferSize||4,r=n.gridContainerRef||(0,l.KR)(null),s=n.gridHeaderRef||(0,l.KR)(null),d=n.gridBodyRef||(0,l.KR)(null),c=(0,l.KR)(0),u=(0,l.KR)(0),p=(0,l.KR)(0),{visibleRows:f,totalHeight:g,paddingTop:m,onScroll:h,getOriginalIndex:v}=Gn(e,{rowHeight:a,bufferSize:i,viewportHeight:u});function x(){const e=d.value?.bodyContainer;if(!e)return 0;const t=e.scrollHeight>e.clientHeight;return t?e.offsetWidth-e.clientWidth:0}function I(){const e=x();e!==p.value&&(p.value=e,(0,qn.gg)(`[Scrollbar] Width updated: ${p.value}px`),(0,o.dY)(()=>{const e=s.value?.headerContainer;e&&(e.style.paddingRight=`${p.value}px`)}))}function w(e){const t=e.target,{scrollLeft:n}=t;if(n!==c.value){c.value=n;const e=s.value?.headerContainer;e&&(e.scrollLeft=n)}I(),h(e)}async function y(e,n){if(!d.value?.bodyContainer)return;const l=d.value.bodyContainer;let i=!1;if(e>=0){const t=a,n=40,{scrollTop:o,clientHeight:r}=l,s=e*t,d=s+t;let c=o;if(s<o?c=s:d>o+r&&(c=d-r+n),c!==o){const e=g.value-r;l.scrollTop=Math.min(c,e),i=!0}}if(n>=0){const e=t.value.find(e=>e.colIndex===n);if(!e)return;const{scrollLeft:o,clientWidth:a}=l,r=e.offsetLeft||0,s=e.style?.width||"0",d=parseInt(s,10),c=r+d;let u=o;r<o?u=1===n?0:r:c>o+a&&(u=c-a),u!==o&&(l.scrollLeft=u,i=!0)}i&&await(0,o.dY)()}function C(){(0,o.dY)(()=>{I()})}return(0,o.wB)(t,()=>{(0,o.dY)(()=>{I()})},{immediate:!0}),(0,o.sV)(()=>{if(r.value){const e=r.value.querySelector(".grid-body-virtual");if(e){const t=5;u.value=e.clientHeight-t}}(0,o.dY)(()=>{I()}),window.addEventListener("resize",C)}),(0,o.xo)(()=>{window.removeEventListener("resize",C)}),{gridContainerRef:r,gridHeaderRef:s,gridBodyRef:d,lastScrollLeft:c,viewportHeight:u,scrollbarWidth:p,visibleRows:f,totalHeight:g,paddingTop:m,getOriginalIndex:v,handleGridScroll:w,updateHeaderPadding:I,calculateScrollbarWidth:x,ensureCellIsVisible:y}}function Qn(e,t,n){const a=Et(),i=_t(),r=(0,l.KR)(a.filterState);(0,o.wB)(()=>a.filterState,e=>{JSON.stringify(e)!==JSON.stringify(r.value)&&(r.value={...e},(0,o.dY)(()=>{t.value&&n.value&&(e.isFiltered===r.value.isFiltered&&(e.activeFilters?.size??0)===(r.value.activeFilters?.size??0)||(t.value.$forceUpdate&&t.value.$forceUpdate(),n.value.$forceUpdate&&n.value.$forceUpdate()))}))},{deep:!0,immediate:!0});const s=(0,o.EW)(()=>{const t=a.activeFilters,n=t.size,o=n>0;if(!o)return e.value;const l=[];return e.value.forEach((e,n)=>{let o=!0;for(const[l,i]of t)if(!a.matchesFilter(e,l,i)){o=!1;break}if(o){const t={...e};t._originalIndex=n,t._filteredOriginalIndex=n,l.push(t)}}),l});function d(e,t={}){try{i.captureSnapshot(e,t)}catch(n){qn.vF.error(`스냅샷 캡처 실패: ${e}`,n)}}function c(){const e={...a.filterState};r.value=e,(0,o.dY)(()=>{try{const o=t.value,l=n.value;o&&l&&(e.isFiltered===r.value.isFiltered&&(e.activeFilters?.size??0)===(r.value.activeFilters?.size??0)||(o.$forceUpdate&&o.$forceUpdate(),l.$forceUpdate&&l.$forceUpdate()))}catch(o){qn.vF.warn("UI update failed during sync",o)}})}function u(){const e=JSON.stringify(a.filterState);a.clearAllFilters(),e!==JSON.stringify(a.filterState)&&d("filter_clear_all",{action:"clear-all-filters",oldFilterState:JSON.parse(e),newFilterState:{...a.filterState}}),r.value={...a.filterState},qn.vF.debug("[Filter] 모든 필터 해제됨")}function p(e){qn.vF.debug("[Filter] 개별 필터 제거:",e),a.clearAllFilters(),e.forEach((e,t)=>a.setFilter(t,e))}return{filterState:r,filteredRows:s,captureSnapshotWithFilter:d,syncFilterStateAfterHistoryChange:c,onClearAllFilters:u,onUpdateActiveFilters:p}}let Zn=null;function eo(){Zn&&(clearInterval(Zn),Zn=null)}function to(e,t,n,o){const{selectionSystem:l,allColumnsMeta:a}=o,i=e;if(null===i||void 0===i)return void console.error("Could not determine original row index.");if(2===n.button){const{selectedRange:e,selectedRowsIndividual:n,selectedCellsIndividual:o}=l.state,a=null!==e.start.rowIndex&&null!==e.end.rowIndex&&i>=e.start.rowIndex&&i<=e.end.rowIndex&&null!==e.start.colIndex&&null!==e.end.colIndex&&t>=e.start.colIndex&&t<=e.end.colIndex,r=n.has(i),s=o.has(`${i}_${t}`);if(a||r||s)return}const{isEditing:r,editingCell:s}=l.state;if(r&&s.rowIndex===i&&s.colIndex===t)return n.stopPropagation(),void n.stopImmediatePropagation();const d=n.ctrlKey||n.metaKey,c=n.shiftKey;if(d){if(0===l.state.selectedCellsIndividual.size&&0===l.state.selectedRowsIndividual.size){const e=l.state.selectedCell;null!==e.rowIndex&&null!==e.colIndex&&(0===e.colIndex?l.toggleIndividualRow(e.rowIndex):l.toggleIndividualCell(e.rowIndex,e.colIndex))}if(n.preventDefault(),0===t&&c){const e=l.state.selectionAnchor.rowIndex??i;return void l.selectRowRange(e,i)}return 0===t?void l.toggleIndividualRow(i):void l.toggleIndividualCell(i,t)}if(c){n.preventDefault(),l.clearIndividualSelections();const e=l.state.selectionAnchor.rowIndex??i;return void(0===t?l.selectRowRange(e,i):l.extendSelection(i,t))}r||n.preventDefault(),r||(l.clearIndividualSelections(),0===t?l.selectRow(i,a):l.selectCell(i,t),l.startDrag(t))}function no(e,t){const{selectionSystem:n,allColumnsMeta:o,gridBodyContainer:l}=t;if(!n.state.isDragging||!l)return;const a=(e,t)=>{const l=document.elementFromPoint(e,t);if(!l)return;const a=l.closest("td, th");if(!a)return;const i=a.dataset.col;if(void 0===i)return;const r=parseInt(i,10);let s;if(void 0!==a.dataset.row)s=parseInt(a.dataset.row,10);else{if("TH"!==a.tagName)return;s=-1}isNaN(s)||isNaN(r)||n.updateDragSelection(s,r,o)};eo();const i=l.getBoundingClientRect(),r=40;let s=0,d=0;e.clientY<i.top+r&&(d=-20),e.clientY>i.bottom-r&&(d=20),e.clientX<i.left+r&&(s=-20),e.clientX>i.right-r&&(s=20),0===s&&0===d||(Zn=setInterval(()=>{l.scrollTop+=d,l.scrollLeft+=s,a(e.clientX,e.clientY)},50)),a(e.clientX,e.clientY)}function oo(e,t){eo(),t.selectionSystem.endDragSelection()}function lo(e){const t=450,n=400,o=10,l=window.innerWidth,a=window.innerHeight;let i=e.bottom+4,r=e.left+e.width/2-t/2;if(r<o&&(r=o),r+t>l-o&&(r=l-t-o),r<o&&(r=e.left,r<o&&(r=o)),i+n>a-o&&(i=e.top-n-4,i<o)){const t=e.top-o,l=a-e.bottom-o;t>l?i=Math.max(o,e.top-n):(i=e.bottom+4,i+n>a-o&&(i=a-n-o))}const s=document.querySelector(".grid-container");if(s){const e=s.getBoundingClientRect();i<e.top+o&&(i=e.top+o),r<e.left+o&&(r=e.left+o),r+t>e.right-o&&(r=e.right-t-o)}return{top:i,left:r}}function ao(e,t,n){const o=n.find(e=>e.colIndex===t);return!!o&&(!(e<0)||2===o.headerRow&&(o.isEditable||!1))}function io(e,t,n,o,l,a){switch(n){case"left":if(e<0){for(let n=t-1;n>=0;n--)if(ao(e,n,o))return{rowIndex:e,colIndex:n};return{rowIndex:e,colIndex:t}}return{rowIndex:e,colIndex:Math.max(1,t-1)};case"right":if(e<0){for(let n=t+1;n<a;n++)if(ao(e,n,o))return{rowIndex:e,colIndex:n};return{rowIndex:0,colIndex:0}}return{rowIndex:e,colIndex:Math.min(a-1,t+1)};case"up":if(e>0)return{rowIndex:e-1,colIndex:t};if(0===e){if(ao(-1,t,o))return{rowIndex:-1,colIndex:t};for(let e=t;e>=0;e--)if(ao(-1,e,o))return{rowIndex:-1,colIndex:e};for(let e=t+1;e<a;e++)if(ao(-1,e,o))return{rowIndex:-1,colIndex:e};return{rowIndex:e,colIndex:t}}return{rowIndex:e,colIndex:t};case"down":return-1===e?{rowIndex:0,colIndex:t}:e<l-1?{rowIndex:e+1,colIndex:t}:{rowIndex:e,colIndex:t}}}function ro(e,t,n,o,l){const a=o.length,i=l.length;switch(n){case"up":return{rowIndex:0,colIndex:t};case"down":return{rowIndex:a-1,colIndex:t};case"left":return{rowIndex:e,colIndex:Math.max(1,0)};case"right":return{rowIndex:e,colIndex:i-1};default:return{rowIndex:e,colIndex:t}}}async function so(e,t){const{selectionSystem:n,rows:o,allColumnsMeta:l,ensureCellIsVisible:a,focusGrid:i}=t,{state:r}=n,{key:s,shiftKey:d}=e,{rowIndex:c,colIndex:u}=r.selectedCell;if(null===c||null===u)return!1;const p=o.value.length,f=l.length;let g=null;if("ArrowUp"===s&&(g="up"),"ArrowDown"===s&&(g="down"),"ArrowLeft"===s&&(g="left"),"ArrowRight"===s&&(g="right"),g){e.preventDefault();const t=io(c,u,g,l,p,f);return d?n.extendSelection(t.rowIndex,t.colIndex):n.selectCell(t.rowIndex,t.colIndex),a&&await a(t.rowIndex,t.colIndex),!0}if("Tab"===s){e.preventDefault();const t=d?"left":"right",o=io(c,u,t,l,p,f);return n.selectCell(o.rowIndex,o.colIndex),a&&await a(o.rowIndex,o.colIndex),!0}if("Enter"===s){e.preventDefault();const t=io(c,u,"down",l,p,f);return n.selectCell(t.rowIndex,t.colIndex),a&&await a(t.rowIndex,t.colIndex),!0}return!1}const co="symptomOnset",uo="individualExposureTime";async function po(e,t,n,o){const{getOriginalIndex:l,allColumnsMeta:a,selectionSystem:i}=o;let r;if(r=e>=0?l(e):e,null===r||void 0===r)return void console.error("Could not determine original row index.");const s=a.find(e=>e.colIndex===t);if(!s||!s.isEditable)return;i.selectCell(r,t);const d=s.type===co||s.type===uo;d?await fo(r,t,n,o):await mo(r,t,n,o)}async function fo(e,t,o,l){const{allColumnsMeta:a}=l;if(!l.dateTimePickerRef||!l.dateTimePickerRef.value)return console.warn("[DateTimePicker] DateTimePicker reference not found, falling back to date-aware inline edit"),void await go(e,t,o,l);const i=a.find(e=>e.colIndex===t);if(!i)return;const r=e>=0?l.rows.value[e]:null,s=l.getCellValue(r,i,e),{parseDateTime:d}=await n.e(51).then(n.bind(n,6051)),c=d(s),u=o.target,p=u.getBoundingClientRect(),f=lo(p);l.dateTimePickerState?(l.dateTimePickerState.visible=!0,l.dateTimePickerState.position=f,l.dateTimePickerState.initialValue=c,l.dateTimePickerState.currentEdit={rowIndex:e,colIndex:t,columnMeta:i}):(console.warn("[DateTimePicker] dateTimePickerState not found in context"),await go(e,t,o,l))}async function go(e,t,n,o){await mo(e,t,n,o);const l=n.target,a=l.closest("td, th");if(a){const e=a._handleInput;a._handleInput=t=>{const n=t.target,o=n.textContent||"",l=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/;o&&o.length>=16&&!l.test(o)?(a.style.backgroundColor="#ffebee",a.title="YYYY-MM-DD HH:mm 형식으로 입력하세요"):(a.style.backgroundColor="",a.title=""),e&&e(t)}}}async function mo(e,t,n,o){const{allColumnsMeta:l,selectionSystem:a,getCellValue:i,rows:r,gridStore:s,storageManager:d}=o;if("undefined"!==typeof window&&window.startCellEditOverlay){const o=n.target,l=o.closest("td, th");if(l){let n;return e<0&&(n=l.innerText.trim()),void window.startCellEditOverlay(e,t,l,n)}}if(e<0)a.startEditing(e,t,i,null,s,l);else{const n=r.value[e];n&&a.startEditing(e,t,i,n,s,l)}await new Promise(e=>requestAnimationFrame(e));const c=n.target,u=c.closest("td, th");if(u){u.contentEditable="true",u.focus();const n=l.find(e=>e.colIndex===t);if(!n)return;const i=()=>{u.removeEventListener("blur",i),u.removeEventListener("focusout",i),u.removeEventListener("input",c),u.removeEventListener("keydown",p);const l=s.tempValue;if(null!==l){const a={cell:{rowIndex:e,colIndex:t,dataKey:n.dataKey||"",cellIndex:n.cellIndex},originalValue:"",value:l,columnMeta:n,editDuration:0,hasChanged:!0};d.executeSave(a),d.scheduleSave(a);try{o.validationManager&&o.validationManager.validateCell(e,t,l,n.type,!0)}catch(r){console.error("[DoubleClick] Validation failed:",r)}}s.confirmEditing(),a.stopEditing(!0)},c=e=>{const t=e.target,n=t.textContent||"";s.updateTempValue(n)},p=async n=>{if("Enter"===n.key){n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),i();const l=e<r.value.length-1?e+1:e;a.selectCell(l,t),o.ensureCellIsVisible&&await o.ensureCellIsVisible(l,t),o.focusGrid()}else if("Tab"===n.key){n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),i();const s=io(e,t,"right",l,r.value.length,l.length);a.selectCell(s.rowIndex,s.colIndex),o.ensureCellIsVisible&&await o.ensureCellIsVisible(s.rowIndex,s.colIndex),o.focusGrid()}else"Escape"===n.key&&(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),u.removeEventListener("blur",i),u.removeEventListener("focusout",i),u.removeEventListener("input",c),u.removeEventListener("keydown",p),s.cancelEditing(),a.stopEditing(!1))};u.addEventListener("blur",i),u.addEventListener("focusout",i),u.addEventListener("input",c),u.addEventListener("keydown",p);const f=document.createRange();f.selectNodeContents(u);const g=window.getSelection();g&&(g.removeAllRanges(),g.addRange(f))}}async function ho(e,t,l,a){const{selectionSystem:i,allColumnsMeta:r,startEditing:s,getCellValue:d,rows:c,gridStore:u}=t,{state:p}=i;if(p.isEditing)return;const f=r.find(e=>e.colIndex===a);if(!f||!f.isEditable)return;const g=l>=0?c.value[l]:null;s(l,a,d,g,u,r),await(0,o.dY)();const{parseDateTime:m}=await n.e(51).then(n.bind(n,6051)),h=t.getCellValue(g,f,l),v=m(h);let x;const I=l<0?`[data-col="${a}"]`:`[data-row="${l}"][data-col="${a}"]`,w=document.querySelector(I);x=w?w.getBoundingClientRect():e.target.getBoundingClientRect();const y=lo(x);w&&vo(w,e.key,null,t),t.dateTimePickerState?(t.dateTimePickerState.visible=!0,t.dateTimePickerState.position=y,t.dateTimePickerState.initialValue=v,t.dateTimePickerState.currentEdit={rowIndex:l,colIndex:a,columnMeta:f}):(console.warn("[DateTimePicker] dateTimePickerState not found in context"),await mo(l,a,e,t))}function vo(e,t,o=null,l=null){e.__dtKeyHandler&&e.removeEventListener("keydown",e.__dtKeyHandler);let a="",i=!1;const r=e.textContent?.trim()||"",s=r.match(/^(\d{4})-(\d{2})-(\d{2})\s+(\d{2}):(\d{2})$/);s&&(a=s.slice(1).join(""),i=!0);const d=/\d/,c=()=>{if(!document.getElementById("sep-style")){const e=document.createElement("style");e.id="sep-style",e.textContent=".sep.dim{color:#bbb;}.sep.on{color:#000;}",document.head.appendChild(e)}};c();const u=()=>{const e=[],t=t=>{e.push(t<a.length?a[t]:"&nbsp;")};for(let n=0;n<4;n++)t(n);e.push(`<span class="sep ${a.length>=4?"on":"dim"}">-</span>`);for(let n=4;n<6;n++)t(n);e.push(`<span class="sep ${a.length>=6?"on":"dim"}">-</span>`);for(let n=6;n<8;n++)t(n);e.push(`<span class="sep ${a.length>=8?"on":"dim"}">&nbsp;</span>`);for(let n=8;n<10;n++)t(n);e.push(`<span class="sep ${a.length>=10?"on":"dim"}">:</span>`);for(let n=10;n<12;n++)t(n);return e.join("")},p=t=>{const n=Math.min(t,12),o=e=>e<=4?e:e<=6?e+1:e<=8?e+2:e<=10?e+3:e+4,l=o(n);let a=0;const i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let r;while(r=i.nextNode()){const e=r.textContent?.length||0;if(a+e>=l){const t=l-a,n=document.createRange(),o=window.getSelection();return n.setStart(r,Math.min(t,e)),n.collapse(!0),void(o&&(o.removeAllRanges(),o.addRange(n)))}a+=e}const s=document.createRange();s.selectNodeContents(e),s.collapse(!1);const d=window.getSelection();d&&(d.removeAllRanges(),d.addRange(s))},f=(t=!1)=>{if(e.innerHTML=u(),t&&null!==o)for(const n of Array.from(e.childNodes)){const e=n,t=e.getBoundingClientRect?e.getBoundingClientRect():null;if(t&&o<=t.left+t.width/2){const e=document.createRange(),t=window.getSelection();return e.setStartBefore(n),e.collapse(!0),void(t&&(t.removeAllRanges(),t.addRange(e)))}}else p(a.length);e.dispatchEvent(new Event("input",{bubbles:!0})),l&&l.dateTimePickerState&&g()},g=()=>{if(!l||!l.dateTimePickerState)return;const e=m(a);e&&n.e(51).then(n.bind(n,6051)).then(({parseDateTime:t})=>{const n=t(e);l.dateTimePickerState&&(l.dateTimePickerState.initialValue=n)})},m=e=>{if(0===e.length)return"";const t=e.padEnd(12,"0"),n=t.slice(0,4),o=t.slice(4,6),l=t.slice(6,8),a=t.slice(8,10),i=t.slice(10,12),r=new Date(parseInt(n),parseInt(o)-1,parseInt(l),parseInt(a),parseInt(i));return isNaN(r.getTime())?"":`${n}-${o}-${l} ${a}:${i}`},h=async()=>{if(!l||!l.dateTimePickerState||!l.dateTimePickerState.currentEdit)return void console.warn("[DateTimeInput] No context or edit info for saving");const{rowIndex:e,colIndex:t,columnMeta:n}=l.dateTimePickerState.currentEdit;try{const o=m(a);if(o){const a={cell:{rowIndex:e,colIndex:t,dataKey:n.dataKey||"",cellIndex:n.cellIndex},originalValue:"",value:o,columnMeta:n,editDuration:0,hasChanged:!0};l.storageManager.executeSave(a),l.storageManager.scheduleSave(a),l.validationManager&&l.validationManager.validateCell(e,t,o,n.type,!0),l.gridStore.confirmEditing(),l.selectionSystem.stopEditing(!0),l.dateTimePickerState.visible&&(l.dateTimePickerState.visible=!1,l.dateTimePickerState.currentEdit=null)}else console.warn("[DateTimeInput] Invalid date format, cannot save")}catch(o){console.error("[DateTimeInput] Error saving value:",o)}};(a.length>0||""===r)&&f(!0),d.test(t)&&(a+=t,f());const v=e=>"Backspace"===e.key?(e.preventDefault(),i?(a="",i=!1):a=a.slice(0,-1),void f()):d.test(e.key)?(e.preventDefault(),i?(a=e.key,i=!1):a.length<12&&(a+=e.key),void f()):void 0;e.__dtKeyHandler=v,e.__dtSaveValue=h,e.addEventListener("keydown",v);const x=e=>{i&&(i=!1),e.stopPropagation()};e.addEventListener("mousedown",x),e.addEventListener("click",x),e.__dtStopProp=x;const I=async()=>{await h(),e.removeEventListener("keydown",v),e.removeEventListener("mousedown",x),e.removeEventListener("click",x),e.removeEventListener("blur",I),delete e.__dtKeyHandler,delete e.__dtSaveValue,delete e.__dtStopProp};if(e.addEventListener("blur",I),e.getAttribute("contenteditable")||e.setAttribute("contenteditable","true"),e.focus(),a.length>0){const t=window.getSelection();if(t){const n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}}}async function xo(e){const{selectionSystem:t,rows:n,allColumnsMeta:o,getCellValue:l}=e,{selectedRange:a,selectedRowsIndividual:i}=t.state;let r=[],s=-1,d=-1;if(i.size>0){r=Array.from(i).sort((e,t)=>e-t);const e=o.map(e=>e.colIndex).filter(e=>void 0!==e);s=Math.min(...e),d=Math.max(...e)}else{if(null===a.start.rowIndex||null===a.start.colIndex||null===a.end.rowIndex||null===a.end.colIndex)return;{const e=Math.min(a.start.rowIndex,a.end.rowIndex),t=Math.max(a.start.rowIndex,a.end.rowIndex),n=Math.min(a.start.colIndex,a.end.colIndex),o=Math.max(a.start.colIndex,a.end.colIndex);for(let l=e;l<=t;l++)r.push(l);s=n,d=o}}let c="";for(let p=0;p<r.length;p++){const e=r[p],t=[];for(let a=s;a<=d;a++){const i=o.find(e=>e.colIndex===a);if(i)if(e<0)t.push(l(null,i,e));else{const o=n.value[e];o?t.push(l(o,i,e)):t.push("")}}c+=t.join("\t"),p<r.length-1&&(c+="\n")}try{await navigator.clipboard.writeText(c)}catch(u){console.error("Failed to copy text: ",u),(0,Xt.P0)(e.t("common.copyFailed"),"error")}}async function Io(e){const{selectionSystem:t,ensureCellIsVisible:n,epidemicStore:o,allColumnsMeta:l,t:a}=e,{selectedCell:i}=t.state;if(null!==i.rowIndex&&null!==i.colIndex)try{const a=await navigator.clipboard.readText();if(!a)return;const r=_t();r.captureSnapshot("paste");const s=a.split(/\r?\n/).filter(e=>""!==e.trim()).map(e=>e.split("\t").map(e=>e.replace(/\r/g,"").trim())),d=i.rowIndex,c=i.colIndex,u=d+s.length;if(u>e.rows.value.length){const t=u-e.rows.value.length;o.addRows(t)}s.forEach((e,t)=>{const n=d+t;e.forEach((e,t)=>{const a=c+t,i=l.find(e=>e.colIndex===a);i&&i.dataKey&&i.isEditable&&o.updateCell({rowIndex:n,key:i.dataKey,value:e,cellIndex:i.cellIndex??void 0})})});const p=d+s.length-1,f=s.reduce((e,t)=>Math.max(e,t.length),0),g=c+f-1;t.setSelectionRange(d,c,p,g),n&&await n(d,c),e.validationManager&&e.validationManager.handlePasteData(s,d,c,l)}catch(r){console.error("Failed to paste text: ",r),(0,Xt.P0)(a("common.pasteFailed"),"error")}}function wo(e){return 1===e.length&&!/[`~]/.test(e)}async function yo(e,t){const{selectionSystem:n,rows:l,allColumnsMeta:a,startEditing:i,getCellValue:r,gridStore:s,storageManager:d,epidemicStore:c,focusGrid:u,ensureCellIsVisible:p}=t,{state:f}=n;if(f.isEditing)return;const{rowIndex:g,colIndex:m}=f.selectedCell;if(null===g||null===m)return;const h=a.find(e=>e.colIndex===m);if(!h||!h.isEditable)return;const v="symptomOnset"===h.type||"individualExposureTime"===h.type;try{if(t.overlayController){const n=g<0?`th[data-col="${m}"]`:`td[data-row="${g}"][data-col="${m}"]`,o=document.querySelector(n);if(o)return void t.overlayController.open(g,m,o,e.key)}if(g<0)i(g,m,r,null,t.gridStore,a);else{const e=l.value[g];e&&i(g,m,r,e,t.gridStore,a)}await(0,o.dY)();const c=g<0?`[data-col="${m}"]`:`[data-row="${g}"][data-col="${m}"]`,f=document.querySelector(c);if(f)if(f.focus(),v)vo(f,e.key,null,t);else{const i=e=>{const t=e.target.textContent||"";s.updateTempValue(t)},r=()=>{f.removeEventListener("blur",r),f.removeEventListener("focusout",r),f.removeEventListener("input",i),f.removeEventListener("keydown",c);const e=s.tempValue;if(null!==e){const o={cell:{rowIndex:g,colIndex:m,dataKey:h.dataKey||"",cellIndex:h.cellIndex},originalValue:"",value:e,columnMeta:h,editDuration:0,hasChanged:!0};d.executeSave(o);try{t.validationManager&&t.validationManager.validateCell(g,m,e,h.type,!0)}catch(n){console.error("[TypeToEdit] Validation failed:",n)}}s.confirmEditing(),t.selectionSystem.stopEditing(!0)},c=e=>{const t=l.value.length,i=a.length;if("Enter"===e.key){e.preventDefault(),e.stopPropagation(),r();const l=g<t-1?g+1:g,a=g<0?0:l;n.selectCell(a,m),p&&p(a,m),(0,o.dY)(()=>{u()})}else if("Tab"===e.key){e.preventDefault(),e.stopPropagation(),r();const l=io(g,m,"right",a,t,i);n.selectCell(l.rowIndex,l.colIndex),p&&p(l.rowIndex,l.colIndex),(0,o.dY)(()=>{u()})}};f.addEventListener("input",i),f.addEventListener("blur",r),f.addEventListener("focusout",r),f.addEventListener("keydown",c),f.getAttribute("contenteditable")||f.setAttribute("contenteditable","true"),f.textContent=e.key;const v=document.createRange(),x=window.getSelection();v.selectNodeContents(f),v.collapse(!1),x&&(x.removeAllRanges(),x.addRange(v));const I=new Event("input",{bubbles:!0});f.dispatchEvent(I),s.updateTempValue(e.key)}}catch(x){console.error("Error in handleTypeToEdit:",x)}}async function Co(e){const{selectionSystem:t,allColumnsMeta:n,epidemicStore:o}=e,{selectedRange:l,selectedCellsIndividual:a,selectedRowsIndividual:i}=t.state,r=_t();r.captureSnapshot("clear_selection");if(i.size>0){const e=Array.from(i);o.clearIndividualRowsData({rowIndices:e})}if(a.size>0)for(const d of a){const[e,t]=d.split("_"),l=parseInt(e,10),a=parseInt(t,10),i=n.find(e=>e.colIndex===a);i&&i.dataKey&&o.updateCell({rowIndex:l,key:i.dataKey,value:"",cellIndex:i.cellIndex??void 0})}if(null!==l.start.rowIndex&&null!==l.start.colIndex&&null!==l.end.rowIndex&&null!==l.end.colIndex&&0===i.size&&0===a.size){const e=[];for(let t=l.start.rowIndex;t<=l.end.rowIndex;t++)for(let o=l.start.colIndex;o<=l.end.colIndex;o++){const l=n.find(e=>e.colIndex===o);l&&l.dataKey&&l.isEditable&&e.push({rowIndex:t,key:l.dataKey,value:"",cellIndex:l.cellIndex??void 0})}e.length>0&&o.updateCellsBatch(e)}const s=[];if(i.size>0&&e.validationManager&&i.forEach(t=>e.validationManager?.clearErrorsForRow(t)),a.size>0&&a.forEach(e=>{const[t,n]=e.split("_").map(Number);s.push({row:t,col:n})}),null!==l.start.rowIndex&&null!==l.start.colIndex&&null!==l.end.rowIndex&&null!==l.end.colIndex&&0===i.size&&0===a.size)for(let d=l.start.rowIndex;d<=l.end.rowIndex;d++)for(let e=l.start.colIndex;e<=l.end.colIndex;e++)s.push({row:d,col:e});return s.length>0&&e.validationManager&&(e.validationManager.clearErrorsForCells(s),e.validationManager.handleDataClear(s)),{changed:!0}}async function bo(e,t){const{selectionSystem:n,rows:l,allColumnsMeta:a,ensureCellIsVisible:i,stopEditing:r,focusGrid:s,gridStore:d,storageManager:c}=t,{state:u}=n,{rowIndex:p,colIndex:f}=u.editingCell,{key:g}=e;if(null===p||null===f)return!1;if(t.overlayController?.isVisible()){if("Enter"===g){e.preventDefault(),e.stopPropagation(),t.overlayController.confirm(d.tempValue||""),await(0,o.dY)();const a=p<l.value.length-1?p+1:p,r=p<0?0:a;return n.selectCell(r,f),i&&await i(r,f),s(),!0}if("Tab"===g){e.preventDefault(),e.stopPropagation(),t.overlayController.confirm(d.tempValue||""),await(0,o.dY)();const r=l.value.length,c=a.length,u=io(p,f,"right",a,r,c);return n.selectCell(u.rowIndex,u.colIndex),i&&await i(u.rowIndex,u.colIndex),s(),!0}if("Escape"===g)return e.preventDefault(),e.stopPropagation(),t.overlayController.close(),d.cancelEditing(),r(!1),s(),!0;const{ctrlKey:c,metaKey:u,altKey:m}=e;if(wo(g)&&!c&&!u&&!m&&1===g.length)return e.preventDefault(),e.stopPropagation(),t.overlayController.append(g),!0}const m=l.value.length;if("Escape"===g)return e.preventDefault(),d.cancelEditing(),r(!1),await(0,o.dY)(),s(),!0;if("Enter"===g){e.preventDefault();const l=d.tempValue,u=a.find(e=>e.colIndex===f);if(null!==l&&u){const e={cell:{rowIndex:p,colIndex:f,dataKey:u.dataKey||"",cellIndex:u.cellIndex},originalValue:"",value:l,columnMeta:u,editDuration:0,hasChanged:!0};c.executeSave(e),t.validationManager&&t.validationManager.validateCell(p,f,l,u.type,!0)}d.confirmEditing(),r(!0);const g=p<m-1?p+1:p,h=p<0?0:g;return n.selectCell(h,f),i&&await i(h,f),await(0,o.dY)(),s(),!0}if("Tab"===g){e.preventDefault();const l=d.tempValue,u=a.find(e=>e.colIndex===f);if(null!==l&&u){const e={cell:{rowIndex:p,colIndex:f,dataKey:u.dataKey||"",cellIndex:u.cellIndex},originalValue:"",value:l,columnMeta:u,editDuration:0,hasChanged:!0};c.executeSave(e),t.validationManager&&t.validationManager.validateCell(p,f,l,u.type,!0)}d.confirmEditing(),r(!0);const g=p,h=f,v=a.length,x=io(g,h,"right",a,m,v);return n.selectCell(x.rowIndex,x.colIndex),i&&await i(x.rowIndex,x.colIndex),await(0,o.dY)(),s(),!0}const h=a.find(e=>e.colIndex===f),v=h&&("symptomOnset"===h.type||"individualExposureTime"===h.type);if(v){const t=p<0?`[data-col="${f}"]`:`[data-row="${p}"][data-col="${f}"]`,n=document.querySelector(t);if(/\d/.test(g)){if(e.preventDefault(),n&&n.__dtKeyHandler){const e=new KeyboardEvent("keydown",{key:g});n.__dtKeyHandler(e)}return!0}if("Backspace"===g){if(e.preventDefault(),n&&n.__dtKeyHandler){const e=new KeyboardEvent("keydown",{key:g});n.__dtKeyHandler(e)}return!0}if("Tab"===g||"Enter"===g)return e.preventDefault(),n&&n.__dtSaveValue&&await n.__dtSaveValue(),!0}return!1}async function Eo(e,t){const{selectionSystem:n,rows:l,allColumnsMeta:a,ensureCellIsVisible:i,isEditing:r,startEditing:s,getCellValue:d,gridStore:c}=t,{state:u}=n,{key:p,ctrlKey:f,shiftKey:g,metaKey:m}=e,h=f||m;if(r)return void await bo(e,t);if(null===u.selectedCell.rowIndex)return;if(h){if("c"===p.toLowerCase())return e.preventDefault(),void await xo(t);if("v"===p.toLowerCase())return e.preventDefault(),await Io(t),void await Io(t);if("z"===p.toLowerCase()&&!g){e.preventDefault();const t=_t();return void(t.canUndo&&t.undo())}if("y"===p.toLowerCase()||"z"===p.toLowerCase()&&g){e.preventDefault();const t=_t();return void(t.canRedo&&t.redo())}}const{rowIndex:v,colIndex:x}=u.selectedCell;if(null===v||null===x)return;let I=v,w=x;if(f){let t=null;if("ArrowUp"===p&&(t="up"),"ArrowDown"===p&&(t="down"),"ArrowLeft"===p&&(t="left"),"ArrowRight"===p&&(t="right"),t){if(e.preventDefault(),"left"===t&&1===x)return;const o=ro(v,x,t,l.value,a);return I=o.rowIndex,w=o.colIndex,void(null!==I&&null!==w&&("left"===t&&(w=Math.max(1,w)),g?n.extendSelection(I,w):n.selectCell(I,w),i&&await i(I,w)))}}if(!await so(e,t)){if("F2"===p)if(e.preventDefault(),v<0){if(s){s(v,x,d,null,c,a),await(0,o.dY)();const e=document.querySelector(`[data-col="${x}"]`);e&&e.focus()}}else{const e=l.value[v];if(e&&s){s(v,x,d,e,c,a),await(0,o.dY)();const t=document.querySelector(`[data-row="${v}"][data-col="${x}"]`);t&&t.focus()}}else if(wo(p)&&!f&&!e.metaKey){e.preventDefault();const n=a.find(e=>e.colIndex===x),o=n&&("symptomOnset"===n.type||"individualExposureTime"===n.type);o&&null!==v&&null!==x?ho(e,t,v,x):yo(e,t)}if("Delete"===p||"Backspace"===p){e.preventDefault();await Co(t);return}}}function So(e,t,n,o,a,i,r,s,d,c,u,p,f,g,m){const h=Et(),v=(0,Ct.X)(),x=(0,l.KR)(null),I=(0,l.KR)(null);function w(e,t,n=-1){if(!t)return"";if(n<0){const e=t.headerText||"";return e.replace(/<br\s*\/?>/gi," ").replace(/<[^>]*>/g,"").trim()}if("serial"===t.type)return e&&void 0!==e._originalIndex?e._originalIndex+1:n+1;if(!e||!t.dataKey)return"";if(null!==t.cellIndex&&void 0!==t.cellIndex){const n=e[t.dataKey];return n&&Array.isArray(n)?n[t.cellIndex]??"":""}return e[t.dataKey]??""}const y=e=>{if(e<0)return e;const t=o.value;if(e>=t.length)return e;const n=t[e];return n?._originalIndex??e};function C(){return{getOriginalIndex:y,allColumnsMeta:t.value,selectionSystem:e,rows:n,filteredRows:o,getCellValue:w,gridStore:h,epidemicStore:v,storageManager:f,validationManager:r,dateTimePickerRef:d,dateTimePickerState:s,ensureCellIsVisible:i,focusGrid:a,gridBodyContainer:c.value?.bodyContainer||c.value?.$el||c.value,isEditing:e.state.isEditing,startEditing:e.startEditing.bind(e),stopEditing:e.stopEditing.bind(e),t:g,overlayController:m}}function b(e,t,n,o){to(e,t,n,o)}function E(e,t){no(e,t)}function S(e,t){oo(e,t)}function R(o,l,i){if(s.visible&&u(),"undefined"!==typeof window&&window.isCellEditOverlayVisible?.()&&window.closeCellEditOverlay?.(),2===i.button)return;const d=o;n.value[o];if(e.state.isEditing&&e.state.editingCell.rowIndex===d&&e.state.editingCell.colIndex===l)return void(0,qn.gg)("[UseGridInteraction] 편집 모드에서 같은 셀 클릭 - 텍스트 커서 이동만 허용");if(e.state.isEditing&&(e.state.editingCell.rowIndex!==d||e.state.editingCell.colIndex!==l)&&2!==i.detail){const{rowIndex:n,colIndex:o}=e.state.editingCell,l=h.tempValue,a=t.value.find(e=>e.colIndex===o);if(null!==l&&a){const e={cell:{rowIndex:n,colIndex:o,dataKey:a.dataKey||"",cellIndex:a.cellIndex},originalValue:"",value:l,columnMeta:a,editDuration:0,hasChanged:!0};f.executeSave(e),f.scheduleSave(e),(0,qn.gg)(`[UseGridInteraction] 다른 셀 클릭으로 편집 완료: ${n}, ${o} = ${l}`),r&&r.validateCell(n,o,l,a.type,!0)}h.confirmEditing(),e.stopEditing(!0)}a();const c=C();b(d,l,i,c),x.value=e=>M(e),I.value=e=>_(e),document.addEventListener("mousemove",x.value),document.addEventListener("mouseup",I.value,{once:!0})}function M(e){const t=C();E(e,t)}function _(e){x.value&&(document.removeEventListener("mousemove",x.value),x.value=null);const t=C();S(e,t)}function k(e,t,n){const o=C();po(e,t,n,o)}function D(n){const{rowIndex:o,colIndex:l}=e.state.selectedCell;if(null===o||null===l)return;const a=t.value.find(e=>e.colIndex===l);a&&a.isEditable&&h.updateTempValue(void 0!==n&&null!==n?String(n):"")}function $(){const{rowIndex:t,colIndex:o}=e.state.selectedCell;if(null===t||null===o)return;let l=t;t<0?l=0:t<n.value.length-1&&(l=t+1),e.selectCell(l,o),i(l,o),a()}function T(e){if(s.visible)switch(e.key){case"Escape":return e.preventDefault(),e.stopPropagation(),void p();case"Enter":case"Tab":return e.preventDefault(),e.stopPropagation(),void(d.value?.confirm&&d.value.confirm());default:return}const t=C();Eo(e,t)}function V(e,n,o=!0){if(!o)return void h.cancelEditing();const l=h.tempValue;if(null!==l){const o=t.value.find(e=>e.colIndex===n);if(o){const t={cell:{rowIndex:e,colIndex:n,dataKey:o.dataKey||"",cellIndex:o.cellIndex},originalValue:"",value:l,columnMeta:o,editDuration:0,hasChanged:!0};f.executeSave(t),(0,qn.gg)(`[DataInputVirtual] Validation 호출: row=${e}, col=${n}, value="${l}", type="${o.type}"`),r&&r.validateCell(e,n,l,o.type,!0)}}h.confirmEditing()}function F(){x.value&&document.removeEventListener("mousemove",x.value),I.value&&document.removeEventListener("mouseup",I.value)}return{onCellMouseDown:R,onCellDoubleClick:k,onKeyDown:T,onUpdateCellValueFromBar:D,onEnterPressedFromBar:$,onCellEditComplete:V,getCellValue:w,cleanupInteractionListeners:F,onDocumentMouseMoveBound:x,onDocumentMouseUpBound:I}}var Ro=n(3230);function Mo(e,t){const n={serial:0},o=e.findIndex(e=>e?.toString().includes("환자여부")||e?.toString().includes("환자 여부"));n.isPatient=-1!==o?o:1;const l=e.findIndex(e=>e?.toString().includes("확진여부")||e?.toString().includes("확진 여부"));n.isConfirmedCase=-1!==l?l:-1;const a=e.findIndex(e=>e?.toString().includes("기본정보"));if(-1===a)throw new Error("기본정보 카테고리 없음");let i=a+1;while(i<e.length&&(!e[i]||""===e[i].toString().trim()))i++;n.basic={start:a,end:i};const r=e.findIndex(e=>e?.toString().includes("임상증상"));if(-1===r)throw new Error("임상증상 카테고리 없음");let s=r+1;while(s<e.length&&(!e[s]||""===e[s].toString().trim()))s++;n.clinical={start:r,end:s};const d=t.findIndex(e=>e?.toString().includes("증상발현시간")||e?.toString().includes("발현시간"));if(-1===d)throw new Error("증상발현시간 컬럼 없음");n.symptomOnset=d;const c=t.findIndex(e=>"string"===typeof e&&(e.includes("의심원노출시간")||e.includes("의심원 노출시간")));n.individualExposureTime=c;const u=e.findIndex(e=>e?.toString().includes("식단"));if(-1===u)throw new Error("식단 카테고리 없음");return n.diet={start:u,end:t.length},n}function _o(e){if(null===e||void 0===e||""===String(e).trim())return"";const t=String(e).trim();if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/.test(t))return t;const n=Number(e);if(!isNaN(n)&&n>1){const e=Ro.tF.parse_date_code(n);if(e&&e.y){const t=e.y,n=String(e.m).padStart(2,"0"),o=String(e.d).padStart(2,"0"),l=String(e.H||0).padStart(2,"0"),a=String(e.M||0).padStart(2,"0");return`${t}-${n}-${o} ${l}:${a}`}}const o=new Date(t);if(!isNaN(o.getTime())){const e=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0"),l=String(o.getHours()).padStart(2,"0"),a=String(o.getMinutes()).padStart(2,"0");return`${e}-${t}-${n} ${l}:${a}`}return t}function ko(e,t,n,o){const l=[],a=[];let i=0;for(let s=n;s<o;s++)e[s]?.toString().trim()?(l.push(s),a.push(e[s].toString().trim())):i++;const r=t.map(e=>l.map(t=>(e[t]??"").toString().trim()));return{headers:a,rows:r,emptyColumnCount:i}}function Do(e,t,n,o,l,a,i,r,s,d,c,u){const p=Math.min(e+t,n.length);for(let g=e;g<p;g++){const e=n[g];o.push({isPatient:(e[l.isPatient]??"").toString().trim(),isConfirmedCase:d?(e[l.isConfirmedCase]??"").toString().trim():"",basicInfo:a.rows[g]||[],clinicalSymptoms:i.rows[g]||[],symptomOnset:_o(e[l.symptomOnset]),individualExposureTime:s?_o(e[l.individualExposureTime]):"",dietInfo:r.rows[g]||[]})}const f=70+Math.round(p/n.length*25);if(c(f),p<n.length)"undefined"!==typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(()=>Do(p,100,n,o,l,a,i,r,s,d,c,u)):setTimeout(()=>Do(p,100,n,o,l,a,i,r,s,d,c,u),0);else{const e=a.emptyColumnCount+i.emptyColumnCount+r.emptyColumnCount;c(100),u({headers:{basic:a.headers,clinical:i.headers,diet:r.headers},rows:o,hasIndividualExposureTime:s,hasConfirmedCase:d,emptyColumnCount:e})}}function $o(e,t=()=>{}){return e instanceof File?new Promise((n,o)=>{e.arrayBuffer().then(e=>{try{t(5);const o=Ro.LF(new Uint8Array(e),{type:"array"});t(20);const l=o.SheetNames[0],a=o.Sheets[l],i=Ro.Wp.sheet_to_json(a,{header:1,raw:!1});t(40);const[r=[],s=[]]=i,d=i.slice(2),c=Mo(r,s),u=-1!==c.individualExposureTime,p=-1!==c.isConfirmedCase,f=ko(s,d,c.basic.start,c.basic.end),g=ko(s,d,c.clinical.start,c.clinical.end),m=ko(s,d,c.diet.start,c.diet.end);t(50);const h=d.filter(e=>{const t=e.slice(1);return t.some(e=>null!==e&&void 0!==e&&""!==e.toString().trim())});t(70);const v=[];Do(0,100,h,v,c,f,g,m,u,p,t,n)}catch(l){o(new Error(l.message||"Excel 파싱 실패"))}}).catch(e=>o(e))}):Promise.reject(new Error("유효한 파일이 아닙니다."))}function To(e,t=()=>{}){if(!(e instanceof File))return Promise.reject(new Error("유효한 파일이 아닙니다."));const o="file:"===window.location.protocol;return o?$o(e,t):new Promise((o,l)=>{e.arrayBuffer().then(a=>{const i=Dn(new URL(n(2245),n.b));if(!i)return $o(e,t).then(o).catch(l);i.onmessage=e=>{const{type:n,data:a,progress:r,error:s}=e.data||{};switch(n){case"progress":t(r);break;case"complete":t(100),i.terminate(),o(a);break;case"error":i.terminate(),l(new Error(s||"Excel 파싱 실패"));break;default:break}},i.onerror=n=>{i.terminate(),console.warn("[ExcelProcessor] Worker failed, falling back to async processor:",n),$o(e,t).then(o).catch(l)},i.postMessage({buffer:a},[a]),t(5)}).catch(e=>l(e))})}function Vo(){const e=(e,n=!1,o=!1)=>{const l=[],a=[],i=["serial","isPatient",...o?["isConfirmedCase"]:[],"basic","clinicalSymptoms",...n?["individualExposureTime"]:[],"symptomOnset","dietInfo"];return i.forEach(n=>{const o=e.filter(e=>e.type===n);"basic"===n?o.forEach((e,n)=>{0===n?l.push("기본정보"):l.push(""),a.push(t(e))}):"clinicalSymptoms"===n?o.forEach((e,n)=>{0===n?l.push("임상증상"):l.push(""),a.push(t(e))}):"dietInfo"===n?o.forEach((e,n)=>{0===n?l.push("식단"):l.push(""),a.push(t(e))}):"serial"===n?(l.push("연번"),a.push("")):"isPatient"===n?(l.push("환자여부"),a.push("")):"isConfirmedCase"===n?(l.push("확진여부"),a.push("")):"symptomOnset"===n?(l.push("yyyy/mm/dd OR yyyy-mm-dd hh:mm "),a.push("증상발현시간")):"individualExposureTime"===n&&(l.push("yyyy/mm/dd OR yyyy-mm-dd hh:mm "),a.push("의심원 노출시간"))}),{headerRow1:l,headerRow2:a}},t=e=>e&&e.headerText?e.headerText.replace(/<br\s*\/?>/gi," ").replace(/<[^>]*>/g,"").trim():"",n=(e,t=!1,n=!1)=>{const o=["serial","isPatient",...n?["isConfirmedCase"]:[],"basic","clinicalSymptoms",...t?["individualExposureTime"]:[],"symptomOnset","dietInfo"],l=[];return o.forEach(t=>{const n=e.filter(e=>e.type===t);l.push(...n)}),l},o=e=>{if(!e||""===e.toString().trim())return"";const t=e.toString().trim(),n=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/;if(n.test(t))return t;try{const e=new Date(t);if(!isNaN(e.getTime())){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),l=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return`${t}-${n}-${o} ${l}:${a}`}}catch(o){console.warn("Date conversion failed:",o)}return t},l=(e,t)=>e||0===e?"symptomOnset"===t.type||"individualExposureTime"===t.type?o(e):e.toString():"",a=(e,t,n,o=!1,l=!1)=>{const a=[];let i=0;const r=["serial","isPatient",...l?["isConfirmedCase"]:[],"basic","clinicalSymptoms",...o?["individualExposureTime"]:[],"symptomOnset","dietInfo"];return r.forEach(e=>{const t=n.filter(t=>t.type===e);"serial"===e||"isPatient"===e||"isConfirmedCase"===e?t.length>0&&(a.push({s:{c:i,r:0},e:{c:i,r:1}}),i+=t.length):"basic"===e||"clinicalSymptoms"===e?(t.length>1&&a.push({s:{c:i,r:0},e:{c:i+t.length-1,r:0}}),i+=t.length):"symptomOnset"===e||"individualExposureTime"===e?i+=t.length:"dietInfo"===e&&(t.length>1&&a.push({s:{c:i,r:0},e:{c:i+t.length-1,r:0}}),i+=t.length)}),a},i=()=>{const e=new Date,t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),l=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return`${t}-${n}-${o} ${l}-${a}`},r=(t,o,r,s=!1,d=!1,c)=>{try{c||(c=`Easy-Epi_exported_data_${i()}.xlsx`);const{headerRow1:u,headerRow2:p}=e(t,s,d),f=n(t,s,d),g=o.map((e,t)=>f.map(n=>{const o=r(e,n,t);return l(o,n)})),m=[u,p,...g],h=a(u,p,t,s,d),v=Ro.Wp.book_new(),x=Ro.Wp.aoa_to_sheet(m);h.length>0&&(x["!merges"]=h),x["!freeze"]={xSplit:1,ySplit:2},Ro.Wp.book_append_sheet(v,x,"Sheet1"),Ro._h(v,c)}catch(u){throw console.error("스마트 내보내기 실패:",u),new Error(`스마트 내보내기 중 오류가 발생했습니다: ${u.message}`)}},s=(e,t=[],n="exported_data.xlsx")=>{try{if(!e)throw new Error("워크시트 데이터가 제공되지 않았습니다.");const o=Ro.Wp.book_new(),l=Ro.Wp.aoa_to_sheet(e);t.length&&(l["!merges"]=t),Ro.Wp.book_append_sheet(o,l,"Sheet1"),Ro._h(o,n)}catch(o){console.error("XLSX 다운로드 실패:",o)}},d=(e="basic")=>{const t=document.createElement("a"),n="/";"individual"===e?(t.href=`${n}Easy-Epidemiology_Individual_Exposure_Time_Template.xlsx`,t.setAttribute("download","Easy-Epidemiology_Individual_Exposure_Time_Template.xlsx")):(t.href=`${n}Easy-Epidemiology_Template.xlsx`,t.setAttribute("download","Easy-Epidemiology_Template.xlsx")),document.body.appendChild(t),t.click(),document.body.removeChild(t)};return{downloadXLSX:s,downloadXLSXSmart:r,downloadTemplate:d,generateStandardHeaders:e,generateMerges:a,reorderColumnsForExport:n,ensureDateTimeFormat:o,formatCellValue:l}}function Fo(e,t,n,a,i,r,s={},d=e=>e){const c=(0,Ct.X)(),u=Et(),p=_t(),f=(0,l.KR)(!1),g=(0,l.KR)(0),{downloadXLSXSmart:m,downloadTemplate:h}=Vo(),v=(0,l.KR)(!1);async function x(t){if(n("excel_upload",{blocking:!0,timeout:6e4})){f.value=!0,g.value=0;try{e&&e.clearAllErrors(),qn.vF.debug("[Excel] 필터 초기화 시작"),u.clearAllFilters(),qn.vF.debug(`[Excel] 파일 처리 시작: ${t.name}`);const{headers:n,rows:l}=await To(t,e=>{v.value&&(g.value=Math.round(e))});if(!v.value)return void qn.vF.warn("[Excel] 컴포넌트 언마운트로 업로드 중단");if(qn.vF.debug("[Excel] 헤더 분석 결과:",n),p.captureSnapshot("excel_upload"),c.setInitialData({headers:n,rows:l}),e&&i.value.length>0&&l.length>0){qn.vF.debug("[Excel] 가져온 데이터에 대한 유효성 검사 시작"),e.updateColumnMetas(i.value);try{await e.revalidateAll(c.rows,i.value,{useAsyncProcessor:!0,chunkSize:100}),qn.vF.debug("[Excel] 유효성 검사 완료")}catch(o){qn.vF.warn("[Excel] 유효성 검사 중 오류:",o)}}v.value&&(0,Xt.P0)(d("dataInput.toast.excel.uploadSuccess"),"success")}catch(l){if(!v.value)return;qn.vF.error("[Excel] 업로드 중 오류:",l),(0,Xt.P0)(`${d("dataInput.toast.error")}: ${l.message}`,"error")}finally{v.value&&(f.value=!1,a("excel_upload"))}}}async function I(){if(n("excel_export",{blocking:!0,timeout:3e4}))try{const e=new Date,t=e.toISOString().replace(/[-:T]/g,"").slice(0,12),n=`data_${t}.xlsx`,o=(0,l.R1)(s.hasIndividualExposure)??!1,a=(0,l.R1)(s.hasConfirmedCase)??!1;await m(i.value,c.rows,r,o,a,n),(0,Xt.P0)(d("dataInput.toast.excel.exportSuccess"),"success")}catch(e){qn.vF.error("[Excel] 내보내기 중 오류:",e),(0,Xt.P0)(`${d("dataInput.toast.error")}: ${e.message}`,"error")}finally{a("excel_export")}}function w(e){if(n("download_template"))try{h(e),(0,Xt.P0)(d("dataInput.toast.excel.templateSuccess"),"success")}catch(t){qn.vF.error("[Excel] 템플릿 다운로드 중 오류:",t),(0,Xt.P0)(d("dataInput.toast.excel.templateError"),"error")}finally{a("download_template")}}async function y(){if(n("copy_data"))try{const e=await(0,Xt.VV)(d("dataInput.toast.excel.copyConfirm"));if(!e)return void a("copy_data");const t=c.rows,n=i.value,o=500,l=[],s=n.map(e=>(e.headerText||"").replace(/<br\s*\/?>/gi," ").replace(/<[^>]*>/g,"").trim()).join("\t");l.push(s);for(let a=0;a<t.length;a+=o){if(!v.value)return;const e=t.slice(a,a+o),i=e.map((e,t)=>{const o=a+t;return n.map(t=>r(e,t,o)??"").join("\t")}).join("\n");l.push(i),await new Promise(e=>setTimeout(e,0))}const u=l.join("\n");if(!v.value)return;await navigator.clipboard.writeText(u),(0,Xt.P0)(d("dataInput.toast.excel.copySuccess"),"success")}catch(e){qn.vF.error("[Excel] 복사 중 오류:",e),(0,Xt.P0)(d("dataInput.toast.excel.copyError"),"error")}finally{a("copy_data")}}function C(e){x(e)}return(0,o.sV)(()=>{v.value=!0}),(0,o.xo)(()=>{v.value=!1}),{isUploadingExcel:f,excelUploadProgress:g,onExcelFileSelected:x,onExportData:I,onDownloadTemplate:w,onCopyEntireData:y,onFileDropped:C}}function Ko(e,t,n){const o=n.gridStore?.filterState||n.storeBridge?.filterState;if(!o)return!1;let l=String(e);if(n.allColumnsMeta){const t=n.allColumnsMeta.find(t=>t.colIndex===e);t&&(t.dataKey&&void 0!==t.cellIndex&&null!==t.cellIndex?l=`${t.dataKey}-${t.cellIndex}`:t.dataKey&&(l=t.dataKey))}const a=o.activeFilters.get(l);return!!a&&(Array.isArray(a)?a.includes(t):a===t)}function Ao(e,t){const{rows:n,filteredRows:o,allColumnsMeta:l}=t,a=l.find(t=>t.colIndex===e);if(!a||!a.dataKey)return[];const i=n.value||n,r=(o.value,t.gridStore?.filterState||t.storeBridge?.filterState);r?.activeFilters?.get(e);if(!i||!Array.isArray(i))return[];const s=i;if(!s||!Array.isArray(s))return[];let d=String(e);a.dataKey&&void 0!==a.cellIndex&&null!==a.cellIndex?d=`${a.dataKey}-${a.cellIndex}`:a.dataKey&&(["isPatient","isConfirmedCase","symptomOnset","individualExposureTime"].includes(a.dataKey)||t.gridStore?.activeFilters?.has(a.dataKey))&&(d=a.dataKey);const c=t.gridStore?.activeFilters,u=new Map;if(c)for(const[g,m]of c.entries())g!==d&&u.set(g,m);const p=new Map;s.forEach(e=>{let n=!0;if(u.size>0&&t.gridStore?.matchesFilter)for(const[l,a]of u.entries())if(!t.gridStore.matchesFilter(e,l,a)){n=!1;break}if(!n)return;let o="";null!==a.cellIndex&&void 0!==a.cellIndex?e[a.dataKey]&&Array.isArray(e[a.dataKey])&&(o=String(e[a.dataKey][a.cellIndex]??"")):o=String(e[a.dataKey]??""),"null"!==o&&"undefined"!==o&&""!==o||(o=""),p.set(o,(p.get(o)||0)+1)});const f=Array.from(p.entries()).map(([e,t])=>({value:e,count:t}));return f.sort((e,t)=>{if(""===e.value&&""!==t.value)return 1;if(""!==e.value&&""===t.value)return-1;const n=parseFloat(e.value),o=parseFloat(t.value);return isNaN(n)||isNaN(o)?e.value.localeCompare(t.value):n-o}),f}function Oo(e,t){const{rows:n,filteredRows:o,allColumnsMeta:l}=t,a=l.find(t=>t.colIndex===e);if(!a||!a.dataKey)return[];const i=n.value||n,r=(o.value,t.gridStore?.filterState||t.storeBridge?.filterState);r?.activeFilters?.get(e);if(!i||!Array.isArray(i))return[];const s=i;if(!s||!Array.isArray(s))return[];const d=e=>{if(!e||""===e)return"";const t=e.match(/^(\d{4}-\d{2}-\d{2})/);if(t)return t[1];const n=e.match(/^(\d{4}[/-]\d{2}[/-]\d{2})/);return n?n[1].replace(/[/]/g,"-"):e},c=a.dataKey||String(e),u=t.gridStore?.activeFilters,p=new Map;if(u)for(const[m,h]of u.entries())m!==c&&p.set(m,h);const f=new Map;s.forEach(e=>{let n=!0;if(p.size>0&&t.gridStore?.matchesFilter)for(const[a,i]of p.entries())if(!t.gridStore.matchesFilter(e,a,i)){n=!1;break}if(!n)return;const o=String(e[a.dataKey]??"");if("null"===o||"undefined"===o||""===o)return void f.set("",(f.get("")||0)+1);const l=d(o);f.set(l,(f.get(l)||0)+1)});const g=Array.from(f.entries()).map(([e,t])=>({date:e,count:t}));return g.sort((e,t)=>""===e.date&&""!==t.date?1:""!==e.date&&""===t.date?-1:e.date.localeCompare(t.date)),g}const Lo=(e,t)=>a.A.global.t(e,t);function Po(e,t,n,o){e.preventDefault();const{getOriginalIndex:l,selectionSystem:a,showContextMenu:i,allColumnsMeta:r}=o,s=t>=0?l(t):t;if(!a.state.isDragging){const e=a.state.selectedRowsIndividual.has(s),t=a.state.selectedCellsIndividual.has(`${s}_${n}`),{selectedRange:o}=a.state,l=null!==o.start.rowIndex&&null!==o.end.rowIndex&&s>=o.start.rowIndex&&s<=o.end.rowIndex&&null!==o.start.colIndex&&null!==o.end.colIndex&&n>=o.start.colIndex&&n<=o.end.colIndex;l||e||t||(a.clearIndividualSelections(),n===nn&&s>=0?a.selectRow(s,r):a.selectCell(s,n))}const d=No(s,n,a.state,r,o),c={rowIndex:s,colIndex:n};d.length>0?i(e.clientX,e.clientY,d,c):console.warn("[ContextMenu] No menu items generated for:",{originalRowIndex:s,colIndex:n,targetColumn:r.find(e=>e.colIndex===n)})}function No(e,t,n,o,l){const{selectedRange:a,selectedRowsIndividual:i,selectedCellsIndividual:r}=n,s=o.find(e=>e.colIndex===t),d=i.size,c=r.size,u=null!==a.start.rowIndex?Math.abs(a.end.rowIndex-a.start.rowIndex)+1:0,p=null!==a.start.colIndex?Math.abs(a.end.colIndex-a.start.colIndex)+1:0,f=d>0?d:u,g=c>0?Bo(r):p,m=f>1,h=g>1,v=[];if(e>=0&&t>nn){const e=c>0?c:1,t=e>1?Lo("dataInput.contextMenu.clearCellDataCount",{count:e}):Lo("dataInput.contextMenu.clearCellData");v.push({label:Lo("dataInput.contextMenu.copy"),action:"copy-cell",icon:"content_copy"},{label:Lo("dataInput.contextMenu.paste"),action:"paste-cell",icon:"content_paste"},{type:"separator"}),v.push({label:t,action:"clear-cell-data",icon:"×"}),v.push({type:"separator"})}if((t===nn||d>0||e>=0)&&((t===nn||d>0)&&v.push({label:Lo("dataInput.contextMenu.copy"),action:"copy-cell",icon:"content_copy"},{label:Lo("dataInput.contextMenu.paste"),action:"paste-cell",icon:"content_paste"},{type:"separator"}),v.push({label:m?Lo("dataInput.contextMenu.addRowAboveCount",{count:f}):Lo("dataInput.contextMenu.addRowAbove"),action:"add-row-above",icon:"↑"},{label:m?Lo("dataInput.contextMenu.addRowBelowCount",{count:f}):Lo("dataInput.contextMenu.addRowBelow"),action:"add-row-below",icon:"↓"},{type:"separator"},{label:m?Lo("dataInput.contextMenu.clearRowsDataCount",{count:f}):Lo("dataInput.contextMenu.clearRowsData"),action:"clear-rows-data",icon:"×"},{label:m?Lo("dataInput.contextMenu.deleteRowsCount",{count:f}):Lo("dataInput.contextMenu.deleteRows"),action:"delete-rows",icon:"−",danger:!0})),e<0||c>0||e>=0&&t>nn){v.length>0&&v.push({type:"separator"});const e=new Set;c>0?r.forEach(t=>{const[,n]=t.split("_"),l=o.find(e=>e.colIndex===parseInt(n,10));l&&e.add(l.type)}):s&&e.add(s.type);const t=Array.from(e).some(e=>[sn,"clinicalSymptoms","dietInfo"].includes(e));t?(v.push({label:h?Lo("dataInput.contextMenu.addColLeftCount",{count:g}):Lo("dataInput.contextMenu.addColLeft"),action:"add-col-left",icon:"←"},{label:h?Lo("dataInput.contextMenu.addColRightCount",{count:g}):Lo("dataInput.contextMenu.addColRight"),action:"add-col-right",icon:"→"},{type:"separator"},{label:h?Lo("dataInput.contextMenu.clearColsDataCount",{count:g}):Lo("dataInput.contextMenu.clearColsData"),action:"clear-cols-data",icon:"×"}),Wo(n,o)&&v.push({label:h?Lo("dataInput.contextMenu.deleteColsCount",{count:g}):Lo("dataInput.contextMenu.deleteCols"),action:"delete-cols",icon:"−",danger:!0})):Array.from(e).some(e=>[an,rn,cn,pn].includes(e))?v.push({label:h?Lo("dataInput.contextMenu.clearColsDataCount",{count:g}):Lo("dataInput.contextMenu.clearColsData"),action:"clear-cols-data",icon:"×"}):Array.from(e).includes(ln)&&v.push({label:Lo("dataInput.contextMenu.deleteEmptyRows"),action:"delete-empty-rows",icon:"×"})}if(e<0){v.push({label:Lo("dataInput.contextMenu.copy"),action:"copy-cell",icon:"content_copy"},{label:Lo("dataInput.contextMenu.paste"),action:"paste-cell",icon:"content_paste"});const e=Lo("dataInput.contextMenu.emptyCell");if(s&&s.type===an){const n=Ao(t,l);v.push({type:"separator"}),n.forEach(({value:n,count:o})=>{const a=""===n?e:n,i=`filter-patient-${""===n?"empty":n}`;v.push({label:`${a} (${o})`,action:i,type:"checkbox",checked:Ko(t,""===n?"empty":n,l)})})}if(s&&s.type===rn){const n=Ao(t,l);v.push({type:"separator"}),n.forEach(({value:n,count:o})=>{const a=""===n?e:n,i=`filter-confirmed-${""===n?"empty":n}`;v.push({label:`${a} (${o})`,action:i,type:"checkbox",checked:Ko(t,""===n?"empty":n,l)})})}if(s&&"clinicalSymptoms"===s.type){const n=Ao(t,l);v.push({type:"separator"}),n.forEach(({value:n,count:o})=>{const a=""===n?e:n,i=`filter-clinical-${""===n?"empty":n}`;v.push({label:`${a} (${o})`,action:i,type:"checkbox",checked:Ko(t,""===n?"empty":n,l)})})}if(s&&"dietInfo"===s.type){const n=Ao(t,l);v.push({type:"separator"}),n.forEach(({value:n,count:o})=>{const a=""===n?e:n,i=`filter-diet-${""===n?"empty":n}`;v.push({label:`${a} (${o})`,action:i,type:"checkbox",checked:Ko(t,""===n?"empty":n,l)})})}if(s&&s.type===sn){const n=Ao(t,l);v.push({type:"separator"}),n.forEach(({value:n,count:o})=>{const a=""===n?e:n,i=`filter-basic-${""===n?"empty":n}`;v.push({label:`${a} (${o})`,action:i,type:"checkbox",checked:Ko(t,""===n?"empty":n,l)})})}if(s&&(s.type===cn||s.type===pn)){const n=Oo(t,l);v.push({type:"separator"}),n.forEach(({date:n,count:o})=>{const a=""===n?e:n,i=`filter-datetime-${""===n?"empty":n}`;v.push({label:`${a} (${o})`,action:i,type:"checkbox",checked:Ko(t,""===n?"empty":n,l)})})}l.gridStore&&l.gridStore.isFiltered&&v.push({type:"separator"},{label:Lo("dataInput.contextMenu.clearAllFilters"),action:"clear-all-filters",icon:"×"})}return v}function Bo(e){const t=new Set;return e.forEach(e=>{const[,n]=e.split("_");t.add(parseInt(n,10))}),t.size}function Wo(e,t){const{selectedRange:n,selectedCellsIndividual:o}=e,l=t.reduce((e,t)=>([sn,"clinicalSymptoms","dietInfo"].includes(t.type)&&(e[t.type]||(e[t.type]=0),e[t.type]++),e),{}),a={};if(o.size>0)o.forEach(e=>{const[,n]=e.split("_"),o=parseInt(n,10),l=t.find(e=>e.colIndex===o);l&&[sn,"clinicalSymptoms","dietInfo"].includes(l.type)&&(a[l.type]||(a[l.type]=0),a[l.type]++)});else if(null!==n.start.colIndex)for(let i=n.start.colIndex;i<=n.end.colIndex;i++){const e=t.find(e=>e.colIndex===i);e&&[sn,"clinicalSymptoms","dietInfo"].includes(e.type)&&(a[e.type]||(a[e.type]=0),a[e.type]++)}for(const i in a)if(l[i]-a[i]>=1)return!0;return!1}function Uo(e){const{selectionSystem:t,target:n}=e,{selectedRange:o,selectedRowsIndividual:l}=t.state;if(l.size>0){const e=Array.from(l).sort((e,t)=>e-t);return 0===e.length?{type:"none",startRow:n.rowIndex,endRow:n.rowIndex,count:0,rows:[]}:{type:"individual",rows:e,startRow:Math.min(...e),endRow:Math.max(...e),count:e.length}}return null!==o.start.rowIndex?{type:"range",startRow:o.start.rowIndex,endRow:o.end.rowIndex,count:o.end.rowIndex-o.start.rowIndex+1,rows:[]}:{type:"none",startRow:n.rowIndex,endRow:n.rowIndex,count:1,rows:[]}}function zo(e){const{selectionSystem:t,target:n}=e,{selectedRange:o,selectedCellsIndividual:l}=t.state;if(l.size>0){const e=new Set;l.forEach(t=>{const[,n]=t.split("_");e.add(parseInt(n,10))});const t=Array.from(e).sort((e,t)=>e-t);return 0===t.length?{type:"none",startCol:n.colIndex,endCol:n.colIndex,count:0,columns:[]}:{type:"individual",columns:t,startCol:Math.min(...t),endCol:Math.max(...t),count:t.length}}return null!==o.start.colIndex?{type:"range",startCol:o.start.colIndex,endCol:o.end.colIndex,count:o.end.colIndex-o.start.colIndex+1,columns:[]}:{type:"none",startCol:n.colIndex,endCol:n.colIndex,count:1,columns:[]}}function Yo(e){const{selectionSystem:t,allColumnsMeta:n,epidemicStore:o,validationManager:l,target:a}=e,{selectedCellsIndividual:i}=t.state,r=[];if(i.size>0)for(const s of i){const[e,t]=s.split("_"),l=parseInt(e,10),a=parseInt(t,10),i=n.find(e=>e.colIndex===a);i&&(o.updateCell({rowIndex:l,cellIndex:i.cellIndex,key:i.dataKey||"",value:""}),r.push({rowIndex:l,colIndex:a}))}else{const e=n.find(e=>e.colIndex===a.colIndex);e&&(o.updateCell({rowIndex:a.rowIndex,cellIndex:e.cellIndex,key:e.dataKey||"",value:""}),r.push({rowIndex:a.rowIndex,colIndex:a.colIndex}))}l&&r.length>0&&l.handleDataClear(r)}function Xo(e,t){const{epidemicStore:n,validationManager:o,allColumnsMeta:l}=t,a=Uo(t);if("add-row-above"===e)n.insertRowAt({index:a.startRow,count:a.count}),o&&o.handleRowAddition(a.startRow,[],l,a.count);else if("add-row-below"===e)n.insertRowAt({index:a.endRow+1,count:a.count}),o&&o.handleRowAddition(a.endRow+1,[],l,a.count);else if("delete-rows"===e){let e=[];"individual"===a.type?(n.deleteIndividualRows({rows:a.rows}),e=a.rows):(n.deleteMultipleRows({startRow:a.startRow,endRow:a.endRow}),e=Array.from({length:a.endRow-a.startRow+1},(e,t)=>a.startRow+t)),o&&o.handleRowDeletion(e,l)}else"clear-rows-data"===e?"individual"===a.type?n.clearIndividualRowsData({rowIndices:a.rows}):n.clearMultipleRowsData({startRow:a.startRow,endRow:a.endRow}):"delete-empty-rows"===e&&n.deleteEmptyRows()}function Ho(e,t){const{epidemicStore:n,validationManager:l,allColumnsMeta:a,target:i}=t;if("clear-cols-data"===e){const e=zo(t),o="individual"===e.type?e.columns:Array.from({length:e.endCol-e.startCol+1},(t,n)=>e.startCol+n),i=[];for(const t of o){const e=a.find(e=>e.colIndex===t);e&&([an,rn,cn,pn].includes(e.type)?n.clearFixedColumnData({type:e.type}):n.clearColumnData({type:e.type,index:e.cellIndex}),i.push(t))}return void(l&&i.length>0&&i.forEach(e=>{l.clearErrorsForColumn(e)}))}if("add-col-left"===e||"add-col-right"===e){const l=zo(t),r=a.find(e=>e.colIndex===i.colIndex);if(!r||!r.type||![sn,"clinicalSymptoms","dietInfo"].includes(r.type))return;let s;if("add-col-right"===e){const e=a.find(e=>e.colIndex===l.endCol);s=e?(e.cellIndex??0)+1:0}else{const e=a.find(e=>e.colIndex===l.startCol);s=e?e.cellIndex??0:0}return(0,qn.gg)(`[ContextMenu] 열 추가 시작: ${e}, 타입: ${r.type}, 개수: ${l.count}, 위치: ${s}`),n.insertMultipleColumnsAt({type:r.type,count:l.count,index:s}),void(0,o.dY)(()=>{t.allColumnsMeta})}}function qo(e,t){const{gridStore:n,captureSnapshotWithFilter:o,filterState:l,allColumnsMeta:a,target:i}=t;if("clear-all-filters"===e){const e=JSON.stringify(n.filterState);return n.clearAllFilters(),e!==JSON.stringify(n.filterState)&&o("filter_clear_all",{action:"clear-all-filters",oldFilterState:JSON.parse(e),newFilterState:{...n.filterState}}),void(l.value={...n.filterState})}let r="",s="";if(e.startsWith("filter-patient-")?(r="patient",s="filter-patient-"):e.startsWith("filter-confirmed-")?(r="confirmed",s="filter-confirmed-"):e.startsWith("filter-basic-")?(r="basic",s="filter-basic-"):e.startsWith("filter-clinical-")?(r="clinical",s="filter-clinical-"):e.startsWith("filter-diet-")?(r="diet",s="filter-diet-"):e.startsWith("filter-datetime-")&&(r="datetime",s="filter-datetime-"),r&&s){let t=e.substring(s.length);"empty"===t&&(t="");const d={patient:"isPatient",confirmed:"isConfirmedCase"};let c=d[r];if(!c){const e=a.find(e=>e.colIndex===i.colIndex);e&&(c=e.value||"",e.dataKey&&void 0!==e.cellIndex&&null!==e.cellIndex?c=`${e.dataKey}-${e.cellIndex}`:c||(c=e.dataKey||""),c||(c=String(e.colIndex)))}if(c){const a=JSON.stringify(n.filterState);n.toggleFilterValue(c,t),a!==JSON.stringify(n.filterState)&&o("filter_change",{action:e,filterType:r,value:t,oldFilterState:JSON.parse(a),newFilterState:{...n.filterState}}),l.value={...n.filterState}}}}function jo(e,t){"copy-cell"===e?xo(t):"paste-cell"===e&&Io(t)}function Go(e,t,n,o,l,a,i,r,s,d,c,u,p,f,g,m){const h=(0,Ct.X)(),v=Et();function x(){return{gridStore:v,epidemicStore:h,selectionSystem:e,allColumnsMeta:t.value,contextMenuState:n,showContextMenu:o,getOriginalIndex:a,rows:p,filteredRows:f,getCellValue:g,storageManager:m,validationManager:i,focusGrid:d,isEditing:e.state.isEditing,startEditing:e.startEditing,stopEditing:e.stopEditing,captureSnapshotWithFilter:c,filterState:u}}function I(e,t,n){if(n===nn)return;(0,qn.gg)("[DataInputVirtual] 컨텍스트 메뉴 이벤트:",{virtualRowIndex:t,colIndex:n,clientX:e.clientX,clientY:e.clientY});const o=x();Po(e,t,n,o)}async function w(t){if(!t)return;const o={...n.target};l();const a=x(),i={...a,target:o};"clear-cell-data"===t?Yo(i):"copy-cell"===t||"paste-cell"===t?jo(t,i):["add-row-above","add-row-below","delete-rows","clear-rows-data","delete-empty-rows"].includes(t)?Xo(t,i):["add-col-left","add-col-right","delete-cols","clear-cols-data"].includes(t)?Ho(t,i):(t.startsWith("filter-")||"clear-all-filters"===t)&&qo(t,i),e.clearIndividualSelections()}return{onContextMenu:I,onContextMenuSelect:w}}function Jo(e,t,n,l,a,i,r=e=>e){const s=(0,Ct.X)(),d=_t();function c(){a("delete_empty_rows",{blocking:!0,timeout:1e4})&&(n.visible&&((0,qn.gg)("[DataInputVirtual] 빈 행 삭제로 데이트피커 닫기"),l()),d.captureSnapshot("delete_empty_rows"),s.deleteEmptyRows(),e.clearSelection(),(0,Xt.P0)(r("dataInput.toast.grid.rowsDeleted"),"success"),i("delete_empty_rows"))}function u(a){n.visible&&((0,qn.gg)("[DataInputVirtual] 행 추가로 데이트피커 닫기"),l()),d.captureSnapshot("add_rows");const i=t.value.length;s.insertRowAt({index:i,count:a}),(0,o.dY)(()=>{e.clearSelection(),(0,Xt.P0)(r("dataInput.toast.grid.rowAdded",{count:a}),"success")})}function p(){n.visible&&((0,qn.gg)("[DataInputVirtual] 선택 영역 초기화로 데이트피커 닫기"),l()),e.clearSelection()}return{onDeleteEmptyRows:c,onAddRows:u,onClearSelection:p}}function Qo(e,t,n,l,a,i,r){const s=_t(),d=Et();function c(){l.visible&&a(),s.undo(),e&&"function"===typeof e.onDataReset&&e.onDataReset(),n(),(0,o.dY)(()=>{if(JSON.stringify(t.value)!==JSON.stringify(d.filterState)){t.value={...d.filterState};const e=i.value,n=r.value;e&&n&&(e.$forceUpdate&&e.$forceUpdate(),n.$forceUpdate&&n.$forceUpdate())}})}function u(){(0,qn.gg)("[Redo] ===== Redo 시작 ====="),l.visible&&a(),s.redo(),e&&"function"===typeof e.onDataReset&&e.onDataReset(),n(),(0,o.dY)(()=>{if(JSON.stringify(t.value)!==JSON.stringify(d.filterState)){qn.vF.warn("[Redo] 필터 상태 불일치 감지 - 동기화 실행"),t.value={...d.filterState};const e=i.value,n=r.value;e&&n&&(e.$forceUpdate&&e.$forceUpdate(),n.$forceUpdate&&n.$forceUpdate())}})}return{onUndo:c,onRedo:u}}function Zo(e,t,a){const i=(0,l.Kh)({visible:!1,position:{top:0,left:0},initialValue:null,cell:null,currentEdit:null});async function r(l){(0,qn.gg)("[DateTimePicker] Date confirmed:",l);const r=i.currentEdit;if(!r)return qn.vF.warn("[DateTimePicker] No edit info found"),void(i.visible=!1);const{rowIndex:s,colIndex:d,columnMeta:c}=r;try{const{formatDateTime:t}=await n.e(51).then(n.bind(n,6051)),o=t(l);(0,qn.gg)(`[DateTimePicker] Formatted value: ${o} for cell: ${s}, ${d}`);const i={cell:{rowIndex:s,colIndex:d,dataKey:c.dataKey||c.type,cellIndex:c.cellIndex},originalValue:"",value:o,columnMeta:c,editDuration:0,hasChanged:!0};a.executeSave(i),a.scheduleSave(i),e&&e.validateCell(s,d,o,c.type,!0),(0,qn.gg)(`[DateTimePicker] Successfully saved date: ${o}`)}catch(u){qn.vF.error("[DateTimePicker] Error saving date:",u)}i.visible=!1,i.currentEdit=null,(0,o.dY)(()=>{t()})}function s(){(0,qn.gg)("[DateTimePicker] Date selection cancelled"),d()}function d(){(0,qn.gg)("[DateTimePicker] Closing date picker"),i.visible=!1,i.currentEdit=null,(0,o.dY)(()=>{t()})}return{dateTimePickerState:i,onDateTimeConfirm:r,onDateTimeCancel:s,closeDateTimePicker:d}}function el(e){const{selectionSystem:t,allColumnsMeta:n,rows:a,getCellValue:i,storageManager:r,validationManager:s,focusGrid:d,ensureCellIsVisible:c,gridBodyRef:u,gridHeaderRef:p}=e,f=Et(),g=(0,l.Kh)({visible:!1,position:{top:0,left:0,width:100,height:35},value:"",rowIndex:-1,colIndex:-1,columnMeta:null,originalValue:"",selectOnFocus:!0}),m=(0,l.KR)(null);async function h(e,l,r,s,d=!0){const c=n.value.find(e=>e.colIndex===l);if(!c)return;if(void 0!==s){g.visible=!0,g.rowIndex=e,g.colIndex=l,g.columnMeta=c,g.value=s;let u=null;e>=0&&e<a.value.length&&(u=a.value[e]);const p=i(u,c,e);g.originalValue=String(p||"");const h=r.getBoundingClientRect();return g.position={top:h.top,left:h.left,width:h.width,height:h.height},g.selectOnFocus=d,t.selectCell(e,l),t.startEditing(e,l,i,u,f,n.value),f.updateTempValue(s),void(0,o.dY)(()=>{m.value&&m.value.inputRef&&m.value.inputRef.focus()})}if(!c.isEditable)return;let u="",p=null;e<0?(u=c.headerText||c.dataKey||"",u=u.replace(/<br\s*\/?>/gi," "),p=null):(p=a.value[e],p&&(u=i(p,c,e)));const h=r.getBoundingClientRect();g.position={top:h.top,left:h.left,width:h.width,height:h.height},g.value=String(u||""),g.originalValue=String(u||""),g.rowIndex=e,g.colIndex=l,g.columnMeta=c,g.selectOnFocus=d,g.visible=!0,t.selectCell(e,l),t.startEditing(e,l,i,p,f,n.value),f.updateTempValue(g.value)}async function v(e,t,n,o){await h(e,t,n,o,!1)}function x(e){if(!g.visible)return;const n=g.value,{rowIndex:o,colIndex:l,columnMeta:a,originalValue:i}=g,d=n!==i;if(d&&a){f.updateTempValue(n);const e={cell:{rowIndex:o,colIndex:l,dataKey:a.dataKey||"",cellIndex:a.cellIndex},originalValue:i,value:n,columnMeta:a,editDuration:0,hasChanged:!0};if(r.executeSave(e),s)try{s.validateCell(o,l,n,a.type,!0)}catch(c){console.error("[EditOverlay] Validation failed:",c)}}f.confirmEditing(),t.stopEditing(!0),w()}function I(){f.cancelEditing(),t.stopEditing(!1),w(),d()}function w(){g.visible=!1,g.columnMeta=null}function y(e){g.value=e,f.updateTempValue(e)}function C(e){g.visible&&(g.value+=e,f.updateTempValue(g.value),(0,o.dY)(()=>{if(m.value&&m.value.inputRef){m.value.inputRef.focus();try{m.value.inputRef.selectionStart=g.value.length,m.value.inputRef.selectionEnd=g.value.length}catch(e){}}}))}async function b(){const{rowIndex:e,colIndex:n}=g;let o;o=e<0?0:e<a.value.length-1?e+1:e,t.selectCell(o,n),c&&await c(o,n),d()}async function E(){const{rowIndex:e,colIndex:o}=g,l=io(e,o,"right",n.value,a.value.length,n.value.length);t.selectCell(l.rowIndex,l.colIndex),c&&await c(l.rowIndex,l.colIndex),d()}return{editOverlayState:g,editOverlayRef:m,startEditOverlay:h,startEditOverlayWithKey:v,confirmEdit:x,cancelEdit:I,closeEditOverlay:w,handleOverlayInput:y,appendValueToOverlay:C,moveToNextRow:b,moveToNextCell:E}}var tl=(0,o.pM)({__name:"DataInputVirtual",setup(e){const t=(0,l.KR)(null),n=(0,l.KR)(null),i=(0,l.KR)(null),r=(0,l.KR)(null),s=(0,l.KR)(null),d=()=>t.value?.focus(),c=Et(),u=_t(),p=(0,Ct.X)(),f=(0,x.C)(),g=new Lt(null,null);g.setStore(p);const m=(0,o.EW)(()=>p.rows),v=(0,l.KR)(!1),I=(0,l.KR)(0),w=(0,l.KR)(0),y=(0,l.KR)(0),C=(0,l.KR)(0),{t:b}=a.A.global,E=new An(p,{debug:!1,useWorker:!0,showToast:(e,t)=>{(0,Xt.P0)(e,t)},t:a.A.global.t,onProgress:e=>{v.value=!0,I.value=e,e>=100&&setTimeout(()=>{v.value=!1},500)}}),{dateTimePickerState:S,onDateTimeConfirm:R,onDateTimeCancel:M,closeDateTimePicker:_}=Zo(E,d,g),{tryStartOperation:k,endOperation:D}=vn({showBlockedMessage:!0},b),$=Wt(),{allColumnsMeta:T,headerGroups:V,tableWidth:F,onToggleExposureColumn:K,onToggleConfirmedCaseColumn:A,onAddColumn:O,onDeleteColumn:L,onDeleteEmptyCols:P,onResetSheet:N}=jn(E,$,d,k,D);function B(e,t,n){const o=e.target,l=o.textContent||"",a=T.value.find(e=>e.colIndex===n);a&&c.updateTempValue(l)}const{filterState:W,filteredRows:U,captureSnapshotWithFilter:z,syncFilterStateAfterHistoryChange:Y,onClearAllFilters:X,onUpdateActiveFilters:H}=Qn(m,r,i),q=(0,o.EW)(()=>{const e=c.activeFilters,t=new Map;return e&&e.forEach((e,n)=>t.set(Number(n)||n,e)),t}),{visibleRows:j,totalHeight:G,paddingTop:J,scrollbarWidth:Q,getOriginalIndex:Z,handleGridScroll:ee,ensureCellIsVisible:te}=Jn(U,T,{rowHeight:35,bufferSize:1,gridContainerRef:n,gridHeaderRef:i,gridBodyRef:r});let ne=null;const oe=(e,t,n)=>ne?ne(e,t,n):"",le=(0,l.KR)(null),{editOverlayState:ae,startEditOverlay:ie,startEditOverlayWithKey:re,confirmEdit:se,cancelEdit:de,handleOverlayInput:ce,moveToNextRow:ue,moveToNextCell:pe,appendValueToOverlay:ge}=el({selectionSystem:$,allColumnsMeta:T,rows:m,getCellValue:oe,storageManager:g,validationManager:E,focusGrid:d,ensureCellIsVisible:te,gridBodyRef:r,gridHeaderRef:i}),me={open:re,close:de,confirm:se,isVisible:()=>ae.visible,append:ge},{onCellMouseDown:he,onCellDoubleClick:ve,onUpdateCellValueFromBar:xe,onEnterPressedFromBar:Ie,onKeyDown:we,getCellValue:ye,cleanupInteractionListeners:Ce}=So($,T,m,U,d,te,E,S,s,r,_,M,g,b,me);function be(e){ae.visible&&se()}ne=ye,(0,o.sV)(()=>{document.addEventListener("mousedown",be),E&&T.value.length>0&&(E.updateColumnMetas(T.value),E.migrateErrorsToUniqueKeys(T.value),E.printUniqueKeyMapping(T.value))}),(0,o.xo)(()=>{document.removeEventListener("mousedown",be)}),(0,o.wB)(()=>u.isRestoring,e=>{e&&ae.visible&&de()}),(0,o.wB)(()=>[T.value.length,(m.value||[]).length],()=>{ae.visible&&de()});const Ee=(0,o.EW)(()=>{const{rowIndex:e,colIndex:t}=$.state.selectedCell;if(null===e||null===t)return{address:"",value:""};const n=T.value.find(e=>e.colIndex===t);if(!n)return{address:"",value:""};if(0===t&&e>=0){const t=m.value[e]?e+1:"";return{address:"",value:String(t)}}let o=(n.headerText||"").replace(/<br\s*\/?>/gi," ").trim();n.type===an&&(o=o.split("(")[0].trim());const l=[sn,dn,un];if(e<0&&l.includes(n.type)){const e=V.value.find(e=>t>=e.startColIndex&&t<e.startColIndex+(e.colspan||1)),n=e&&e.text?String(e.text).split("(")[0].trim():"";o=n}let a="";a=e>=0?`${o} / ${e+1}`:o;let i="";if(e<0)i=ye(null,n,-1);else{const t=U.value[e];t&&(i=ye(t,n,e))}return{address:a,value:i}}),{contextMenuState:Se,showContextMenu:Re,hideContextMenu:Me}=Bt(),{onContextMenu:_e,onContextMenuSelect:ke}=Go($,T,Se,Re,Me,Z,E,k,D,d,z,W,m,U,ye,g),{isUploadingExcel:De,excelUploadProgress:Te,onExcelFileSelected:Ve,onExportData:Fe,onDownloadTemplate:Ke,onCopyEntireData:Ae,onFileDropped:Oe}=Fo(E,$,k,D,T,ye,{hasIndividualExposure:(0,o.EW)(()=>f.isIndividualExposureColumnVisible),hasConfirmedCase:(0,o.EW)(()=>f.isConfirmedCaseColumnVisible)},b),{onDeleteEmptyRows:Le,onAddRows:Pe,onClearSelection:Ne}=Jo($,m,S,_,k,D,b),{onUndo:Be,onRedo:We}=Qo(E,W,Y,S,_,r,i),{isDragOver:Ue,setupDragDropListeners:ze}=en();let Xe=null;const He=new Ye,qe=(0,o.EW)(()=>{const e=p.validationState?.errors;return e instanceof Map?e:new Map}),je=(0,o.EW)(()=>{const e=qe.value,t=c.isFiltered,n=U.value;return He.updateFilterState(t,n,e),He.getVisibleErrors()});function Ge(e){if(S.visible)switch(e.key){case"Escape":return e.preventDefault(),e.stopPropagation(),void M();case"Enter":return e.preventDefault(),e.stopPropagation(),void(s.value?.confirm&&s.value.confirm());case"Tab":return e.preventDefault(),e.stopPropagation(),void(s.value?.confirm&&s.value.confirm());default:return}we(e)}(0,o.wB)(()=>c.isFiltered,(e,t)=>{e!==t&&(0,o.dY)(()=>{const e=r.value;e&&e.$forceUpdate()})},{immediate:!1});const Je=()=>{Se.visible&&Me()};function Ze(){const e=Array.from(je.value.entries());if(0===e.length)return;const[t]=e[0],n=t.indexOf("_");if(-1===n)return;const o=t.substring(0,n),l=t.substring(n+1),a=parseInt(o,10);let i=T.value.find(e=>{const t=E.getColumnUniqueKey(e);return t===l||(e.dataKey===l||"confirmed"===l&&"isConfirmedCase"===e.dataKey)});if(!i){const e=parseInt(l,10);isNaN(e)||(i=T.value.find(t=>t.colIndex===e))}if(!i)return void qn.vF.warn("[FocusFirstError] Column meta not found for key component:",l);const r=i.colIndex;let s=a;if(c.isFiltered){const e=U.value.findIndex(e=>e._originalIndex===a);if(-1===e)return void qn.vF.warn("[FocusFirstError] Row with error is currently filtered out");s=e}(0,qn.gg)("[FocusFirstError] Focusing error cell:",{originalRowIndex:a,targetRowIndex:s,colIndex:r,key:l});const u=r??0;Promise.resolve().then(async()=>{await te(s,u),$.selectCell(s,u),d()})}return(0,o.sV)(()=>{(0,qn.gg)("[Filter] 컴포넌트 마운트 시 필터 초기화"),c.clearAllFilters();const e=g.loadData();if(e){if(e.headers&&e.rows&&p.setInitialData({headers:e.headers,rows:e.rows}),e.settings){const t=e.settings;void 0!==t.isIndividualExposureColumnVisible&&f.setIndividualExposureColumnVisibility(t.isIndividualExposureColumnVisible),void 0!==t.isConfirmedCaseColumnVisible&&f.setConfirmedCaseColumnVisibility(t.isConfirmedCaseColumnVisible),void 0!==t.exposureDateTime&&f.updateExposureDateTime(t.exposureDateTime),void 0!==t.selectedSymptomInterval&&f.updateSymptomInterval(t.selectedSymptomInterval),void 0!==t.selectedIncubationInterval&&f.updateIncubationInterval(t.selectedIncubationInterval),void 0!==t.selectedSuspectedFoods&&f.setSelectedSuspectedFoods(t.selectedSuspectedFoods),void 0!==t.epidemicCurveSettings&&f.updateEpidemicCurveSettings(t.epidemicCurveSettings)}if(e.validationState){const{errors:t,version:n}=e.validationState;if(t){const e=new Map;"object"===typeof t&&null!==t&&Object.entries(t).forEach(([t,n])=>{e.set(t,n)}),p.setValidationErrors(e)}void 0!==n&&p.setValidationVersion(n),(0,o.dY)(()=>{E&&T.value.length>0&&E.migrateErrorsToUniqueKeys(T.value)})}}else p.loadInitialData();(0,o.wB)([()=>p.headers,()=>p.rows,()=>p.validationState,()=>f.$state],()=>{g.saveCurrentState()},{deep:!0}),Xe=ze(Oe),document.addEventListener("mousedown",Je)}),(0,o.xo)(()=>{if(document.removeEventListener("mousedown",Je),Xe&&Xe(),Ce&&Ce(),E&&"function"===typeof E.clearTimers)try{E.clearTimers()}catch(e){}E.destroy(),g&&g.reset()}),(0,o.wB)(T,e=>{Yt(e)},{immediate:!0}),(e,a)=>((0,o.uX)(),(0,o.CE)("div",{class:"h-full grid grid-rows-[auto_auto_1fr] bg-white overflow-hidden outline-none pb-[48px]",tabindex:"0",onKeydown:Ge,ref_key:"dataContainerRef",ref:t},[(0,o.bF)(h,{errorCount:je.value.size,onFocusFirstError:Ze},null,8,["errorCount"]),(0,o.bF)(fe,{"cell-address":Ee.value.address,"cell-value":Ee.value.value,"is-uploading-excel":(0,l.R1)(De),"upload-progress":(0,l.R1)(Te),"can-undo":(0,l.R1)(u).canUndo,"can-redo":(0,l.R1)(u).canRedo,"is-filtered":(0,l.R1)(c).isFiltered,"filtered-row-count":(0,l.R1)(c).filterState.filteredRowCount||0,"original-row-count":(0,l.R1)(c).filterState.originalRowCount||0,onUpdateCellValue:(0,l.R1)(xe),onEnterPressed:(0,l.R1)(Ie),onExcelFileSelected:(0,l.R1)(Ve),onDownloadTemplate:(0,l.R1)(Ke),onExportData:(0,l.R1)(Fe),onCopyEntireData:(0,l.R1)(Ae),onDeleteEmptyCols:(0,l.R1)(P),onResetSheet:(0,l.R1)(N),onToggleExposureCol:(0,l.R1)(K),onToggleConfirmedCaseCol:(0,l.R1)(A),onUndo:(0,l.R1)(Be),onRedo:(0,l.R1)(We),onClearAllFilters:(0,l.R1)(X)},null,8,["cell-address","cell-value","is-uploading-excel","upload-progress","can-undo","can-redo","is-filtered","filtered-row-count","original-row-count","onUpdateCellValue","onEnterPressed","onExcelFileSelected","onDownloadTemplate","onExportData","onCopyEntireData","onDeleteEmptyCols","onResetSheet","onToggleExposureCol","onToggleConfirmedCaseCol","onUndo","onRedo","onClearAllFilters"]),(0,o.Lk)("div",{class:"flex flex-col overflow-hidden bg-white min-h-0 relative z-10",ref_key:"gridContainerRef",ref:n},[(0,o.bF)($e,{ref_key:"gridHeaderRef",ref:i,headerGroups:(0,l.R1)(V),allColumnsMeta:(0,l.R1)(T),tableWidth:(0,l.R1)(F),selectedCell:(0,l.R1)($).state.selectedCell,selectedRange:(0,l.R1)($).state.selectedRange,individualSelectedCells:(0,l.R1)($).state.selectedCellsIndividual,isEditing:(0,l.R1)($).state.isEditing,editingCell:(0,l.R1)($).state.editingCell,scrollbarWidth:(0,l.R1)(Q),"is-filtered":(0,l.R1)(c).isFiltered,activeFilters:q.value,onCellMousedown:(0,l.R1)(he),onCellDblclick:(0,l.R1)(ve),onCellInput:B,onCellContextmenu:(0,l.R1)(_e),onAddColumn:(0,l.R1)(O),onDeleteColumn:(0,l.R1)(L),"onUpdate:activeFilters":(0,l.R1)(H)},null,8,["headerGroups","allColumnsMeta","tableWidth","selectedCell","selectedRange","individualSelectedCells","isEditing","editingCell","scrollbarWidth","is-filtered","activeFilters","onCellMousedown","onCellDblclick","onCellContextmenu","onAddColumn","onDeleteColumn","onUpdate:activeFilters"]),(0,o.bF)(Qe,{ref_key:"gridBodyRef",ref:r,visibleRows:(0,l.R1)(j),allColumnsMeta:(0,l.R1)(T),tableWidth:(0,l.R1)(F),totalHeight:(0,l.R1)(G),paddingTop:(0,l.R1)(J),bufferSize:4,getCellValue:(0,l.R1)(ye),selectedCell:(0,l.R1)($).state.selectedCell,selectedRange:(0,l.R1)($).state.selectedRange,individualSelectedCells:(0,l.R1)($).state.selectedCellsIndividual,isEditing:(0,l.R1)($).state.isEditing,editingCell:(0,l.R1)($).state.editingCell,individualSelectedRows:(0,l.R1)($).state.selectedRowsIndividual,"validation-errors":je.value,"column-metas":(0,l.R1)(T),"is-filtered":(0,l.R1)(c).isFiltered,onScroll:(0,l.R1)(ee),onCellMousedown:(0,l.R1)(he),onCellDblclick:(0,l.R1)(ve),onCellInput:B,onCellContextmenu:(0,l.R1)(_e),onAddRows:(0,l.R1)(Pe),onDeleteEmptyRows:(0,l.R1)(Le),onClearSelection:(0,l.R1)(Ne)},null,8,["visibleRows","allColumnsMeta","tableWidth","totalHeight","paddingTop","getCellValue","selectedCell","selectedRange","individualSelectedCells","isEditing","editingCell","individualSelectedRows","validation-errors","column-metas","is-filtered","onScroll","onCellMousedown","onCellDblclick","onCellContextmenu","onAddRows","onDeleteEmptyRows","onClearSelection"])],512),(0,o.bF)(ct,{visible:(0,l.R1)(Se).visible,x:(0,l.R1)(Se).x,y:(0,l.R1)(Se).y,items:(0,l.R1)(Se).items,onSelect:(0,l.R1)(ke)},null,8,["visible","x","y","items","onSelect"]),(0,o.bF)(vt,{visible:(0,l.R1)(Ue),progress:(0,l.R1)(Te)},null,8,["visible","progress"]),(0,o.bF)(Pt.A),(0,o.bF)(xt.A,{ref_key:"dateTimePickerRef",ref:s,visible:(0,l.R1)(S).visible,position:(0,l.R1)(S).position,initialValue:(0,l.R1)(S).initialValue,onConfirm:(0,l.R1)(R),onCancel:(0,l.R1)(M)},null,8,["visible","position","initialValue","onConfirm","onCancel"]),(0,o.bF)(Hn,{"is-visible":v.value,progress:I.value,processed:w.value,total:y.value,"error-count":C.value},null,8,["is-visible","progress","processed","total","error-count"]),(0,o.bF)(yt,{ref_key:"editOverlayRef",ref:le,visible:(0,l.R1)(ae).visible,position:(0,l.R1)(ae).position,value:(0,l.R1)(ae).value,"row-index":(0,l.R1)(ae).rowIndex,"col-index":(0,l.R1)(ae).colIndex,"select-on-focus":(0,l.R1)(ae).selectOnFocus,onConfirm:(0,l.R1)(se),onCancel:(0,l.R1)(de),onInput:(0,l.R1)(ce),onMoveNextRow:(0,l.R1)(ue),onMoveNextCell:(0,l.R1)(pe)},null,8,["visible","position","value","row-index","col-index","select-on-focus","onConfirm","onCancel","onInput","onMoveNextRow","onMoveNextCell"])],544))}});const nl=tl;var ol=nl}}]);